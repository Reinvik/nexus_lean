const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/demoData-D1q3Osw3.js","assets/vendor-B7Q_Ul-m.js","assets/supabase-vtL5VWMt.js","assets/lucide-CZvFDlkd.js","assets/recharts-BcdcR1Rl.js"])))=>i.map(i=>d[i]);
import{r as j,a as Ls,u as We,N as Os,O as ks,b as as,c as Xe,L as pe,d as Cs,B as Ms,e as qs,f as X}from"./vendor-B7Q_Ul-m.js";import{c as Us}from"./supabase-vtL5VWMt.js";import{B as os,A as Ws,T as Fe,L as Bs,U as re,C as K,a as Be,M as Ze,b as Le,c as xs,d as se,e as Vs,X as ae,f as Gs,g as Hs,h as ze,i as Ie,S as Ks,F as fe,Z as Ee,j as Ss,k as Re,l as Qs,m as As,n as Js,o as is,p as ds,q as ie,r as Ys,P as J,s as xe,G as Ge,t as Xs,u as Zs,v as Y,w as us,x as le,y as et,z as Oe,D as Ce,E as Me,H as st,I as rs,R as He,J as Se,K as qe,N as ps,O as tt,Q as at,V as ye,W as rt,Y as Ue,_ as Ke,$ as lt,a0 as cs,a1 as hs,a2 as nt,a3 as ls,a4 as ot,a5 as it,a6 as bs,a7 as dt,a8 as Qe,a9 as ct,aa as fs,ab as mt,ac as xt,ad as ut,ae as pt,af as ht,ag as bt}from"./lucide-CZvFDlkd.js";import{R as te,B as Je,C as ge,X as he,Y as be,T as ne,a as _e,P as De,b as Te,c as ue,A as zs,d as Es,L as Pe,e as _s,f as ts,g as ke,h as ft,i as gt,j as jt,k as vt,l as Nt,m as wt}from"./recharts-BcdcR1Rl.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))m(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const N of i.addedNodes)N.tagName==="LINK"&&N.rel==="modulepreload"&&m(N)}).observe(document,{childList:!0,subtree:!0});function d(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function m(s){if(s.ep)return;s.ep=!0;const i=d(s);fetch(s.href,i)}})();var Ps={exports:{}},es={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var yt=j,kt=Symbol.for("react.element"),Ct=Symbol.for("react.fragment"),St=Object.prototype.hasOwnProperty,At=yt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,zt={key:!0,ref:!0,__self:!0,__source:!0};function Is(t,r,d){var m,s={},i=null,N=null;d!==void 0&&(i=""+d),r.key!==void 0&&(i=""+r.key),r.ref!==void 0&&(N=r.ref);for(m in r)St.call(r,m)&&!zt.hasOwnProperty(m)&&(s[m]=r[m]);if(t&&t.defaultProps)for(m in r=t.defaultProps,r)s[m]===void 0&&(s[m]=r[m]);return{$$typeof:kt,type:t,key:i,ref:N,props:s,_owner:At.current}}es.Fragment=Ct;es.jsx=Is;es.jsxs=Is;Ps.exports=es;var e=Ps.exports,ns={},gs=Ls;ns.createRoot=gs.createRoot,ns.hydrateRoot=gs.hydrateRoot;const Et="https://qtzpzgwyjptbnipvyjdu.supabase.co",_t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InF0enB6Z3d5anB0Ym5pcHZ5amR1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU4NDY4MDAsImV4cCI6MjA4MTQyMjgwMH0.An72d0glXpf6RZR5nwQ9OnLeU00loVqkZkNjUJhICA4",U=Us(Et,_t,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0}}),Pt=Object.freeze(Object.defineProperty({__proto__:null,supabase:U},Symbol.toStringTag,{value:"Module"})),Ds=j.createContext(),It=({children:t})=>{const[r,d]=j.useState(null),[m,s]=j.useState(!0),[i,N]=j.useState([]),[w,l]=j.useState([]),z=j.useRef(r);j.useEffect(()=>{z.current=r},[r]);const[n,a]=j.useState("all"),x=async()=>{try{console.log("AuthContext: Fetching companies...");const{data:E,error:W}=await U.from("companies").select("*");if(W){console.error("AuthContext: Error fetching companies:",W);return}console.log("AuthContext: Companies loaded:",E==null?void 0:E.length,E),E&&N(E)}catch(E){console.error("AuthContext: Unexpected error fetching companies:",E)}};j.useEffect(()=>{x()},[]);const h=async()=>{console.log("AuthContext: Refreshing data..."),s(!0),await x(),r&&await S(r),s(!1)},b=async()=>{var E;if(!r)return{success:!1,message:"No usuario logueado"};try{const{error:W}=await U.from("profiles").upsert({id:r.id,email:r.email,name:((E=r.user_metadata)==null?void 0:E.name)||r.email.split("@")[0],role:"admin",is_authorized:!0,company_id:null});if(W)throw W;return await h(),{success:!0,message:"Perfil de administrador restaurado en DB."}}catch(W){return console.error("Repair error:",W),{success:!1,message:W.message}}};j.useEffect(()=>{(async()=>{if(!r){l([]);return}try{if(r.email==="ariel.mellag@gmail.com"||r.role==="admin"){const{data:B,error:I}=await U.from("profiles").select("id, name, email, company_id").eq("is_authorized",!0);I?(console.warn("AuthContext: Error fetching company users (Admin View):",I.message),l([])):B&&l(B)}else if(r.companyId){const{data:B,error:I}=await U.from("profiles").select("id, name, email, company_id").eq("company_id",r.companyId).eq("is_authorized",!0);I?(console.warn("AuthContext: Error fetching company users:",I.message),l([])):B&&l(B)}else l([])}catch(W){console.error("AuthContext: Unexpected error fetching company users:",W),l([])}})()},[r]),j.useEffect(()=>{let E=!0;(async()=>{try{console.log("AuthContext: Checking session...");const{data:{session:c},error:R}=await U.auth.getSession();console.log("AuthContext: Session result:",c,R),R&&console.error("AuthContext: Error getting session:",R),E&&(c?await S(c.user):d(null))}catch(c){console.error("AuthContext: Unexpected error in checkUser:",c),E&&d(null)}finally{E&&s(!1)}})();const B=setTimeout(()=>{E&&m&&(console.warn("AuthContext: Forced loading to false due to timeout."),s(!1))},6e3),{data:I}=U.auth.onAuthStateChange(async(c,R)=>{if(console.log("AuthContext: Auth state change:",c),c==="SIGNED_IN"&&R){const q=z.current;(!q||q.id!==R.user.id)&&s(!0);try{await S(R.user)}catch(u){console.error("AuthContext: Error in SIGNED_IN handler:",u)}finally{s(!1)}}else c==="SIGNED_OUT"&&(d(null),s(!1))});return()=>{E=!1,clearTimeout(B),I.subscription.unsubscribe()}},[]);const k=async E=>{if(!E)return null;try{const W=E.split("@")[1];if(!W)return null;const B=new Promise((c,R)=>setTimeout(()=>R(new Error("Domain lookup timed out")),3e3)),{data:I}=await Promise.race([U.from("companies").select("id").ilike("domain",`%${W}%`).maybeSingle(),B]);return I?I.id:null}catch(W){return console.warn("AuthContext: Domain fallback error:",W),null}},S=async E=>{var u,_,g;const W=E.email==="ariel.mellag@gmail.com",B=new Promise((y,M)=>setTimeout(()=>M(new Error("Request timed out")),15e3));let I=null,c=null;try{console.log("AuthContext: Fetching profile for",E.id);const y=await Promise.race([U.from("profiles").select("*").eq("id",E.id).maybeSingle(),B]);I=y.data,c=y.error}catch(y){c=y}if(!c&&I){console.log("AuthContext: Profile fetched successfully:",I),d({...E,...I,role:W?"admin":I.role,isAuthorized:W?!0:I.is_authorized,companyId:I.company_id});return}console.warn("AuthContext: Entering fallback mode. Reason:",c?c.message||c:"Profile not found");let R=((u=E.user_metadata)==null?void 0:u.company_id)||null;!R&&E.email&&(R=await k(E.email),R&&console.log("AuthContext: Domain fallback successful:",R));const q={...E,name:((_=E.user_metadata)==null?void 0:_.name)||((g=E.email)==null?void 0:g.split("@")[0])||"Usuario",role:W?"admin":"user",isAuthorized:!0,companyId:R,email:E.email};console.log("AuthContext: Usando usuario fallback:",q),d(q)},L=async(E,W)=>{const{error:B}=await U.auth.signInWithPassword({email:E,password:W});return B?{success:!1,message:B.message}:{success:!0}},v=async()=>{await U.auth.signOut(),d(null)},$=async E=>{const{data:W,error:B}=await U.auth.signUp({email:E.email,password:E.password,options:{data:{name:E.name,company_id:E.companyId}}});return B?{success:!1,message:B.message}:(W.user&&await U.from("profiles").update({company_id:E.companyId}).eq("id",W.user.id),{success:!0,message:"Registro exitoso. Por favor verifica tu correo."})},f=async E=>{const{error:W}=await U.auth.resetPasswordForEmail(E,{redirectTo:window.location.origin+"/reset-password"});return W?{success:!1,message:W.message}:{success:!0,message:"Se ha enviado un correo de recuperaciÃ³n."}},O=async E=>{const{error:W}=await U.auth.updateUser({password:E});return W?{success:!1,message:W.message}:{success:!0,message:"ContraseÃ±a actualizada correctamente"}},C=async E=>{await U.from("profiles").update({is_authorized:!0}).eq("id",E)},F=async(E,W)=>{const{error:B}=await U.from("profiles").update({is_authorized:W}).eq("id",E);return{success:!B,error:B}},o=async(E,W)=>{const{error:B}=await U.from("companies").insert([{name:E,domain:W}]);if(!B){const{data:I}=await U.from("companies").select("*");I&&N(I)}},p=async E=>{await U.from("companies").delete().eq("id",E),N(W=>W.filter(B=>B.id!==E))},D=async()=>{const{data:E}=await U.from("profiles").select("*");return E||[]},A=async(E,W)=>{const{error:B}=await U.from("profiles").update({role:W}).eq("id",E);return B||r&&r.id===E&&d(I=>({...I,role:W})),{success:!B,message:B?B.message:"Rol actualizado"}},T=async E=>{const{error:W}=await U.from("profiles").delete().eq("id",E);return{success:!W,error:W}},V=async(E,W)=>{const{error:B}=await U.from("profiles").update({company_id:W}).eq("id",E);return B||r&&r.id===E&&d(I=>({...I,companyId:W})),{success:!B,message:B?B.message:"Empresa actualizada"}};return e.jsx(Ds.Provider,{value:{user:r,loading:m,login:L,logout:v,register:$,resetPassword:f,companies:i,addCompany:o,removeCompany:p,adminAuthorizeUser:C,getAllUsers:D,removeUser:T,updateUserRole:A,updateUserCompany:V,companyUsers:w,globalFilterCompanyId:n,setGlobalFilterCompanyId:a,updateUserStatus:F,refreshData:h,repairAdminProfile:b,updatePassword:O},children:!m&&t})},Z=()=>j.useContext(Ds),Dt="NexusOfflineDB",Tt=2,ce="offline5SCards";class Rt{constructor(){this.db=null,this.initPromise=this.initDB()}async initDB(){return new Promise((r,d)=>{const m=indexedDB.open(Dt,Tt);m.onerror=s=>{console.error("OfflineDB Error:",s.target.error),d("Error opening offline database")},m.onsuccess=s=>{this.db=s.target.result,r(this.db)},m.onupgradeneeded=s=>{const i=s.target.result;i.objectStoreNames.contains(ce)||i.createObjectStore(ce,{keyPath:"tempId"}),i.objectStoreNames.contains("offlineAudits")||i.createObjectStore("offlineAudits",{keyPath:"tempId"})}})}async getDB(){return this.db||await this.initPromise,this.db}async saveCard(r,d,m){try{const s=await this.getDB(),i={tempId:`offline_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,timestamp:Date.now(),data:r,files:{imageBefore:d||null,imageAfter:m||null},status:"pending_sync"};return new Promise((N,w)=>{const n=s.transaction([ce],"readwrite").objectStore(ce).add(i);n.onsuccess=()=>N(i),n.onerror=a=>w(a.target.error)})}catch(s){throw console.error("OfflineService saveCard error:",s),s}}async getAllCards(){try{const r=await this.getDB();return new Promise((d,m)=>{const N=r.transaction([ce],"readonly").objectStore(ce).getAll();N.onsuccess=()=>{const w=N.result||[];w.sort((l,z)=>z.timestamp-l.timestamp),d(w)},N.onerror=w=>m(w.target.error)})}catch{return[]}}async deleteCard(r){try{const d=await this.getDB();return new Promise((m,s)=>{const w=d.transaction([ce],"readwrite").objectStore(ce).delete(r);w.onsuccess=()=>m(),w.onerror=l=>s(l.target.error)})}catch(d){console.error(d)}}async clearAll(){try{const r=await this.getDB();return new Promise((d,m)=>{const N=r.transaction([ce],"readwrite").objectStore(ce).clear();N.onsuccess=()=>d(),N.onerror=w=>m(w.target.error)})}catch(r){console.error(r)}}async saveAudit(r){try{const d=await this.getDB(),m={tempId:`offline_audit_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,timestamp:Date.now(),data:r,status:"pending_sync"};return new Promise((s,i)=>{const l=d.transaction(["offlineAudits"],"readwrite").objectStore("offlineAudits").add(m);l.onsuccess=()=>s(m),l.onerror=z=>i(z.target.error)})}catch(d){throw console.error("OfflineService saveAudit error:",d),d}}async getAllAudits(){try{const r=await this.getDB();return new Promise((d,m)=>{const N=r.transaction(["offlineAudits"],"readonly").objectStore("offlineAudits").getAll();N.onsuccess=()=>{const w=N.result||[];w.sort((l,z)=>z.timestamp-l.timestamp),d(w)},N.onerror=w=>m(w.target.error)})}catch{return[]}}async deleteAudit(r){try{const d=await this.getDB();return new Promise((m,s)=>{const w=d.transaction(["offlineAudits"],"readwrite").objectStore("offlineAudits").delete(r);w.onsuccess=()=>m(),w.onerror=l=>s(l.target.error)})}catch(d){console.error(d)}}}const me=new Rt,Ts=j.createContext(),$t=({children:t})=>{const{user:r}=Z(),[d,m]=j.useState([]),[s,i]=j.useState(!0),N=j.useRef(null),[w,l]=j.useState([]),[z,n]=j.useState([]),[a,x]=j.useState([]),[h,b]=j.useState(!0),k=j.useCallback(async()=>{if(!r){m([]),i(!1);return}N.current&&N.current.abort();const f=new AbortController;N.current=f,i(!0);let O=[];try{O=(await me.getAllCards()).map(F=>({id:F.tempId,cardNumber:"OFF",date:F.data.date,location:F.data.location,article:F.data.article,reporter:F.data.reporter,reason:F.data.reason,proposedAction:F.data.proposed_action,responsible:F.data.responsible,targetDate:F.data.target_date,solutionDate:F.data.solution_date,status:"Pendiente de subir",statusColor:"#94a3b8",type:F.data.type,imageBefore:F.files.imageBefore?URL.createObjectURL(F.files.imageBefore):null,imageAfter:F.files.imageAfter?URL.createObjectURL(F.files.imageAfter):null,companyId:F.data.company_id,isOffline:!0,timestamp:F.timestamp})),O.length>0&&m(O)}catch(C){console.error("DataContext: Error fetching offline cards:",C)}try{const C=setTimeout(()=>f.abort(),2e4),{data:F,error:o}=await U.from("five_s_cards").select("id, date, location, article, reporter, reason, proposed_action, responsible, target_date, solution_date, status, type, image_before, image_after, company_id, created_at, card_number").order("created_at",{ascending:!1}).abortSignal(f.signal);if(clearTimeout(C),o)throw o;if(F){const p=F.map(A=>({id:A.id,date:A.date,location:A.location,article:A.article,reporter:A.reporter,reason:A.reason,proposedAction:A.proposed_action,responsible:A.responsible,targetDate:A.target_date,solutionDate:A.solution_date,status:A.status,statusColor:A.status==="Cerrado"?"#10b981":A.status==="En Proceso"?"#f59e0b":"#ef4444",type:A.type,imageBefore:A.image_before,imageAfter:A.image_after,companyId:A.company_id,cardNumber:A.card_number||"?",isOffline:!1,createdAt:A.created_at})),D=[...O,...p];D.sort((A,T)=>{const V=A.isOffline?new Date(A.timestamp):A.createdAt?new Date(A.createdAt):new Date(0);return(T.isOffline?new Date(T.timestamp):T.createdAt?new Date(T.createdAt):new Date(0))-V}),m(D)}}catch(C){if(C.name==="AbortError")return;console.error("DataContext: Error fetching online 5S cards:",C.message)}finally{N.current===f&&(i(!1),N.current=null)}},[r]),S=j.useCallback(async()=>{if(!r){l([]),n([]),x([]),b(!1);return}b(!0);try{const[f,O,C]=await Promise.all([U.from("quick_wins").select("*"),U.from("vsm_projects").select("*"),U.from("a3_projects").select("*")]);f.data&&l(f.data.map(F=>({id:F.id,responsible:F.responsible,status:F.status,title:F.title,date:F.date,companyId:F.company_id}))),O.data&&n(O.data.map(F=>({id:F.id,responsible:F.responsible,status:F.status,name:F.name,date:F.date,companyId:F.company_id}))),C.data&&x(C.data.map(F=>({id:F.id,responsible:F.responsible,status:F.status,title:F.title,created_at:F.created_at,actionPlan:F.action_plan||[],companyId:F.company_id})))}catch(f){console.error("DataContext: Error fetching responsables data:",f)}finally{b(!1)}},[r]);j.useEffect(()=>{r?(console.log("DataContext: User detected, prefetching all data..."),k(),S()):(m([]),l([]),n([]),x([]),i(!1),b(!1))},[r,k,S]);const L=j.useCallback((f,O)=>{m(C=>C.map(F=>F.id===f?{...F,...O}:F))},[]),v=j.useCallback(f=>{m(O=>[f,...O])},[]),$=j.useCallback(f=>{m(O=>O.filter(C=>C.id!==f))},[]);return e.jsx(Ts.Provider,{value:{fiveSCards:d,loadingFiveS:s,fetchFiveSCards:k,updateFiveSCard:L,addFiveSCard:v,removeFiveSCard:$,quickWinsData:w,vsmData:z,a3Data:a,loadingResponsables:h,fetchResponsablesData:S},children:t})},Rs=()=>j.useContext(Ts),ve=({title:t,subtitle:r,children:d})=>{const{user:m,companies:s,globalFilterCompanyId:i,setGlobalFilterCompanyId:N}=Z(),w=m&&(m.role==="admin"||m.email==="ariel.mellag@gmail.com");return e.jsxs("header",{className:"page-header flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6 border-b border-gray-100 pb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 tracking-tight",children:t}),e.jsx("p",{className:"text-gray-500 font-medium mt-1",children:r})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[d,w&&e.jsxs("div",{className:"flex items-center gap-2 bg-white p-2 rounded-lg shadow-sm border border-gray-200 ml-auto md:ml-0",children:[e.jsx(os,{size:18,className:"text-gray-500"}),e.jsx("span",{className:"text-sm font-semibold text-gray-700 hidden sm:inline",children:"Empresa:"}),e.jsxs("select",{value:i,onChange:l=>N(l.target.value),className:"bg-transparent border-none text-sm font-medium text-gray-900 focus:ring-0 cursor-pointer outline-none",style:{minWidth:"150px"},children:[e.jsx("option",{value:"all",children:"Todas las Empresas"}),s.map(l=>e.jsx("option",{value:l.id,children:l.name},l.id))]})]})]})]})},Ft=()=>{const{user:t,companyUsers:r,globalFilterCompanyId:d}=Z(),{fiveSCards:m,quickWinsData:s,vsmData:i,a3Data:N,loadingResponsables:w,fetchResponsablesData:l,fetchFiveSCards:z}=Rs(),n=We(),[a,x]=j.useState(null),[h,b]=j.useState("all"),[k,S]=j.useState(!1),L=j.useMemo(()=>m.map(o=>({id:o.id,responsible:o.responsible,status:o.status,reason:o.reason,article:o.article,location:o.location,date:o.date,companyId:o.companyId})),[m]),v=j.useCallback(o=>{if(!t)return!1;if(o.responsible===t.name)return!0;const D=t.role==="admin"||t.email==="ariel.mellag@gmail.com"?d:t.companyId;return D==="all"?!0:o.companyId===D},[t,d]),$=j.useMemo(()=>{const o=new Set,D=(t==null?void 0:t.role)==="admin"||(t==null?void 0:t.email)==="ariel.mellag@gmail.com"?d:t==null?void 0:t.companyId;return r&&r.forEach(A=>{const T=D==="all"||A.company_id===D,V=A.role==="admin";T&&!V&&A.name&&o.add(A.name)}),[...L,...s,...i,...N].forEach(A=>{v(A)&&A.responsible&&o.add(A.responsible)}),Array.from(o).sort()},[r,L,s,i,N,t,d,v]),f=j.useMemo(()=>$.map(o=>{const p=L.filter(P=>P.responsible===o&&v(P)),D=s.filter(P=>P.responsible===o&&v(P)),A=i.filter(P=>P.responsible===o&&v(P)),T=N.filter(P=>P.responsible===o&&v(P)),V=[];N.filter(P=>v(P)).forEach(P=>{Array.isArray(P.actionPlan)&&P.actionPlan.forEach(G=>{G.responsible===o&&V.push({...G,projectId:P.id,...P.title?{projectTitle:P.title}:{}})})});const E=V.filter(P=>P.status==="pending").length,W=V.filter(P=>P.status==="done").length,B=p.filter(P=>P.status!=="Cerrado").length,I=D.filter(P=>P.status!=="done").length,c=T.filter(P=>P.status!=="Cerrado").length,R=A.filter(P=>P.status!=="completed").length,q=A.filter(P=>P.status==="completed").length,u=B+I+c+R+E,_=p.filter(P=>P.status==="Cerrado").length,g=D.filter(P=>P.status==="done").length,y=T.filter(P=>P.status==="Cerrado").length,M=_+g+y+q+W;return{name:o,totalPending:u,totalCompleted:M,breakdown:{fiveS:B,quickWins:I,vsm:R,a3:c,a3Actions:E},tasks:{fiveS:p,quickWins:D,vsm:A,a3:T,a3Actions:V}}}).sort((o,p)=>p.totalPending-o.totalPending),[$,L,s,i,N,v]),O=(o,p)=>p==="5S"?o.status==="Cerrado"?"completed":"pending":p==="QW"?o.status==="done"?"completed":"pending":p==="VSM"?o.status==="completed"?"completed":o.status==="current"?"in_progress":"pending":p==="A3"?o.status==="Cerrado"?"completed":"in_progress":p==="A3Act"&&o.status==="done"?"completed":"pending",C=(o,p)=>h==="all"?o:o.filter(D=>O(D,p)===h),F=f.slice(0,20).map(o=>({name:o.name?o.name.split(" ")[0]:"S/N",pendientes:o.totalPending,completadas:o.totalCompleted}));return e.jsxs("div",{className:"page-container",style:{position:"relative"},children:[e.jsx(ve,{title:"GestiÃ³n de Responsables",subtitle:"Seguimiento de carga de trabajo y desempeÃ±o"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsxs("div",{className:"card p-6 bg-gradient-to-br from-yellow-50 to-orange-50 border-orange-100 flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-white rounded-full shadow-sm text-yellow-500",children:e.jsx(Ws,{size:32})}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-bold text-orange-600 uppercase tracking-wider",children:"Mayor DesempeÃ±o"}),f.length>0?(()=>{const o=[...f].sort((p,D)=>D.totalCompleted-p.totalCompleted)[0];return e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-800",children:o.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:[o.totalCompleted," tareas resueltas"]})]})})():e.jsx("p",{className:"text-gray-400",children:"Sin datos"})]})]}),e.jsxs("div",{className:"card p-6 bg-gradient-to-br from-blue-50 to-indigo-50 border-blue-100 flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-white rounded-full shadow-sm text-blue-500",children:e.jsx(Fe,{size:32})}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-bold text-blue-600 uppercase tracking-wider",children:"Mayor Carga"}),f.length>0?e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-800",children:f[0].name}),e.jsxs("p",{className:"text-sm text-gray-600",children:[f[0].totalPending," pendientes"]})]}):e.jsx("p",{className:"text-gray-400",children:"Sin datos"})]})]}),e.jsxs("div",{className:"card p-6 bg-white flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-gray-100 rounded-full text-gray-500",children:e.jsx(Bs,{size:32})}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider",children:"Total Pendientes"}),e.jsx("h3",{className:"text-2xl font-bold text-gray-800",children:f.reduce((o,p)=>o+p.totalPending,0)})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-1 space-y-4",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-700 flex items-center gap-2",children:[e.jsx(re,{size:20})," Equipo"]}),e.jsx("div",{className:"space-y-3",children:f.map((o,p)=>e.jsxs("div",{className:`card p-4 cursor-pointer transition-all hover:translate-x-1 ${(a==null?void 0:a.name)===o.name?"ring-2 ring-blue-500 bg-blue-50":"hover:shadow-md"}`,onClick:()=>x(o),children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h4",{className:"font-bold text-gray-800",children:o.name}),o.totalPending===0?e.jsxs("span",{className:"bg-green-100 text-green-700 text-xs px-2 py-1 rounded-full font-bold flex items-center gap-1",children:[e.jsx(K,{size:12})," Al dÃ­a"]}):e.jsxs("span",{className:"bg-red-100 text-red-700 text-xs px-2 py-1 rounded-full font-bold",children:[o.totalPending," pendientes"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5 mb-2 overflow-hidden",children:e.jsx("div",{className:"bg-blue-500 h-1.5 rounded-full",style:{width:`${o.totalCompleted/(o.totalCompleted+o.totalPending||1)*100}%`}})}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-400",children:[e.jsxs("span",{children:[o.totalCompleted," resueltas"]}),e.jsxs("span",{children:["Total: ",o.totalCompleted+o.totalPending]})]})]},p))})]}),e.jsx("div",{className:"lg:col-span-2",children:a?e.jsxs("div",{className:"card p-6 h-full animate-fadeIn",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6 border-b pb-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-800 flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 text-lg",children:a.name.charAt(0)}),a.name]}),e.jsx("p",{className:"text-gray-500 mt-1 ml-14",children:"Detalle de asignaciones"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{disabled:k,onClick:async()=>{S(!0);try{let o="";if(r){const E=r.find(W=>W.name===a.name);E&&E.email&&(o=E.email)}if(!o){alert("No se encontrÃ³ el correo electrÃ³nico para este usuario."),S(!1);return}const D=[...(a.tasks.fiveS||[]).map(E=>({...E,type:"5S",title:`${E.article||"ArtÃ­culo"}, ${E.reason} en ${E.location||"Area"}`})),...(a.tasks.quickWins||[]).map(E=>({...E,type:"QW",title:`${E.title}`})),...(a.tasks.vsm||[]).map(E=>({...E,type:"VSM",title:`${E.name}`})),...(a.tasks.a3||[]).map(E=>({...E,type:"A3",title:`Proyecto: ${E.title}`})),...(a.tasks.a3Actions||[]).map(E=>({...E,type:"A3",title:`AcciÃ³n: ${E.what} (${E.projectTitle})`}))].filter(E=>E.status!=="Cerrado"&&E.status!=="done"&&E.status!=="completed"),A=window.location.origin,T=encodeURIComponent("Reporte de Estado Nexus Be Lean"),V=encodeURIComponent(`Hola ${a.name},

AquÃ­ tienes el resumen ejecutivo de tu carga de trabajo actual.
âœ… Tareas Completadas: ${a.totalCompleted}
âš ï¸ Tareas Pendientes:  ${a.totalPending}


Detalle de Tareas Pendientes:

${D.length>0?D.map(E=>`â€¢ [${E.type}] ${E.title} (${E.status})`).join(`
`):"â€¢ No hay tareas pendientes."}


ðŸ”— Accede a la plataforma:
${A}


Atentamente,
Nexus Jarvis System | CIAL Alimentos`);window.location.href=`mailto:${o}?subject=${T}&body=${V}`,S(!1),alert("Se ha abierto tu cliente de correo (Outlook) con el borrador generado.")}catch(o){console.error(o),alert("Error inesperado al enviar correo.")}finally{S(!1)}},className:"flex items-center gap-2 px-4 py-2 bg-indigo-50 text-indigo-600 rounded-lg hover:bg-indigo-100 font-bold transition-colors text-sm disabled:opacity-50 disabled:cursor-not-allowed",children:[k?e.jsx(Be,{size:16,className:"animate-spin"}):e.jsx(Ze,{size:16}),k?"Enviando...":"Enviar Recordatorio"]}),e.jsx("button",{onClick:()=>x(null),className:"text-gray-400 hover:text-gray-600 text-sm underline",children:"Volver al resumen"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-8",children:[e.jsxs("div",{className:"bg-red-50 p-4 rounded-lg text-center border border-red-100",children:[e.jsx("span",{className:"block text-2xl font-bold text-red-600",children:a.breakdown.fiveS}),e.jsx("span",{className:"text-xs font-bold text-red-400 uppercase",children:"Tarjetas 5S"})]}),e.jsxs("div",{className:"bg-amber-50 p-4 rounded-lg text-center border border-amber-100",children:[e.jsx("span",{className:"block text-2xl font-bold text-amber-600",children:a.breakdown.quickWins}),e.jsx("span",{className:"text-xs font-bold text-amber-400 uppercase",children:"Quick Wins"})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg text-center border border-blue-100",children:[e.jsx("span",{className:"block text-2xl font-bold text-blue-600",children:a.breakdown.a3+a.breakdown.a3Actions}),e.jsx("span",{className:"text-xs font-bold text-blue-400 uppercase",children:"Proyectos y Acciones A3"})]}),e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg text-center border border-purple-100",children:[e.jsx("span",{className:"block text-2xl font-bold text-purple-600",children:a.breakdown.vsm}),e.jsx("span",{className:"text-xs font-bold text-purple-400 uppercase",children:"Mapas VSM"})]})]}),e.jsxs("div",{className:"flex gap-2 mb-6 overflow-x-auto pb-2",children:[e.jsx("button",{onClick:()=>b("all"),className:`px-4 py-2 rounded-full text-sm font-medium transition-colors whitespace-nowrap ${h==="all"?"bg-slate-800 text-white":"bg-slate-100 text-slate-600 hover:bg-slate-200"}`,children:"Todas"}),e.jsx("button",{onClick:()=>b("completed"),className:`px-4 py-2 rounded-full text-sm font-medium transition-colors whitespace-nowrap ${h==="completed"?"bg-emerald-600 text-white":"bg-emerald-50 text-emerald-700 hover:bg-emerald-100"}`,children:"Completadas"}),e.jsx("button",{onClick:()=>b("in_progress"),className:`px-4 py-2 rounded-full text-sm font-medium transition-colors whitespace-nowrap ${h==="in_progress"?"bg-blue-600 text-white":"bg-blue-50 text-blue-700 hover:bg-blue-100"}`,children:"En Progreso"}),e.jsx("button",{onClick:()=>b("pending"),className:`px-4 py-2 rounded-full text-sm font-medium transition-colors whitespace-nowrap ${h==="pending"?"bg-red-500 text-white":"bg-red-50 text-red-700 hover:bg-red-100"}`,children:"Pendientes"})]}),e.jsxs("div",{className:"space-y-6",children:[C(a.tasks.fiveS,"5S").length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-bold text-gray-700 mb-3 flex items-center gap-2 border-b border-gray-100 pb-2",children:[e.jsx(Le,{size:16,className:"text-red-500"})," Hallazgos 5S (",a.tasks.fiveS.length,")"]}),e.jsx("ul",{className:"space-y-2",children:C(a.tasks.fiveS,"5S").map(o=>e.jsxs("li",{className:"flex justify-between items-center text-sm p-2 hover:bg-gray-50 rounded border border-transparent hover:border-gray-100 cursor-pointer transition-colors",onClick:()=>n(`/5s?cardId=${o.id}`),children:[e.jsx("span",{className:"text-gray-600 truncate flex-1 pr-4",children:o.reason}),e.jsx("span",{className:`text-xs font-bold px-2 py-0.5 rounded ${o.status==="Cerrado"?"bg-emerald-100 text-emerald-700":"bg-red-100 text-red-700"}`,children:o.status==="Cerrado"?"Completado":"Pendiente"})]},o.id))})]}),C(a.tasks.quickWins,"QW").length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-bold text-gray-700 mb-3 flex items-center gap-2 border-b border-gray-100 pb-2",children:[e.jsx(Fe,{size:16,className:"text-amber-500"})," Quick Wins (",a.tasks.quickWins.length,")"]}),e.jsx("ul",{className:"space-y-2",children:C(a.tasks.quickWins,"QW").map(o=>e.jsxs("li",{className:"flex justify-between items-center text-sm p-2 hover:bg-gray-50 rounded border border-transparent hover:border-gray-100 cursor-pointer transition-colors",onClick:()=>n(`/quick-wins?winId=${o.id}`),children:[e.jsx("span",{className:"text-gray-600 truncate flex-1 pr-4",children:o.title}),e.jsx("span",{className:`text-xs font-bold px-2 py-0.5 rounded ${o.status==="done"?"bg-emerald-100 text-emerald-700":"bg-red-100 text-red-700"}`,children:o.status==="done"?"Completado":"Pendiente"})]},o.id))})]})]}),C(a.tasks.a3,"A3").length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("h4",{className:"font-bold text-gray-700 mb-3 flex items-center gap-2 border-b border-gray-100 pb-2",children:[e.jsx(xs,{size:16,className:"text-blue-500"})," Proyectos A3 (",a.tasks.a3.length,")"]}),e.jsx("ul",{className:"space-y-2",children:C(a.tasks.a3,"A3").map(o=>e.jsxs("li",{className:"flex justify-between items-center text-sm p-2 hover:bg-gray-50 rounded border border-transparent hover:border-gray-100 cursor-pointer transition-colors",onClick:()=>n(`/a3?projectId=${o.id}`),children:[e.jsx("span",{className:"text-gray-600 truncate flex-1 pr-4",children:o.title}),e.jsx("span",{className:`text-xs font-bold px-2 py-0.5 rounded ${o.status==="Cerrado"?"bg-emerald-100 text-emerald-700":"bg-blue-100 text-blue-700"}`,children:o.status==="Cerrado"?"Completado":"En Progreso"})]},o.id))})]}),C(a.tasks.a3Actions,"A3Act").length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("h4",{className:"font-bold text-gray-700 mb-3 flex items-center gap-2 border-b border-gray-100 pb-2",children:[e.jsx(xs,{size:16,className:"text-blue-500"})," Actividades A3 (",a.tasks.a3Actions.length,")"]}),e.jsx("ul",{className:"space-y-2",children:C(a.tasks.a3Actions,"A3Act").map((o,p)=>e.jsxs("li",{className:"flex justify-between items-center text-sm p-2 hover:bg-gray-50 rounded border border-transparent hover:border-gray-100 cursor-pointer transition-colors",onClick:()=>n(`/a3?projectId=${o.projectId}`),children:[e.jsxs("div",{className:"flex-1 pr-4",children:[e.jsx("span",{className:"text-gray-600 block font-medium",children:o.activity}),e.jsxs("span",{className:"text-xs text-gray-400",children:["En proyecto: ",o.projectTitle]})]}),e.jsx("span",{className:`text-xs font-bold px-2 py-0.5 rounded ${o.status==="done"?"bg-emerald-100 text-emerald-700":"bg-red-100 text-red-700"}`,children:o.status==="done"?"Completado":"Pendiente"})]},`action-${p}-${o.id}`))})]}),C(a.tasks.vsm,"VSM").length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("h4",{className:"font-bold text-gray-700 mb-3 flex items-center gap-2 border-b border-gray-100 pb-2",children:[e.jsx(se,{size:16,className:"text-purple-500"})," Mapas VSM (",a.tasks.vsm.length,")"]}),e.jsx("ul",{className:"space-y-2",children:C(a.tasks.vsm,"VSM").map(o=>e.jsxs("li",{className:"flex justify-between items-center text-sm p-2 hover:bg-gray-50 rounded border border-transparent hover:border-gray-100 cursor-pointer transition-colors",onClick:()=>n(`/vsm?vsmId=${o.id}`),children:[e.jsx("span",{className:"text-gray-600 truncate flex-1 pr-4",children:o.name}),e.jsx("span",{className:`text-xs font-bold px-2 py-0.5 rounded ${o.status==="completed"?"bg-emerald-100 text-emerald-700":o.status==="current"?"bg-blue-100 text-blue-700":"bg-red-100 text-red-700"}`,children:o.status==="completed"?"Completado":o.status==="current"?"En Progreso":"Pendiente"})]},o.id))})]})]}):e.jsxs("div",{className:"card p-6 h-full flex flex-col",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-700 mb-6",children:"Panorama General del Equipo"}),e.jsx("div",{className:"flex-1 min-h-[350px]",style:{minHeight:"350px"},children:e.jsx(te,{width:"100%",height:"100%",children:e.jsxs(Je,{data:F,layout:"vertical",margin:{top:5,right:30,left:40,bottom:5},children:[e.jsx(ge,{strokeDasharray:"3 3",horizontal:!1}),e.jsx(he,{type:"number"}),e.jsx(be,{dataKey:"name",type:"category",width:80}),e.jsx(ne,{cursor:{fill:"#f3f4f6"}}),e.jsx(_e,{dataKey:"pendientes",name:"Pendientes",fill:"#ef4444",stackId:"a",radius:[0,4,4,0],barSize:15}),e.jsx(_e,{dataKey:"completadas",name:"Resueltas",fill:"#10b981",stackId:"a",radius:[0,4,4,0],barSize:15})]})})}),e.jsx("p",{className:"text-center text-xs text-gray-400 mt-4",children:"Top 20 usuarios por volumen de actividad"})]})})]})]})},je=({onUpload:t,currentImage:r,bucketName:d="images",placeholderText:m="Subir Imagen",onFileSelect:s=null})=>{const[i,N]=j.useState(!1),[w,l]=j.useState(r),z=async a=>{try{if(N(!0),!a.target.files||a.target.files.length===0)throw new Error("Debes seleccionar una imagen para subir.");const x=a.target.files[0],h=x.name.split(".").pop(),k=`${`${Math.random().toString(36).substring(2,15)}_${Date.now()}.${h}`}`;if(s){const $=URL.createObjectURL(x);l($),s(x,$);return}let{error:S}=await U.storage.from(d).upload(k,x);if(S)throw S;const{data:L}=U.storage.from(d).getPublicUrl(k),v=L.publicUrl;l(v),t(v)}catch(x){alert("Error subiendo imagen: "+x.message)}finally{N(!1)}},n=a=>{a.stopPropagation(),l(null),s?s(null,null):t&&t(null)};return e.jsxs("div",{className:"relative group w-full h-full min-h-[150px] flex flex-col items-center justify-center border-2 border-dashed border-gray-300 rounded-lg bg-gray-50 hover:bg-gray-100 transition-colors cursor-pointer overflow-hidden",children:[i?e.jsxs("div",{className:"flex flex-col items-center text-blue-500",children:[e.jsx(Vs,{className:"animate-spin mb-2",size:24}),e.jsx("span",{className:"text-xs font-medium",children:"Subiendo..."})]}):w?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:w,alt:"Preview",className:"absolute inset-0 w-full h-full object-contain"}),e.jsx("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:e.jsx("button",{onClick:n,className:"bg-red-500 text-white p-2 rounded-full hover:bg-red-600 transform hover:scale-110 transition-transform",title:"Eliminar imagen",children:e.jsx(ae,{size:20})})})]}):e.jsxs("div",{className:"text-center p-4",children:[e.jsx("div",{className:"bg-white p-3 rounded-full shadow-sm inline-block mb-3 group-hover:scale-110 transition-transform",children:e.jsx(Gs,{size:24,className:"text-blue-500"})}),e.jsx("p",{className:"text-sm font-medium text-gray-700",children:m}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Click para seleccionar"})]}),e.jsx("input",{type:"file",className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer disabled:cursor-not-allowed",accept:"image/*",onChange:z,disabled:i})]})},Lt=({isOpen:t,onClose:r})=>{const{user:d,logout:m}=Z(),[s,i]=j.useState(null),[N,w]=j.useState(!1);j.useEffect(()=>{d&&(async()=>{try{const{data:a}=await U.from("profiles").select("avatar_url").eq("id",d.id).maybeSingle();a&&a.avatar_url&&i(a.avatar_url)}catch(a){console.error("Error fetching avatar:",a)}})()},[d]);const l=async n=>{try{const{error:a}=await U.from("profiles").update({avatar_url:n}).eq("id",d.id);if(a)throw a;i(n)}catch(a){console.error("Error updating avatar:",a),alert("Error actualizando imagen de perfil")}},z=[{icon:Hs,label:"Dashboard",path:"/"},{icon:ze,label:"Consultor IA",path:"/consultant"},{icon:Ie,label:"Tarjetas 5S",path:"/5s"},{icon:Ks,label:"AuditorÃ­a 5S",path:"/auditorias-5s"},{icon:fe,label:"Proyectos A3",path:"/a3"},{icon:se,label:"VSM",path:"/vsm"},{icon:Ee,label:"Quick Wins",path:"/quick-wins"},{icon:Ss,label:"Responsables",path:"/responsables"}];return d&&d.role==="admin"&&z.push({icon:As,label:"AdministraciÃ³n",path:"/admin"}),e.jsxs(e.Fragment,{children:[t&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-40 md:hidden animate-in fade-in duration-200",onClick:r}),e.jsxs("aside",{className:`
                    fixed md:static inset-y-0 left-0 z-50
                    w-64 bg-sidebar text-sidebar-text flex flex-col h-screen border-r border-sidebar-border shadow-xl
                    transition-transform duration-300 ease-in-out
                    ${t?"translate-x-0":"-translate-x-full md:translate-x-0"}
                `,children:[e.jsxs("div",{className:"h-16 flex items-center justify-between px-6 border-b border-sidebar-border bg-sidebar/50 backdrop-blur-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:"/nexus-logo.svg",alt:"Nexus Logo",className:"w-10 h-10 object-contain drop-shadow-md hover:scale-105 transition-transform duration-300"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-bold text-white tracking-tight leading-none",children:"Nexus"}),e.jsx("span",{className:"text-xs font-medium text-brand-500 tracking-wider",children:"BE LEAN"})]})]}),e.jsx("button",{onClick:r,className:"md:hidden text-slate-400 hover:text-white",children:e.jsx(ae,{size:24})})]}),e.jsxs("nav",{className:"flex-1 overflow-y-auto py-6 px-3 space-y-1",children:[e.jsx("div",{className:"px-3 mb-2 text-xs font-bold text-slate-500 uppercase tracking-widest pl-4",children:"Menu Principal"}),e.jsx("div",{className:"space-y-1",children:z.map(n=>e.jsx(Os,{to:n.path,onClick:()=>r&&window.innerWidth<768&&r(),className:({isActive:a})=>`
                                    relative group flex items-center px-4 py-3 text-sm font-medium rounded-xl transition-colors duration-200 focus:outline-none focus:ring-0
                                    ${a?"bg-gradient-to-r from-brand-600/20 to-brand-600/5 text-brand-400 shadow-lg shadow-brand-900/20 border border-brand-500/10":"text-slate-400 hover:text-slate-100 hover:bg-white/5 border border-transparent"}
                                `,children:({isActive:a})=>e.jsxs(e.Fragment,{children:[a&&e.jsx("div",{className:"absolute left-0 top-1/2 -translate-y-1/2 w-1 h-8 bg-brand-500 rounded-r-full shadow-[0_0_12px_rgba(6,182,212,0.8)]"}),e.jsx(n.icon,{size:20,className:`mr-3 transition-transform duration-300 ${a?"text-brand-400 scale-110 drop-shadow-[0_0_8px_rgba(34,211,238,0.5)]":"text-slate-500 group-hover:text-slate-300 group-hover:scale-105"}`,strokeWidth:a?2.5:2}),e.jsx("span",{className:`tracking-wide ${a?"font-bold":""}`,children:n.label})]})},n.path))})]}),e.jsxs("div",{className:"p-4 border-t border-sidebar-border bg-sidebar/30",children:[e.jsxs("div",{className:"flex items-center gap-3 p-2 rounded-lg hover:bg-sidebar-hover transition-colors cursor-pointer group",onClick:()=>w(!0),title:"Cambiar Foto de Perfil",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-indigo-500 flex items-center justify-center text-white font-bold text-sm overflow-hidden border-2 border-slate-600/50 group-hover:border-brand-500/50 transition-colors",children:s?e.jsx("img",{src:s,alt:"Avatar",className:"w-full h-full object-cover"}):e.jsx("span",{children:d!=null&&d.name?d.name.charAt(0):"U"})}),e.jsx("div",{className:"absolute -bottom-1 -right-1 bg-sidebar border border-sidebar-border rounded-full p-0.5 text-slate-400 group-hover:text-brand-500 transition-colors",children:e.jsx(Re,{size:10})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-white truncate group-hover:text-brand-100 transition-colors",children:d==null?void 0:d.name}),e.jsx("p",{className:"text-xs text-slate-500 truncate",children:(d==null?void 0:d.role)==="admin"?"Administrador":"Usuario"})]})]}),e.jsxs("button",{onClick:m,className:"mt-2 w-full flex items-center justify-center gap-2 px-3 py-2 text-xs font-medium text-slate-400 hover:text-white hover:bg-red-500/10 hover:border-red-500/20 border border-transparent rounded-lg transition-all duration-200",children:[e.jsx(Qs,{size:14}),e.jsx("span",{children:"Cerrar SesiÃ³n"})]})]}),N&&e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4 animate-in fade-in duration-200",onClick:()=>w(!1),children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-6 w-full max-w-sm transform transition-all scale-100",onClick:n=>n.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"font-bold text-lg text-slate-800",children:"Foto de Perfil"}),e.jsx("button",{onClick:()=>w(!1),className:"text-slate-400 hover:text-slate-600 p-1 rounded-full hover:bg-slate-100 transition-colors",children:e.jsx(ae,{size:20})})]}),e.jsx("div",{className:"h-64 mb-6 rounded-xl overflow-hidden border-2 border-dashed border-slate-200 bg-slate-50 relative group",children:e.jsx(je,{currentImage:s,onUpload:l,bucketName:"images",placeholderText:"Subir nueva foto"})}),e.jsxs("div",{className:"flex justify-between items-center bg-slate-50 p-4 rounded-xl border border-slate-100 mb-6",children:[e.jsx("span",{className:"text-xs font-medium text-slate-500",children:"Avatares predefinidos:"}),e.jsx("div",{className:"flex gap-3",children:["https://cdn-icons-png.flaticon.com/512/3135/3135715.png","https://cdn-icons-png.flaticon.com/512/3135/3135768.png"].map((n,a)=>e.jsx("button",{onClick:()=>l(n),className:"w-10 h-10 rounded-full border-2 border-white shadow-sm ring-1 ring-slate-200 hover:ring-brand-500 hover:scale-110 transition-all duration-200 overflow-hidden",children:e.jsx("img",{src:n,className:"w-full h-full object-cover"})},a))})]}),e.jsx("button",{onClick:()=>w(!1),className:"w-full py-2.5 bg-brand-600 text-white rounded-xl hover:bg-brand-700 transition-colors font-medium text-sm shadow-md shadow-brand-500/20 active:scale-95 duration-200",children:"Guardar Cambios"})]})})]})]})},Ot=()=>{const[t,r]=j.useState(!1);return e.jsxs("div",{className:"flex h-screen w-screen overflow-hidden bg-slate-50 flex-col md:flex-row",children:[e.jsxs("div",{className:"md:hidden bg-sidebar text-white h-16 flex items-center justify-between px-4 shrink-0 z-30 shadow-md",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("img",{src:"/nexus-logo.svg",alt:"Nexus",className:"w-8 h-8"}),e.jsx("span",{className:"font-bold tracking-tight",children:"Nexus BE LEAN"})]}),e.jsx("button",{onClick:()=>r(!0),className:"p-2 hover:bg-white/10 rounded-lg transition-colors",children:e.jsx(Js,{size:24})})]}),e.jsx(Lt,{isOpen:t,onClose:()=>r(!1)}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 md:p-8 transition-all duration-300 relative w-full",children:e.jsx(ks,{})})]})},oe=({title:t,value:r,subtitle:d,icon:m,variant:s="blue",type:i="solid"})=>{const N={blue:"bg-blue-500 text-white shadow-blue-500/20",green:"bg-emerald-500 text-white shadow-emerald-500/20",orange:"bg-amber-500 text-white shadow-amber-500/20",red:"bg-red-500 text-white shadow-red-500/20",indigo:"bg-indigo-500 text-white shadow-indigo-500/20",purple:"bg-purple-500 text-white shadow-purple-500/20",yellow:"bg-yellow-500 text-white shadow-yellow-500/20"},w={blue:"bg-white border-blue-100 text-slate-800",green:"bg-white border-emerald-100 text-slate-800",orange:"bg-white border-amber-100 text-slate-800",red:"bg-white border-red-100 text-slate-800",indigo:"bg-white border-indigo-100 text-slate-800",purple:"bg-white border-purple-100 text-slate-800",yellow:"bg-white border-yellow-100 text-slate-800"},l={blue:"text-blue-500 bg-blue-50",green:"text-emerald-500 bg-emerald-50",orange:"text-amber-500 bg-amber-50",red:"text-red-500 bg-red-50",indigo:"text-indigo-500 bg-indigo-50",purple:"text-purple-500 bg-purple-50",yellow:"text-yellow-500 bg-yellow-50"};if(i==="solid"){const a=N[s]||N.blue;return e.jsxs("div",{className:`relative overflow-hidden rounded-2xl p-6 shadow-xl transition-all duration-300 hover:-translate-y-1 hover:shadow-2xl ${a}`,children:[e.jsxs("div",{className:"relative z-10 flex flex-col h-full justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium opacity-90 tracking-wide uppercase mb-1",children:t}),e.jsx("h3",{className:"text-4xl font-bold tracking-tight mb-2",children:r})]}),d&&e.jsx("p",{className:"text-sm font-medium opacity-80 bg-white/10 w-fit px-2 py-1 rounded backdrop-blur-sm",children:d})]}),e.jsx("div",{className:"absolute -right-4 -bottom-4 opacity-20 transform rotate-12 scale-150",children:m&&as.cloneElement(m,{size:100})}),e.jsx("div",{className:"absolute top-0 right-0 -mr-8 -mt-8 w-24 h-24 rounded-full bg-white/10 blur-xl"}),e.jsx("div",{className:"absolute bottom-0 left-0 -ml-8 -mb-8 w-24 h-24 rounded-full bg-black/10 blur-xl"})]})}const z=w[s]||w.blue,n=l[s]||l.blue;return e.jsxs("div",{className:`rounded-xl p-6 shadow-sm border transition-all duration-200 hover:shadow-md ${z}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-500 uppercase tracking-wider",children:t}),e.jsx("div",{className:"mt-2 flex items-baseline gap-2",children:e.jsx("span",{className:"text-3xl font-bold text-slate-900",children:r})})]}),e.jsx("div",{className:`p-3 rounded-xl ${n}`,children:m&&as.cloneElement(m,{size:24})})]}),d&&e.jsx("div",{className:"text-sm text-slate-500 font-medium",children:d})]})},Mt=()=>{const{user:t,globalFilterCompanyId:r}=Z(),[d,m]=j.useState({fiveS:[],quickWins:[],vsms:[],a3:[]}),[s,i]=j.useState(!1),N=()=>{const a=window.document,x=a.documentElement,h=x.requestFullscreen||x.mozRequestFullScreen||x.webkitRequestFullScreen||x.msRequestFullscreen,b=a.exitFullscreen||a.mozCancelFullScreen||a.webkitExitFullscreen||a.msExitFullscreen;!a.fullscreenElement&&!a.mozFullScreenElement&&!a.webkitFullscreenElement&&!a.msFullscreenElement?h?h.call(x).then(()=>{i(!0)}).catch(k=>{console.error(`Error attempting to enable full-screen mode: ${k.message} (${k.name})`),alert("No se pudo entrar en modo pantalla completa. Es posible que tu navegador lo haya bloqueado.")}):alert("Tu navegador no soporta el modo pantalla completa."):b&&b.call(a).then(()=>{i(!1)}).catch(k=>{console.error(`Error attempting to exit full-screen mode: ${k.message}`)})};j.useEffect(()=>{function a(){const x=!!(document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement);i(x)}return document.addEventListener("fullscreenchange",a),document.addEventListener("webkitfullscreenchange",a),document.addEventListener("mozfullscreenchange",a),document.addEventListener("MSFullscreenChange",a),()=>{document.removeEventListener("fullscreenchange",a),document.removeEventListener("webkitfullscreenchange",a),document.removeEventListener("mozfullscreenchange",a),document.removeEventListener("MSFullscreenChange",a)}},[]),j.useEffect(()=>{(async()=>{if(t)try{const[x,h,b,k]=await Promise.all([U.from("five_s_cards").select("id, created_at, status, reason, responsible, company_id, date, location, article, type, proposed_action"),U.from("quick_wins").select("id, title, status, company_id, responsible, date, impact, description"),U.from("vsm_projects").select("id, company_id"),U.from("a3_projects").select("id, company_id, title, status, responsible, created_at, action_plan, follow_up_data")]),S=x.data?x.data.map(f=>({id:f.id,status:f.status,reason:f.reason,responsible:f.responsible,companyId:f.company_id,date:f.date,location:f.location||f.area,article:f.article})):[],L=h.data?h.data.map(f=>({id:f.id,title:f.title,description:f.description,status:f.status,companyId:f.company_id,responsible:f.responsible,date:f.date,impact:f.impact})):[],v=b.data?b.data.map(f=>({id:f.id,companyId:f.company_id})):[],$=k.data?k.data.map(f=>({id:f.id,companyId:f.company_id,title:f.title,status:f.status,responsible:f.responsible,created_at:f.created_at,actionPlan:f.action_plan||[],followUpData:Array.isArray(f.follow_up_data)?f.follow_up_data:f.follow_up_data&&Object.keys(f.follow_up_data).length>0?[f.follow_up_data]:[]})):[];m({fiveS:S,quickWins:L,vsms:v,a3:$})}catch(x){console.error("Error loading dashboard data:",x)}})()},[t,r]);const w=j.useMemo(()=>{if(!t)return{fiveS:[],quickWins:[],vsms:[],a3:[]};const x=t.role==="admin"||t.email==="ariel.mellag@gmail.com"?r:t.companyId,h=b=>Array.isArray(b)?x==="all"?b:b.filter(k=>k.companyId&&k.companyId===x):[];return{fiveS:h(d.fiveS),quickWins:h(d.quickWins),vsms:h(d.vsms),a3:h(d.a3)}},[t,r,d]),l=j.useMemo(()=>{const{fiveS:a,quickWins:x,vsms:h,a3:b}=w,k=a.filter(A=>A.status==="Cerrado").length,S=a.length,L=a.filter(A=>A.status==="Pendiente").length,v=a.filter(A=>A.status==="En Proceso").length,$=S>0?Math.round(k/S*100):0,f=x.filter(A=>A.status==="done").length,O=x.length,C=x.filter(A=>A.impact==="Alto").length,F=h.length;let o=0,p=0;b.forEach(A=>{Array.isArray(A.actionPlan)&&(o+=A.actionPlan.length,p+=A.actionPlan.filter(T=>T.status==="done").length)});const D=o>0?Math.round(p/o*100):0;return{fiveS:{total:S,closed:k,pending:L,inProcess:v,rate:$},quickWins:{total:O,done:f,impact:C},vsm:{count:F},a3:{total:b.length,closed:b.filter(A=>A.status==="Cerrado").length,rate:D}}},[w]),z=j.useMemo(()=>{const a=[];return w.a3.forEach(x=>{x.followUpData&&Array.isArray(x.followUpData)&&x.followUpData.forEach(h=>{var k;if(h.showInDashboard!==!1&&h.dataPoints&&h.dataPoints.length>0){let S=[];if(h.kpiType==="oee"){const v=h.oeeConfig||{standardSpeed:100};S=h.dataPoints.map($=>{const f=parseFloat($.availableTime)||0,O=parseFloat($.productiveTime)||0,C=parseFloat($.producedPieces)||0,F=parseFloat($.defectPieces)||0,o=parseFloat(v.standardSpeed)||100,p=f>0?O/f*100:0,D=O*o,A=D>0?C/D*100:0,T=C>0?(C-F)/C*100:0,V=p*A*T/1e4;return{date:$.date,value:Math.round(V*10)/10}})}else S=h.dataPoints.map(v=>({date:v.date,value:v.value!==null&&v.value!==void 0?parseFloat(v.value):0}));const L=S.sort((v,$)=>new Date(v.date)-new Date($.date));a.push({uniqueId:`${x.id}-${h.id}`,projectId:x.id,projectTitle:x.title,responsible:x.responsible,kpiName:h.kpiName||"KPI Sin Nombre",goal:h.kpiGoal,isPercentage:h.kpiType==="oee"?!0:h.isPercentage,data:L,lastValue:(k=L[L.length-1])==null?void 0:k.value})}})}),a},[w]),n=[{name:"Pendiente",value:l.fiveS.pending,color:"#ef4444"},{name:"En Proceso",value:l.fiveS.inProcess,color:"#f59e0b"},{name:"Cerrado",value:l.fiveS.closed,color:"#10b981"}].filter(a=>a.value>0);return t?e.jsxs("div",{className:"max-w-7xl mx-auto space-y-8 animate-in fade-in duration-500 pb-12",children:[e.jsxs("div",{className:"flex flex-col xl:flex-row justify-between xl:items-end gap-4",children:[e.jsx("div",{className:"flex-1 w-full",children:e.jsx(ve,{title:"Dashboard General",subtitle:"VisiÃ³n global del desempeÃ±o operativo (KPIs)"})}),e.jsxs("button",{onClick:N,className:"flex items-center gap-2 px-4 py-2.5 bg-white text-slate-600 border border-slate-200 rounded-xl hover:bg-slate-50 hover:text-indigo-600 hover:border-indigo-100 transition-all shadow-sm font-bold text-sm whitespace-nowrap mb-1",children:[s?e.jsx(is,{size:18}):e.jsx(ds,{size:18}),s?"Salir Pantalla Completa":"Modo Pantalla Completa"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(oe,{title:"Tarjetas 5S",value:l.fiveS.total,subtitle:`${l.fiveS.rate}% Cumplimiento`,icon:e.jsx(Ie,{}),variant:"red",type:"solid"}),e.jsx(oe,{title:"Quick Wins",value:l.quickWins.done,subtitle:`de ${l.quickWins.total} Ideas Registradas`,icon:e.jsx(Ee,{size:28}),variant:"yellow",type:"solid"}),e.jsx(oe,{title:"Mapas VSM",value:l.vsm.count,subtitle:"Flujos de Valor Analizados",icon:e.jsx(se,{size:28}),variant:"purple",type:"solid"}),e.jsx(oe,{title:"Impacto Alto",value:l.quickWins.impact,subtitle:"Mejoras de Alto Impacto",icon:e.jsx(ie,{size:28}),variant:"green",type:"solid"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"col-span-1 lg:col-span-3 grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-[0_8px_30px_rgb(0,0,0,0.04)] border border-slate-100 flex flex-col items-center relative overflow-hidden h-[280px]",children:[e.jsxs("h4",{className:"text-sm font-bold text-slate-500 uppercase tracking-wider mb-4 z-10 flex items-center gap-2",children:[e.jsx(Ie,{size:16})," Completado 5S"]}),e.jsxs("div",{className:"w-full flex-1 relative z-10",children:[e.jsx(te,{width:"100%",height:"100%",children:e.jsx(De,{children:e.jsxs(Te,{data:[{value:l.fiveS.rate},{value:100-l.fiveS.rate}],cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,startAngle:90,endAngle:-270,dataKey:"value",stroke:"none",children:[e.jsx(ue,{fill:"#10b981"})," ",e.jsx(ue,{fill:"#f1f5f9"})," "]})})}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center pointer-events-none",children:[e.jsxs("span",{className:"text-4xl font-black text-emerald-500",children:[l.fiveS.rate,"%"]}),e.jsx("span",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest mt-1",children:"Avance"})]})]}),e.jsx("div",{className:"absolute -bottom-6 -right-6 opacity-5 rotate-12",children:e.jsx(Ie,{size:120,className:"text-emerald-500"})})]}),e.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-[0_8px_30px_rgb(0,0,0,0.04)] border border-slate-100 flex flex-col items-center relative overflow-hidden h-[280px]",children:[e.jsxs("h4",{className:"text-sm font-bold text-slate-500 uppercase tracking-wider mb-4 z-10 flex items-center gap-2",children:[e.jsx(Ee,{size:16})," Quick Wins"]}),e.jsxs("div",{className:"w-full flex-1 relative z-10",children:[e.jsx(te,{width:"100%",height:"100%",children:e.jsx(De,{children:e.jsxs(Te,{data:[{value:l.quickWins.total>0?Math.round(l.quickWins.done/l.quickWins.total*100):0},{value:100-(l.quickWins.total>0?Math.round(l.quickWins.done/l.quickWins.total*100):0)}],cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,startAngle:90,endAngle:-270,dataKey:"value",stroke:"none",children:[e.jsx(ue,{fill:"#f59e0b"})," ",e.jsx(ue,{fill:"#f1f5f9"})]})})}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center pointer-events-none",children:[e.jsxs("span",{className:"text-4xl font-black text-amber-500",children:[l.quickWins.total>0?Math.round(l.quickWins.done/l.quickWins.total*100):0,"%"]}),e.jsx("span",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest mt-1",children:"Implementado"})]})]}),e.jsx("div",{className:"absolute -bottom-6 -right-6 opacity-5 rotate-12",children:e.jsx(Ee,{size:120,className:"text-amber-500"})})]}),e.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-[0_8px_30px_rgb(0,0,0,0.04)] border border-slate-100 flex flex-col items-center relative overflow-hidden h-[280px]",children:[e.jsxs("h4",{className:"text-sm font-bold text-slate-500 uppercase tracking-wider mb-4 z-10 flex items-center gap-2",children:[e.jsx(se,{size:16})," Proyectos A3"]}),e.jsxs("div",{className:"w-full flex-1 relative z-10",children:[e.jsx(te,{width:"100%",height:"100%",children:e.jsx(De,{children:e.jsxs(Te,{data:[{value:l.a3.rate},{value:100-l.a3.rate}],cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,startAngle:90,endAngle:-270,dataKey:"value",stroke:"none",children:[e.jsx(ue,{fill:"#6366f1"})," ",e.jsx(ue,{fill:"#f1f5f9"})]})})}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center pointer-events-none",children:[e.jsxs("span",{className:"text-4xl font-black text-indigo-500",children:[l.a3.rate,"%"]}),e.jsx("span",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest mt-1",children:"Avance"})]})]}),e.jsx("div",{className:"absolute -bottom-6 -right-6 opacity-5 rotate-12",children:e.jsx(se,{size:120,className:"text-indigo-500"})})]})]}),e.jsxs("div",{className:"col-span-full",children:[e.jsxs("h3",{className:"text-lg font-bold text-slate-700 mb-6 flex items-center gap-2",children:[e.jsx(se,{size:20,className:"text-indigo-600"})," Monitoreo de KPIs (Proyectos A3)"]}),z.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:z.map((a,x)=>{var f;const h=((f=a.data[0])==null?void 0:f.value)||0,b=parseFloat(a.lastValue)||0,k=h!==0?(b-h)/h*100:0,S=k>=0,L=`${S?"+":""}${Math.round(k)}% vs. inicio`,v=[{stop1:"#8b5cf6",stop2:"#c4b5fd",stroke:"#7c3aed",bg:"bg-purple-50",text:"text-purple-600"},{stop1:"#10b981",stop2:"#6ee7b7",stroke:"#059669",bg:"bg-emerald-50",text:"text-emerald-600"},{stop1:"#f59e0b",stop2:"#fcd34d",stroke:"#d97706",bg:"bg-amber-50",text:"text-amber-600"}],$=v[x%v.length];return e.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-[0_8px_30px_rgb(0,0,0,0.04)] hover:shadow-[0_8px_30px_rgb(0,0,0,0.08)] transition-all border border-slate-100 flex flex-col justify-between h-[300px]",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"font-bold text-slate-500 text-sm",children:a.kpiName}),e.jsx("div",{className:"mt-2 flex items-baseline gap-2",children:e.jsxs("span",{className:`text-4xl font-black ${$.text}`,children:[a.lastValue,a.isPercentage?"%":""]})}),e.jsx("div",{className:"mt-1 flex items-center gap-1.5 text-xs font-bold text-slate-400",children:e.jsx("span",{className:`${S?"text-emerald-500":"text-rose-500"}`,children:L})})]}),e.jsx("div",{className:`w-10 h-10 rounded-full ${$.bg} flex items-center justify-center ${$.text}`,children:e.jsx(se,{size:20})})]}),e.jsx("div",{className:"flex-1 w-full min-h-[120px] -mx-2",children:e.jsx(te,{width:"100%",height:"100%",children:e.jsxs(zs,{data:a.data,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:`gradient-${a.uniqueId}`,x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:$.stop1,stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:$.stop1,stopOpacity:0})]})}),e.jsx(he,{dataKey:"date",hide:!0}),e.jsx(ne,{contentStyle:{borderRadius:"12px",border:"none",boxShadow:"0 4px 10px rgba(0,0,0,0.1)",fontSize:"12px"},formatter:O=>[a.isPercentage?`${O}%`:O,"Valor"],labelFormatter:O=>new Date(O).toLocaleDateString()}),e.jsx(Es,{type:"monotone",dataKey:"value",stroke:$.stroke,strokeWidth:3,fill:`url(#gradient-${a.uniqueId})`,activeDot:{r:6,strokeWidth:2,stroke:"#fff"}})]})})}),e.jsxs("div",{className:"flex justify-between text-[10px] text-slate-300 font-bold uppercase tracking-wider mt-2 border-t border-slate-50 pt-2",children:[e.jsx("span",{children:a.data[0]?new Date(a.data[0].date).toLocaleDateString("es-ES",{month:"short"}):""}),e.jsx("span",{children:a.projectTitle}),e.jsx("span",{children:a.data[a.data.length-1]?new Date(a.data[a.data.length-1].date).toLocaleDateString("es-ES",{month:"short"}):""})]})]},a.uniqueId)})}):e.jsxs("div",{className:"bg-slate-50 border-2 border-dashed border-slate-200 rounded-2xl p-12 text-center",children:[e.jsx(se,{size:48,className:"text-slate-200 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-400 font-medium",children:"No hay grÃ¡ficos de seguimiento activos"}),e.jsx("p",{className:"text-xs text-slate-300",children:'Crea un A3 y aÃ±ade grÃ¡ficos con "Mostrar en Dashboard" activo.'})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-[0_8px_30px_rgb(0,0,0,0.04)] hover:shadow-[0_8px_30px_rgb(0,0,0,0.08)] transition-all border border-slate-100 lg:col-span-1 flex flex-col justify-between",children:[e.jsxs("h4",{className:"text-sm font-bold text-slate-500 uppercase tracking-wider mb-6 z-10 flex items-center gap-2",children:[e.jsx(K,{size:16,className:"text-emerald-500"})," Estado de Hallazgos 5S"]}),e.jsx("div",{className:"h-72 w-full flex items-center justify-center -mt-4",children:n.length>0?e.jsx(te,{width:"100%",height:"100%",children:e.jsxs(De,{children:[e.jsx(Te,{data:n,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"value",stroke:"none",children:n.map((a,x)=>e.jsx(ue,{fill:a.color},`cell-${x}`))}),e.jsx(ne,{contentStyle:{borderRadius:"12px",border:"none",boxShadow:"0 10px 15px -3px rgba(0, 0, 0, 0.1)",fontSize:"12px"}}),e.jsx(Pe,{verticalAlign:"bottom",align:"center",iconType:"circle",wrapperStyle:{fontSize:"12px",fontWeight:"500",color:"#64748b"}})]})}):e.jsxs("div",{className:"flex flex-col items-center justify-center text-gray-400 p-8 border-2 border-dashed border-gray-100 rounded-xl bg-gray-50/50 w-full h-full",children:[e.jsx(se,{size:48,className:"mb-4 opacity-20"}),e.jsx("p",{className:"font-medium",children:"Sin datos suficientes"}),e.jsx("p",{className:"text-sm",children:"Agrega auditorÃ­as o tarjetas"})]})})]}),e.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-[0_8px_30px_rgb(0,0,0,0.04)] hover:shadow-[0_8px_30px_rgb(0,0,0,0.08)] transition-all border border-slate-100 lg:col-span-2 flex flex-col",children:[e.jsx("h4",{className:"text-sm font-bold text-slate-500 uppercase tracking-wider mb-6 z-10 flex items-center gap-2",children:"Actividad Reciente"}),e.jsxs("div",{className:"flex-1 overflow-y-auto pr-2 custom-scrollbar max-h-[290px] relative pl-2 pt-2",children:[e.jsx("div",{className:"absolute left-6 top-4 bottom-4 w-0.5 bg-slate-100 z-0"}),(()=>{const a=[...w.fiveS.map(x=>({...x,type:"5S",rawDate:x.date,label:"Reporte 5S",icon:e.jsx(Ie,{size:14}),color:"text-emerald-500 bg-emerald-50 border-emerald-100"})),...w.quickWins.map(x=>({...x,type:"QW",rawDate:x.date,label:"Quick Win",icon:e.jsx(Ee,{size:14}),color:"text-amber-500 bg-amber-50 border-amber-100"})),...w.a3.map(x=>({...x,type:"A3",rawDate:x.created_at||new Date().toISOString(),label:"Proyecto A3",icon:e.jsx(se,{size:14}),color:"text-indigo-500 bg-indigo-50 border-indigo-100"}))].sort((x,h)=>new Date(h.rawDate)-new Date(x.rawDate)).slice(0,10);return a.length===0?e.jsx("div",{className:"text-center py-12 text-slate-400",children:"Sin actividad reciente."}):a.map((x,h)=>{const b=x.responsible?x.responsible.split(" ").map($=>$[0]).join("").substring(0,2).toUpperCase():"NA",k=new Date(x.rawDate),S=isNaN(k.getTime())?"Reciente":k.toLocaleDateString("es-ES",{day:"numeric",month:"short"});let L="actualizÃ³",v=x.title||x.reason||"Sin TÃ­tulo";if(x.type==="5S"){const $=[];x.location&&$.push(x.location),x.article&&$.push(x.article),x.reason&&$.push(x.reason),$.length>0&&(v=$.join(" â€¢ ")),x.status==="Pendiente"?L="detectÃ³ hallazgo en":x.status==="Cerrado"?L="cerrÃ³ hallazgo en":L="trabaja en"}else if(x.type==="QW"){const $=[x.title];x.description&&$.push(x.description),v=$.join(": "),x.status==="done"?L="implementÃ³ idea":L="propuso idea"}return e.jsxs("div",{className:"relative pl-12 pb-6 last:pb-0 z-10 group",children:[e.jsx("div",{className:"absolute left-0 top-0 w-10 h-10 rounded-full border-4 border-white shadow-sm bg-slate-100 flex items-center justify-center text-[10px] font-black text-slate-500 z-10",children:b}),e.jsxs("div",{className:"bg-white border border-slate-100 rounded-xl p-3 shadow-sm hover:shadow-md transition-shadow relative top-1",children:[e.jsx("div",{className:"flex justify-between items-start mb-1",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`text-[10px] px-1.5 py-0.5 rounded font-bold uppercase flex items-center gap-1 ${x.color}`,children:[x.icon," ",x.type]}),e.jsx("span",{className:"text-[10px] text-slate-400 font-medium",children:S})]})}),e.jsxs("p",{className:"text-xs text-slate-600 leading-relaxed",children:[e.jsx("span",{className:"font-bold text-slate-800",children:x.responsible||"Usuario"})," ",L," ",e.jsxs("span",{className:"font-medium italic text-slate-500",children:['"',v,'"']})]}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${x.status==="done"||x.status==="Cerrado"?"bg-emerald-400":"bg-amber-400"}`}),e.jsx("span",{className:"text-[10px] text-slate-400 capitalize",children:x.status})]})]})]},`${x.type}-${x.id}-${h}`)})})()]})]})]})]}):e.jsx("div",{className:"flex h-screen items-center justify-center text-slate-400",children:"Cargando..."})},Ve=[{id:"man",label:"Mano de Obra",color:"border-blue-200 bg-blue-50 text-blue-700 hover:bg-blue-100",dot:"bg-blue-500"},{id:"machine",label:"MÃ¡quina",color:"border-red-200 bg-red-50 text-red-700 hover:bg-red-100",dot:"bg-red-500"},{id:"material",color:"border-emerald-200 bg-emerald-50 text-emerald-700 hover:bg-emerald-100",dot:"bg-emerald-500"},{id:"method",label:"MÃ©todo",color:"border-purple-200 bg-purple-50 text-purple-700 hover:bg-purple-100",dot:"bg-purple-500"},{id:"measurement",label:"MediciÃ³n",color:"border-amber-200 bg-amber-50 text-amber-700 hover:bg-amber-100",dot:"bg-amber-500"},{id:"environment",label:"Medio Ambiente",color:"border-cyan-200 bg-cyan-50 text-cyan-700 hover:bg-cyan-100",dot:"bg-cyan-500"}],we={neutral:{color:"bg-slate-200",ring:"ring-slate-300",label:"Sin priorizar",next:"green",shadow:"shadow-slate-200"},green:{color:"bg-emerald-500",ring:"ring-emerald-400",label:"Si ocurre y Si puede ser abordada",next:"yellow",shadow:"shadow-emerald-200"},yellow:{color:"bg-amber-400",ring:"ring-amber-300",label:"Ocurre ocasionalmente",next:"red",shadow:"shadow-amber-200"},red:{color:"bg-rose-500",ring:"ring-rose-400",label:"No ocurre / No abordable",next:"neutral",shadow:"shadow-rose-200"}},qt=({data:t,onChange:r,onDelete:d,index:m})=>{const[s,i]=j.useState(!1),N=a=>typeof a=="string"?{text:a,color:"neutral"}:{text:a.text,color:a.color||"neutral"},w=a=>{var b;const x=((b=t.categories)==null?void 0:b[a])||[],h=prompt(`Agregar causa para ${Ve.find(k=>k.id===a).label}:`);if(h){const k={...t.categories,[a]:[...x,{text:h,color:"neutral"}]};r("categories",k)}},l=(a,x)=>{var S;const b=(((S=t.categories)==null?void 0:S[a])||[]).filter((L,v)=>v!==x),k={...t.categories,[a]:b};r("categories",k)},z=(a,x)=>{var $;const h=(($=t.categories)==null?void 0:$[a])||[],b=h[x],k=N(b),S=we[k.color].next,L=[...h];L[x]={...k,color:S};const v={...t.categories,[a]:L};r("categories",v)},n=Ve.flatMap(a=>{var x;return(((x=t.categories)==null?void 0:x[a.id])||[]).map(h=>{const{text:b}=N(h);return{category:a.label,cause:b}})});return e.jsxs("div",{className:`
            card animate-in fade-in zoom-in-95 duration-300 rounded-2xl overflow-hidden bg-white shadow-sm border border-slate-200 transition-all
            ${s?"fixed inset-0 z-[100] m-0 rounded-none h-screen flex flex-col":""}
        `,children:[e.jsxs("div",{className:"bg-slate-900 px-6 py-4 flex justify-between items-center text-white relative overflow-hidden shrink-0",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-slate-900 to-slate-800"}),e.jsxs("div",{className:"flex items-center gap-3 relative z-10",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-cyan-500/20 flex items-center justify-center border border-cyan-500/30",children:e.jsx(Ys,{size:18,className:"text-cyan-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-sm tracking-wide",children:"DIAGRAMA DE ISHIKAWA / ESPINA DE PESCADO"}),e.jsxs("span",{className:"text-[10px] text-slate-400 uppercase tracking-widest font-semibold",children:["AnÃ¡lisis #",m+1]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 relative z-10",children:[e.jsx("button",{onClick:()=>i(!s),className:"text-slate-300 hover:text-white hover:bg-slate-700/50 p-2 rounded-lg transition-all",title:s?"Salir de Pantalla Completa":"Pantalla Completa",children:s?e.jsx(is,{size:18}):e.jsx(ds,{size:18})}),d&&e.jsxs("button",{onClick:d,className:"text-rose-300 hover:text-white hover:bg-rose-500/20 px-3 py-1.5 rounded-lg text-xs font-medium flex items-center gap-2 transition-all active:scale-95",children:[e.jsx(ae,{size:14})," Eliminar"]})]})]}),e.jsxs("div",{className:`p-8 bg-slate-50/50 relative overflow-auto ${s?"flex-1 flex items-center justify-center":""}`,children:[e.jsxs("div",{className:`min-w-[900px] max-w-full mx-auto relative pb-10 pt-4 ${s?"scale-110 transform origin-center":""}`,children:[e.jsx("div",{className:"absolute top-1/2 left-0 right-[240px] h-1 bg-slate-400 rounded-full z-0 shadow-sm"}),e.jsx("div",{className:"absolute top-1/2 right-[240px] w-4 h-4 rounded-full bg-slate-400 -mt-1.5 z-0"}),e.jsx("div",{className:"absolute top-1/2 right-0 transform -translate-y-1/2 z-20 w-[240px] h-[180px] flex items-center",children:e.jsxs("div",{className:"bg-white border-2 border-slate-200 shadow-xl rounded-2xl p-6 w-full h-full flex flex-col justify-center items-center relative overflow-hidden group",children:[e.jsx("div",{className:"absolute top-0 left-0 w-2 h-full bg-brand-500"}),e.jsx("label",{className:"text-slate-900 text-[10px] font-bold uppercase tracking-widest mb-3",children:"Problema Central"}),e.jsx("textarea",{className:"w-full h-full bg-transparent border-none text-black placeholder-slate-400 text-sm font-bold text-center focus:ring-0 resize-none overflow-hidden leading-relaxed",rows:"4",placeholder:"Describa el problema...",value:t.problem||"",onChange:a=>r("problem",a.target.value)})]})}),e.jsxs("div",{className:"grid grid-cols-3 gap-x-12 gap-y-24 pr-[260px] relative z-10 ml-10",children:[Ve.slice(0,3).map(a=>{var x;return e.jsxs("div",{className:"h-56 flex flex-col justify-end items-center relative group px-4",children:[e.jsx("div",{className:"absolute bottom-0 left-1/2 w-0.5 h-[120%] bg-slate-300 origin-bottom transform -rotate-[30deg] group-hover:bg-brand-200 transition-colors"}),e.jsx("div",{className:`relative mb-3 px-4 py-1.5 rounded-full text-xs font-bold border shadow-sm z-20 transition-all cursor-default ${a.color} active:scale-95`,children:a.label}),e.jsxs("div",{className:"z-20 w-full flex flex-col gap-2 items-end pr-6",children:[(((x=t.categories)==null?void 0:x[a.id])||[]).map((h,b)=>{const{text:k,color:S}=N(h);return e.jsxs("div",{className:"relative group/chip bg-white border border-slate-200 text-slate-900 text-xs pl-2 pr-2 py-1.5 rounded-lg shadow-sm hover:shadow-md transition-all w-full flex items-center justify-between gap-2 hover:-translate-y-0.5",children:[e.jsx("span",{className:"flex-grow text-right break-words leading-tight text-[11px] font-bold text-black",children:k}),e.jsx("button",{onClick:()=>z(a.id,b),className:`w-2.5 h-2.5 rounded-full flex-shrink-0 ${we[S].color} ring-2 ${we[S].ring} hover:scale-125 transition-transform shadow-sm`,title:`Prioridad: ${we[S].label}`}),e.jsx("button",{onClick:()=>l(a.id,b),className:"absolute -top-2 -right-2 bg-white border border-red-100 text-red-500 rounded-full w-5 h-5 flex items-center justify-center opacity-0 group-hover/chip:opacity-100 shadow-sm z-30 hover:bg-red-50 transition-all",children:e.jsx(ae,{size:10,strokeWidth:3})})]},b)}),e.jsx("button",{onClick:()=>w(a.id),className:"self-end mt-1 text-slate-400 hover:text-brand-600 hover:bg-brand-50 border border-dashed border-slate-300 hover:border-brand-200 rounded-full p-1.5 transition-all",title:"Agregar Causa",children:e.jsx(J,{size:12,strokeWidth:3})})]})]},a.id)}),Ve.slice(3,6).map(a=>{var x;return e.jsxs("div",{className:"h-56 flex flex-col justify-start items-center relative group px-4 mt-4",children:[e.jsx("div",{className:"absolute top-0 left-1/2 w-0.5 h-[120%] bg-slate-300 origin-top transform rotate-[30deg] group-hover:bg-brand-200 transition-colors"}),e.jsx("div",{className:`relative mt-3 px-4 py-1.5 rounded-full text-xs font-bold border shadow-sm z-20 transition-all cursor-default ${a.color} order-last active:scale-95`,children:a.label}),e.jsxs("div",{className:"z-20 w-full flex flex-col gap-2 items-end pr-6 pt-6 mb-2",children:[(((x=t.categories)==null?void 0:x[a.id])||[]).map((h,b)=>{const{text:k,color:S}=N(h);return e.jsxs("div",{className:"relative group/chip bg-white border border-slate-200 text-slate-900 text-xs pl-2 pr-2 py-1.5 rounded-lg shadow-sm hover:shadow-md transition-all w-full flex items-center justify-between gap-2 hover:-translate-y-0.5",children:[e.jsx("span",{className:"flex-grow text-right break-words leading-tight text-[11px] font-bold text-black",children:k}),e.jsx("button",{onClick:()=>z(a.id,b),className:`w-2.5 h-2.5 rounded-full flex-shrink-0 ${we[S].color} ring-2 ${we[S].ring} hover:scale-125 transition-transform shadow-sm`,title:`Prioridad: ${we[S].label}`}),e.jsx("button",{onClick:()=>l(a.id,b),className:"absolute -top-2 -right-2 bg-white border border-red-100 text-red-500 rounded-full w-5 h-5 flex items-center justify-center opacity-0 group-hover/chip:opacity-100 shadow-sm z-30 hover:bg-red-50 transition-all",children:e.jsx(ae,{size:10,strokeWidth:3})})]},b)}),e.jsx("button",{onClick:()=>w(a.id),className:"self-end mt-1 text-slate-400 hover:text-brand-600 hover:bg-brand-50 border border-dashed border-slate-300 hover:border-brand-200 rounded-full p-1.5 transition-all",title:"Agregar Causa",children:e.jsx(J,{size:12,strokeWidth:3})})]})]},a.id)})]})]}),!s&&e.jsxs("div",{className:"mt-8 grid grid-cols-1 md:grid-cols-2 gap-8 items-end max-w-4xl mx-auto",children:[e.jsxs("div",{className:"bg-white rounded-xl p-4 border border-slate-200 shadow-sm",children:[e.jsx("h4",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-3 border-b border-slate-100 pb-2",children:"ClasificaciÃ³n"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-3 p-1.5 rounded hover:bg-slate-50 transition-colors",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-emerald-500 shadow-sm ring-2 ring-emerald-100"}),e.jsx("span",{className:"text-[11px] font-medium text-slate-600",children:"Causa RaÃ­z Probable (Investigar)"})]}),e.jsxs("div",{className:"flex items-center gap-3 p-1.5 rounded hover:bg-slate-50 transition-colors",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-amber-400 shadow-sm ring-2 ring-amber-100"}),e.jsx("span",{className:"text-[11px] font-medium text-slate-600",children:"Contribuyente (AcciÃ³n indirecta)"})]}),e.jsxs("div",{className:"flex items-center gap-3 p-1.5 rounded hover:bg-slate-50 transition-colors",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-rose-500 shadow-sm ring-2 ring-rose-100"}),e.jsx("span",{className:"text-[11px] font-medium text-slate-600",children:"Descartada / No Abordable"})]})]})]}),e.jsxs("div",{className:"bg-blue-50/50 rounded-xl p-4 border border-blue-100 shadow-inner",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-900 uppercase tracking-widest mb-2 block",children:"Seleccionar Causa RaÃ­z Principal"}),e.jsx("div",{className:"relative",children:e.jsxs("select",{className:"w-full text-sm p-2.5 border border-blue-200 rounded-lg bg-white focus:ring-2 focus:ring-brand-500 outline-none shadow-sm cursor-pointer text-black font-medium",value:t.rootCause||"",onChange:a=>r("rootCause",a.target.value),children:[e.jsx("option",{value:"",children:"-- Ninguna seleccionada --"}),n.map((a,x)=>e.jsxs("option",{value:a.cause,children:[a.category,": ",a.cause]},x))]})})]})]})]})]})},Ut=({items:t=[],onChange:r})=>{const d=(l=null,z=-1)=>{const n={id:Date.now(),problem:"",whys:["","","","",""],status:"neutral",parentId:l,parentWhyIndex:z};r([...t,n])},m=l=>{if(!confirm("Â¿Eliminar esta fila de anÃ¡lisis?"))return;const z=t.filter((n,a)=>a!==l);r(z)},s=(l,z,n)=>{const a=[...t];a[l]={...a[l],[z]:n},r(a)},i=(l,z,n)=>{const a=[...t],x=[...a[l].whys||["","","","",""]];x[z]=n,a[l].whys=x,r(a)},N=l=>{const z=["neutral","root","discarded"],n=t[l].status||"neutral",a=z[(z.indexOf(n)+1)%z.length];s(l,"status",a)},w=l=>{switch(l){case"root":return"bg-emerald-50 border-emerald-300 ring-4 ring-emerald-50/50";case"discarded":return"bg-slate-50 border-slate-200 opacity-60 grayscale";default:return"bg-white border-slate-200 hover:border-brand-300"}};return e.jsx("div",{className:"w-full overflow-x-auto pb-4 custom-scrollbar",children:e.jsxs("div",{className:"min-w-[1200px]",children:[e.jsxs("div",{className:"grid grid-cols-7 gap-6 mb-6 text-center px-2",children:[e.jsxs("div",{className:"bg-gradient-to-br from-slate-800 to-slate-900 text-white p-4 rounded-xl shadow-lg flex flex-col justify-center h-24 border border-slate-700 relative overflow-hidden group",children:[e.jsx("div",{className:"absolute top-0 right-0 p-2 opacity-10 group-hover:opacity-20 transition-opacity",children:e.jsx(ie,{size:40})}),e.jsx("span",{className:"text-[10px] uppercase tracking-widest font-bold text-slate-400 mb-1",children:"Punto de Partida"}),e.jsx("h4",{className:"font-bold text-lg leading-tight",children:"Problema Directo"})]}),[1,2,3,4,5].map(l=>e.jsxs("div",{className:"bg-white p-4 rounded-xl shadow-sm border border-slate-200 flex flex-col justify-center h-24 relative overflow-hidden group",children:[e.jsx("div",{className:"absolute -right-2 -bottom-4 text-slate-100 font-black text-6xl group-hover:text-brand-50 transition-colors z-0 select-none",children:l}),e.jsxs("span",{className:"relative z-10 text-[10px] uppercase tracking-widest font-bold text-slate-400 mb-1",children:["Nivel ",l]}),e.jsx("h4",{className:"relative z-10 font-bold text-lg text-slate-700 leading-tight",children:"Â¿Por quÃ©?"})]},l)),e.jsxs("div",{className:"bg-white p-4 rounded-xl shadow-sm border border-slate-200 flex flex-col justify-center h-24 relative",children:[e.jsx("span",{className:"text-[10px] uppercase tracking-widest font-bold text-slate-400 mb-1",children:"ConclusiÃ³n"}),e.jsx("h4",{className:"font-bold text-lg text-slate-700 leading-tight",children:"Resultado"})]})]}),e.jsx("div",{className:"space-y-6 px-2",children:t.map((l,z)=>e.jsxs("div",{className:"grid grid-cols-7 gap-6 items-stretch relative group animate-in slide-in-from-left-4 duration-300",style:{animationDelay:`${z*100}ms`},children:[e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{className:"w-full h-full min-h-[140px] p-4 rounded-xl border-2 border-slate-200 bg-white focus:border-brand-500 focus:ring-4 focus:ring-brand-500/10 text-sm font-medium text-slate-700 resize-none shadow-sm transition-all outline-none",placeholder:"Describe la causa directa observada...",value:l.problem||"",onChange:n=>s(z,"problem",n.target.value)}),e.jsx("div",{className:"absolute top-1/2 -right-3 sm:-right-4 transform -translate-y-1/2 z-10 text-brand-200",children:e.jsx(xe,{size:20,strokeWidth:3})})]}),[0,1,2,3,4].map(n=>e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{className:`
                                            w-full h-full min-h-[140px] p-4 rounded-xl border-2
                                            focus:border-brand-500 focus:ring-4 focus:ring-brand-500/10 outline-none
                                            text-sm text-slate-600 resize-none shadow-sm transition-all
                                            ${(l.whys||[])[n]?"bg-white border-slate-200":"bg-slate-50 border-slate-100 opacity-70 hover:opacity-100 hover:bg-white"}
                                        `,placeholder:`Causa nivel ${n+1}...`,value:(l.whys||[])[n]||"",onChange:a=>i(z,n,a.target.value)}),n<4&&e.jsx("div",{className:"absolute top-1/2 -right-3 sm:-right-4 transform -translate-y-1/2 z-10 text-slate-200",children:e.jsx(xe,{size:20,strokeWidth:3})}),e.jsx("button",{className:"absolute bottom-2 right-2 z-10 bg-white rounded-lg p-1.5 shadow-sm border border-slate-200 text-slate-400 hover:text-brand-600 hover:border-brand-200 transition-all opacity-0 group-hover:opacity-100 active:scale-95",onClick:()=>d(l.id,n),title:"Crear ramificaciÃ³n desde este punto",children:e.jsx(Ge,{size:14})})]},n)),e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:`
                                        rounded-xl border-2 p-2 flex flex-col justify-center items-center gap-3 cursor-pointer transition-all shadow-sm h-full w-full relative group/status select-none
                                        ${w(l.status)}
                                    `,onClick:()=>N(z),children:[l.status==="root"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-emerald-100 flex items-center justify-center text-emerald-600 animate-in zoom-in duration-300",children:e.jsx(K,{size:28})}),e.jsx("span",{className:"text-[10px] font-bold text-emerald-700 uppercase leading-none text-center bg-emerald-100 px-2 py-1 rounded-full",children:"Causa RaÃ­z"})]}),l.status==="discarded"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-slate-200 flex items-center justify-center text-slate-500",children:e.jsx(Xs,{size:28})}),e.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase leading-none text-center bg-slate-200 px-2 py-1 rounded-full",children:"Descartado"})]}),(!l.status||l.status==="neutral")&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-slate-50 flex items-center justify-center text-slate-300 group-hover/status:text-brand-400 group-hover/status:bg-brand-50 transition-colors",children:e.jsx(Zs,{size:28})}),e.jsx("span",{className:"text-[10px] font-bold text-slate-400 uppercase text-center leading-none group-hover/status:text-brand-500",children:"Evaluar"})]})]}),e.jsx("button",{onClick:()=>m(z),className:"absolute -right-12 top-1/2 -translate-y-1/2 p-2 text-slate-300 hover:text-rose-500 hover:bg-rose-50 rounded-lg transition-all opacity-0 group-hover:opacity-100",title:"Eliminar fila completa",children:e.jsx(Y,{size:20})})]})]},l.id||z))}),e.jsx("div",{className:"mt-8 px-2",children:e.jsxs("button",{onClick:()=>d(),className:"w-full border-2 border-dashed border-slate-300 rounded-xl p-4 text-slate-400 font-bold hover:border-brand-400 hover:text-brand-600 hover:bg-brand-50/50 transition-all flex items-center justify-center gap-2 group",children:[e.jsx("div",{className:"bg-slate-100 group-hover:bg-brand-100 p-1.5 rounded-full transition-colors",children:e.jsx(J,{size:20})}),e.jsx("span",{children:"Agregar Nueva LÃ­nea de AnÃ¡lisis"})]})})]})})},Wt=({data:t={},onChange:r})=>{const[d,m]=j.useState(!1),{kpiName:s="",kpiGoal:i="",goalType:N="minimize",dataPoints:w=[],isPercentage:l=!1,dateFormat:z="date",interventionDate:n="",kpiType:a="simple",oeeConfig:x={standardSpeed:100,shiftDuration:8}}=t,h=(o,p)=>{r(o,p)},b=o=>{const p=parseFloat(o.availableTime)||0,D=parseFloat(o.productiveTime)||0,A=parseFloat(o.producedPieces)||0,T=parseFloat(o.defectPieces)||0,V=parseFloat(x.standardSpeed)||100,E=p>0?D/p*100:0,W=D*V,B=W>0?A/W*100:0,I=A>0?(A-T)/A*100:0,c=E*B*I/1e4;return{availability:Math.round(E*10)/10,performance:Math.round(B*10)/10,quality:Math.round(I*10)/10,oee:Math.round(c*10)/10}},k=()=>{const o=a==="oee"?{id:Date.now(),date:new Date().toISOString().split("T")[0],availableTime:x.shiftDuration||8,productiveTime:0,producedPieces:0,defectPieces:0}:{id:Date.now(),date:new Date().toISOString().split("T")[0],value:0};h("dataPoints",[...w,o])},S=(o,p,D)=>{const A=w.map(T=>T.id===o?{...T,[p]:D}:T);h("dataPoints",A)},L=o=>{confirm("Â¿Eliminar este punto de datos?")&&h("dataPoints",w.filter(p=>p.id!==o))},v=o=>{if(!o)return"";const p=new Date(o);switch(z){case"month":return p.toLocaleDateString("es-ES",{month:"short",year:"2-digit"});case"date":default:{const[D,A,T]=o.split("-");return`${T}-${A}-${D.slice(2)}`}}},$=[...w];n&&!$.some(o=>o.date===n)&&$.push({date:n,value:null});const f=$.sort((o,p)=>new Date(o.date)-new Date(p.date)).map(o=>({date:o.date,value:o.value!==null?parseFloat(o.value)||0:null})),O=a==="oee"?$.filter(o=>o.availableTime!==void 0).sort((o,p)=>new Date(o.date)-new Date(p.date)).map(o=>{const p=b(o);return{date:o.date,...p}}):[],C=O.length>0?O[O.length-1]:null,F=(o,p="oee")=>p==="oee"?o>=85?"text-emerald-600 bg-emerald-50 border-emerald-200":o>=60?"text-amber-600 bg-amber-50 border-amber-200":"text-rose-600 bg-rose-50 border-rose-200":o>=90?"text-emerald-600":o>=70?"text-amber-600":"text-rose-600";return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b border-slate-100 flex justify-between items-center bg-slate-50/50",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"font-bold text-slate-700 text-sm uppercase tracking-wide",children:"GrÃ¡fico de Tendencia"}),e.jsx("div",{className:"text-xs text-slate-400 font-medium",children:"VisualizaciÃ³n del desempeÃ±o del indicador"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("button",{onClick:()=>m(!d),className:"text-xs flex items-center gap-1.5 px-3 py-1.5 bg-white border border-slate-200 rounded-lg text-slate-600 hover:text-brand-600 hover:border-brand-200 transition-all shadow-sm active:scale-95",children:[e.jsx(As,{size:14}),d?"Ocultar":"Configurar"]})})]}),d&&e.jsxs("div",{className:"p-5 bg-slate-50 border-b border-slate-200 animate-in slide-in-from-top-2 duration-200",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase mb-1.5 block",children:"Tipo de Indicador"}),e.jsxs("div",{className:"flex bg-white rounded-lg border border-slate-200 p-1",children:[e.jsxs("button",{onClick:()=>h("kpiType","simple"),className:`flex-1 flex items-center justify-center gap-2 text-xs font-bold py-2 rounded-md transition-all ${a==="simple"?"bg-slate-100 text-slate-700 shadow-sm":"text-slate-400 hover:text-slate-600"}`,children:[e.jsx(Fe,{size:14})," KPI Simple"]}),e.jsxs("button",{onClick:()=>h("kpiType","oee"),className:`flex-1 flex items-center justify-center gap-2 text-xs font-bold py-2 rounded-md transition-all ${a==="oee"?"bg-cyan-50 text-cyan-700 shadow-sm":"text-slate-400 hover:text-slate-600"}`,children:[e.jsx(us,{size:14})," OEE"]})]})]}),a==="oee"&&e.jsx("div",{className:"mb-4 p-3 bg-cyan-50 border border-cyan-100 rounded-lg",children:e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-cyan-700 uppercase mb-1 block",children:"Velocidad EstÃ¡ndar (pzs/hr)"}),e.jsx("input",{type:"number",className:"w-full px-3 py-2 bg-white border border-cyan-200 rounded-lg focus:ring-2 focus:ring-cyan-500 outline-none text-sm",placeholder:"100",value:x.standardSpeed,onChange:o=>h("oeeConfig",{...x,standardSpeed:parseFloat(o.target.value)||100})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-cyan-700 uppercase mb-1 block",children:"DuraciÃ³n Turno (hrs)"}),e.jsx("input",{type:"number",className:"w-full px-3 py-2 bg-white border border-cyan-200 rounded-lg focus:ring-2 focus:ring-cyan-500 outline-none text-sm",placeholder:"8",value:x.shiftDuration,onChange:o=>h("oeeConfig",{...x,shiftDuration:parseFloat(o.target.value)||8})})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase mb-1.5 block",children:a==="oee"?"Nombre (LÃ­nea/MÃ¡quina)":"Nombre del KPI"}),e.jsx("input",{type:"text",className:"w-full px-3 py-2 bg-white border border-slate-200 rounded-lg focus:ring-2 focus:ring-brand-500 outline-none text-sm transition-all shadow-sm",placeholder:a==="oee"?"Ej: LÃ­nea 1":"Ej: Tiempo de cambio (min)",value:s,onChange:o=>h("kpiName",o.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase mb-1.5 block",children:"Fecha IntervenciÃ³n"}),e.jsxs("div",{className:"relative",children:[e.jsx(le,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"}),e.jsx("input",{type:"date",className:"w-full pl-9 pr-3 py-2 bg-white border border-slate-200 rounded-lg focus:ring-2 focus:ring-brand-500 outline-none text-sm transition-all shadow-sm",value:n,onChange:o=>h("interventionDate",o.target.value)})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase mb-1.5 block",children:"Meta Objetivo"}),e.jsxs("div",{className:"relative",children:[e.jsx(ie,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"}),e.jsx("input",{type:"number",step:"0.01",className:"w-full pl-9 pr-3 py-2 bg-white border border-slate-200 rounded-lg focus:ring-2 focus:ring-brand-500 outline-none text-sm transition-all shadow-sm",placeholder:"0.00",value:i,onChange:o=>h("kpiGoal",o.target.value)})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase mb-1.5 block",children:"DirecciÃ³n de Mejora"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("button",{onClick:()=>h("goalType","minimize"),className:`flex items-center justify-center gap-1 text-xs font-bold py-2 px-3 rounded-lg border transition-all ${N==="minimize"?"bg-blue-50 text-blue-600 border-blue-200 ring-1 ring-blue-200":"bg-white text-slate-500 border-slate-200 hover:bg-slate-50"}`,children:[e.jsx(is,{size:14})," Minimizar"]}),e.jsxs("button",{onClick:()=>h("goalType","maximize"),className:`flex items-center justify-center gap-1 text-xs font-bold py-2 px-3 rounded-lg border transition-all ${N==="maximize"?"bg-blue-50 text-blue-600 border-blue-200 ring-1 ring-blue-200":"bg-white text-slate-500 border-slate-200 hover:bg-slate-50"}`,children:[e.jsx(ds,{size:14})," Maximizar"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase mb-1.5 block",children:"Tipo de Dato"}),e.jsxs("div",{className:"flex bg-white rounded-lg border border-slate-200 p-1",children:[e.jsx("button",{onClick:()=>h("isPercentage",!1),className:`flex-1 text-xs font-bold py-1.5 rounded-md transition-all ${l?"text-slate-400 hover:text-slate-600":"bg-slate-100 text-slate-700 shadow-sm"}`,children:"NumÃ©rico"}),e.jsx("button",{onClick:()=>h("isPercentage",!0),className:`flex-1 text-xs font-bold py-1.5 rounded-md transition-all ${l?"bg-brand-50 text-brand-600 shadow-sm":"text-slate-400 hover:text-slate-600"}`,children:"Porcentaje %"})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase mb-1.5 block",children:"Formato Eje X"}),e.jsx("div",{className:"flex bg-white rounded-lg border border-slate-200 p-1",children:[{id:"date",label:"Fecha (dd-mm-yy)"},{id:"month",label:"Mes (mmm-yy)"}].map(o=>e.jsx("button",{onClick:()=>h("dateFormat",o.id),className:`flex-1 text-xs font-bold py-1.5 rounded-md transition-all ${z===o.id?"bg-slate-100 text-slate-800 shadow-sm":"text-slate-400 hover:text-slate-600"}`,children:o.label},o.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase mb-1.5 block",children:"Opciones de VisualizaciÃ³n"}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer p-2 border border-slate-200 rounded-lg bg-white hover:bg-slate-50 transition-colors",children:[e.jsx("input",{type:"checkbox",className:"w-4 h-4 text-brand-600 rounded focus:ring-brand-500 border-gray-300",checked:!!t.showInDashboard,onChange:o=>h("showInDashboard",o.target.checked)}),e.jsx("span",{className:"text-xs font-bold text-slate-700",children:"Mostrar en Dashboard"})]})]})]})]}),e.jsxs("div",{className:"p-6 flex-1 min-h-[320px] flex flex-col",children:[a==="oee"&&C&&e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"grid grid-cols-4 gap-3",children:[e.jsxs("div",{className:"bg-white border border-slate-200 rounded-xl p-3 text-center shadow-sm",children:[e.jsxs("div",{className:`text-2xl font-black ${F(C.availability,"sub")}`,children:[C.availability,"%"]}),e.jsx("div",{className:"text-[10px] font-bold text-slate-400 uppercase mt-1",children:"Disponibilidad"})]}),e.jsxs("div",{className:"bg-white border border-slate-200 rounded-xl p-3 text-center shadow-sm",children:[e.jsxs("div",{className:`text-2xl font-black ${F(C.performance,"sub")}`,children:[C.performance,"%"]}),e.jsx("div",{className:"text-[10px] font-bold text-slate-400 uppercase mt-1",children:"Rendimiento"})]}),e.jsxs("div",{className:"bg-white border border-slate-200 rounded-xl p-3 text-center shadow-sm",children:[e.jsxs("div",{className:`text-2xl font-black ${F(C.quality,"sub")}`,children:[C.quality,"%"]}),e.jsx("div",{className:"text-[10px] font-bold text-slate-400 uppercase mt-1",children:"Calidad"})]}),e.jsxs("div",{className:`rounded-xl p-3 text-center shadow-sm border ${F(C.oee,"oee")}`,children:[e.jsxs("div",{className:"text-2xl font-black",children:[C.oee,"%"]}),e.jsx("div",{className:"text-[10px] font-bold uppercase mt-1 opacity-70",children:"OEE"})]})]})}),a!=="oee"&&f.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-baseline gap-3",children:[e.jsxs("span",{className:"text-5xl font-black text-slate-700 tracking-tight",children:[f[f.length-1].value,l&&e.jsx("span",{className:"text-3xl font-bold text-slate-400 ml-1",children:"%"})]}),f.length>1&&(()=>{const o=f[0].value||0,p=f[f.length-1].value||0,D=o!==0?(p-o)/o*100:0,A=D>=0;return e.jsxs("span",{className:`text-sm font-bold px-2 py-1 rounded-full ${A?"bg-emerald-50 text-emerald-600":"bg-rose-50 text-rose-600"}`,children:[A?"+":"",Math.round(D),"% vs inicio"]})})()]}),e.jsx("p",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider mt-1",children:"Valor Actual"})]}),e.jsx("div",{className:"flex-1 w-full min-h-[240px]",children:a==="oee"&&O.length>0?e.jsx(te,{width:"100%",height:280,children:e.jsxs(_s,{data:O,margin:{top:10,right:30,left:0,bottom:0},children:[e.jsx(ge,{strokeDasharray:"3 3",stroke:"#f1f5f9",vertical:!1}),e.jsx(he,{dataKey:"date",tickFormatter:v,tick:{fontSize:10,fill:"#94a3b8"},tickLine:!1,axisLine:!1}),e.jsx(be,{tick:{fontSize:11,fill:"#94a3b8"},tickLine:!1,axisLine:!1,domain:[0,100],tickFormatter:o=>`${o}%`}),e.jsx(ne,{contentStyle:{backgroundColor:"white",border:"none",borderRadius:"12px",fontSize:"12px",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"},formatter:(o,p)=>[`${o}%`,p],labelFormatter:o=>v(o)}),e.jsx(Pe,{wrapperStyle:{paddingTop:"10px"}}),i&&!isNaN(parseFloat(i))&&e.jsx(ts,{y:parseFloat(i),stroke:"#10b981",strokeDasharray:"4 4",strokeWidth:2,label:{value:`Meta: ${i}%`,position:"right",fill:"#10b981",fontSize:10,fontWeight:"bold"}}),e.jsx(ke,{type:"monotone",dataKey:"oee",stroke:"#06b6d4",strokeWidth:3,name:"OEE",dot:{fill:"#06b6d4",r:4},isAnimationActive:!1}),e.jsx(ke,{type:"monotone",dataKey:"availability",stroke:"#3b82f6",strokeWidth:1.5,strokeDasharray:"3 3",name:"Disponibilidad",dot:!1,isAnimationActive:!1}),e.jsx(ke,{type:"monotone",dataKey:"performance",stroke:"#f59e0b",strokeWidth:1.5,strokeDasharray:"3 3",name:"Rendimiento",dot:!1,isAnimationActive:!1}),e.jsx(ke,{type:"monotone",dataKey:"quality",stroke:"#10b981",strokeWidth:1.5,strokeDasharray:"3 3",name:"Calidad",dot:!1,isAnimationActive:!1})]})}):a!=="oee"&&f.length>0?e.jsx(te,{width:"100%",height:320,children:e.jsxs(zs,{data:f,margin:{top:10,right:30,left:0,bottom:0},children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorValue",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#10b981",stopOpacity:.1}),e.jsx("stop",{offset:"95%",stopColor:"#10b981",stopOpacity:0})]})}),e.jsx(ge,{strokeDasharray:"3 3",stroke:"#f1f5f9",vertical:!1}),e.jsx(he,{dataKey:"date",tickFormatter:v,tick:{fontSize:10,fill:"#94a3b8"},tickLine:!1,axisLine:!1,dy:10,interval:"preserveStartEnd"}),e.jsx(be,{tick:{fontSize:11,fill:"#94a3b8"},tickLine:!1,axisLine:!1,dx:-10,domain:["auto","auto"]}),e.jsx(ne,{contentStyle:{backgroundColor:"white",border:"none",borderRadius:"12px",fontSize:"12px",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1)"},formatter:o=>[l?`${o}%`:o,s||"Valor"],labelFormatter:o=>v(o),itemStyle:{color:"#1e293b",fontWeight:"bold"},labelStyle:{color:"#64748b",marginBottom:"0.25rem"}}),e.jsx(Pe,{wrapperStyle:{paddingTop:"20px"}}),i&&!isNaN(parseFloat(i))&&e.jsx(ts,{y:parseFloat(i),stroke:"#f59e0b",strokeDasharray:"4 4",strokeWidth:2,label:{value:`Meta: ${i}${l?"%":""}`,position:"right",fill:"#d97706",fontSize:11,fontWeight:"bold",bg:"white"}}),n&&e.jsx(ts,{x:n,stroke:"#64748b",strokeDasharray:"3 3",label:{value:"IntervenciÃ³n",position:"top",fill:"#64748b",fontSize:10,fontWeight:"bold"}}),e.jsx(Es,{type:"monotone",dataKey:"value",stroke:"#10b981",strokeWidth:3,fillOpacity:1,fill:"url(#colorValue)",name:s||"Valor Real",activeDot:{r:6,strokeWidth:0,fill:"#10b981"},connectNulls:!0,isAnimationActive:!1})]})}):e.jsxs("div",{className:"h-full w-full flex flex-col items-center justify-center text-slate-300 gap-4 border-2 border-dashed border-slate-100 rounded-xl bg-slate-50/50",children:[a==="oee"?e.jsx(us,{size:48,className:"opacity-20"}):e.jsx(Fe,{size:48,className:"opacity-20"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"font-medium text-slate-400",children:"Sin datos para mostrar"}),e.jsx("p",{className:"text-xs",children:a==="oee"?"Agrega registros OEE para ver el grÃ¡fico":"Agrega registros en la tabla lateral para generar el grÃ¡fico"})]})]})})]})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-slate-200 shadow-sm flex flex-col h-full overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-slate-100 flex justify-between items-center bg-slate-50/50",children:[e.jsx("h5",{className:"font-bold text-slate-700 text-sm uppercase tracking-wide",children:"Registro de Datos"}),e.jsxs("button",{onClick:k,className:"text-xs flex items-center gap-1 px-2.5 py-1.5 bg-brand-600 text-white rounded-lg hover:bg-brand-700 transition-all shadow-sm shadow-brand-500/30 active:scale-95 font-medium",children:[e.jsx(J,{size:14})," Agregar"]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-0",children:w.length===0?e.jsx("div",{className:"h-40 flex items-center justify-center text-slate-400 text-xs italic p-4 text-center",children:"No hay registros. Comienza agregando un dato."}):a==="oee"?e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-cyan-50 border-b border-cyan-100 sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-2 py-2 text-[9px] font-bold text-cyan-700 uppercase",children:"Fecha"}),e.jsx("th",{className:"text-center px-1 py-2 text-[9px] font-bold text-cyan-700 uppercase",children:"T.Disp"}),e.jsx("th",{className:"text-center px-1 py-2 text-[9px] font-bold text-cyan-700 uppercase",children:"T.Prod"}),e.jsx("th",{className:"text-center px-1 py-2 text-[9px] font-bold text-cyan-700 uppercase",children:"Piezas"}),e.jsx("th",{className:"text-center px-1 py-2 text-[9px] font-bold text-cyan-700 uppercase",children:"Defec."}),e.jsx("th",{className:"text-center px-1 py-2 text-[9px] font-bold text-cyan-700 uppercase",children:"OEE"}),e.jsx("th",{className:"w-8"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100",children:w.filter(o=>o.availableTime!==void 0).sort((o,p)=>new Date(p.date)-new Date(o.date)).map(o=>{const p=b(o);return e.jsxs("tr",{className:"group hover:bg-slate-50 transition-colors",children:[e.jsx("td",{className:"px-2 py-1.5",children:e.jsx("input",{type:"date",className:"w-full bg-transparent border-none p-0 text-[10px] font-medium text-slate-600 focus:ring-0",value:o.date,onChange:D=>S(o.id,"date",D.target.value)})}),e.jsx("td",{className:"px-1 py-1.5",children:e.jsx("input",{type:"number",step:"0.1",className:"w-12 text-center bg-transparent border border-transparent hover:border-slate-200 focus:border-cyan-500 rounded px-1 py-0.5 text-[10px] font-medium focus:ring-1 focus:ring-cyan-500 outline-none",value:o.availableTime,onChange:D=>S(o.id,"availableTime",D.target.value)})}),e.jsx("td",{className:"px-1 py-1.5",children:e.jsx("input",{type:"number",step:"0.1",className:"w-12 text-center bg-transparent border border-transparent hover:border-slate-200 focus:border-cyan-500 rounded px-1 py-0.5 text-[10px] font-medium focus:ring-1 focus:ring-cyan-500 outline-none",value:o.productiveTime,onChange:D=>S(o.id,"productiveTime",D.target.value)})}),e.jsx("td",{className:"px-1 py-1.5",children:e.jsx("input",{type:"number",className:"w-14 text-center bg-transparent border border-transparent hover:border-slate-200 focus:border-cyan-500 rounded px-1 py-0.5 text-[10px] font-medium focus:ring-1 focus:ring-cyan-500 outline-none",value:o.producedPieces,onChange:D=>S(o.id,"producedPieces",D.target.value)})}),e.jsx("td",{className:"px-1 py-1.5",children:e.jsx("input",{type:"number",className:"w-12 text-center bg-transparent border border-transparent hover:border-slate-200 focus:border-cyan-500 rounded px-1 py-0.5 text-[10px] font-medium focus:ring-1 focus:ring-cyan-500 outline-none",value:o.defectPieces,onChange:D=>S(o.id,"defectPieces",D.target.value)})}),e.jsx("td",{className:"px-1 py-1.5 text-center",children:e.jsxs("span",{className:`text-[10px] font-bold ${F(p.oee,"sub")}`,children:[p.oee,"%"]})}),e.jsx("td",{className:"px-1 py-1.5",children:e.jsx("button",{onClick:()=>L(o.id),className:"text-slate-300 hover:text-rose-500 p-1 rounded-md hover:bg-rose-50 opacity-0 group-hover:opacity-100 transition-all",children:e.jsx(Y,{size:12})})})]},o.id)})})]}):e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-slate-50 border-b border-slate-200 sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-4 py-3 text-[10px] font-bold text-slate-500 uppercase tracking-wider",children:"Fecha"}),e.jsx("th",{className:"text-left px-4 py-3 text-[10px] font-bold text-slate-500 uppercase tracking-wider",children:"Valor"}),e.jsx("th",{className:"w-10"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100",children:w.sort((o,p)=>new Date(p.date)-new Date(o.date)).map(o=>{const p=parseFloat(o.value)||0,D=parseFloat(i);let A="text-slate-400";return D&&!isNaN(D)&&(A=(N==="minimize"?p<=D:p>=D)?"text-emerald-500":"text-rose-500"),e.jsxs("tr",{className:"group hover:bg-slate-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-2",children:e.jsx("div",{className:"relative",children:e.jsx("input",{type:"date",className:"w-full bg-transparent border-none p-0 text-xs font-medium text-slate-600 focus:ring-0 cursor-pointer",value:o.date,onChange:T=>S(o.id,"date",T.target.value)})})}),e.jsx("td",{className:"px-4 py-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",step:"0.01",className:`w-20 bg-transparent border border-transparent hover:border-slate-200 focus:border-brand-500 rounded px-2 py-1 text-xs font-bold focus:ring-1 focus:ring-brand-500 outline-none transition-all ${A}`,value:o.value,onChange:T=>S(o.id,"value",T.target.value)}),l&&e.jsx("span",{className:"text-xs text-slate-400 font-bold",children:"%"})]})}),e.jsx("td",{className:"px-2 py-2 text-right",children:e.jsx("button",{onClick:()=>L(o.id),className:"text-slate-300 hover:text-rose-500 p-1.5 rounded-md hover:bg-rose-50 opacity-0 group-hover:opacity-100 transition-all active:scale-90",title:"Eliminar registro",children:e.jsx(Y,{size:14})})})]},o.id)})})]})})]})]})})},Bt=({actions:t,onChange:r,users:d=[]})=>{const[m,s]=j.useState({activity:"",responsible:"",date:""}),i=()=>{if(!m.activity)return;const l={id:Date.now(),activity:m.activity,responsible:m.responsible,date:m.date,status:"pending"};r([...t||[],l]),s({activity:"",responsible:"",date:""})},N=l=>{r((t||[]).filter(z=>z.id!==l))},w=l=>{const z=(t||[]).map(n=>n.id===l?{...n,status:n.status==="pending"?"done":"pending"}:n);r(z)};return e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"bg-slate-50 p-6 rounded-xl border border-slate-200 mb-6 shadow-sm",children:[e.jsxs("h5",{className:"text-xs font-bold text-slate-500 uppercase mb-4 flex items-center gap-2",children:[e.jsx(J,{size:14,className:"text-brand-500"})," Nueva AcciÃ³n"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-12 gap-4 items-end",children:[e.jsxs("div",{className:"md:col-span-6",children:[e.jsx("label",{className:"text-xs font-bold text-slate-700 mb-1 block uppercase tracking-wider",children:"Actividad / Contramedida"}),e.jsx("input",{type:"text",placeholder:"DescripciÃ³n detallada de la acciÃ³n a realizar...",className:"w-full px-4 py-2.5 bg-white border border-slate-200 rounded-lg focus:ring-2 focus:ring-brand-500 outline-none text-sm transition-all shadow-sm placeholder:text-slate-400 text-slate-900",value:m.activity,onChange:l=>s({...m,activity:l.target.value})})]}),e.jsxs("div",{className:"md:col-span-3",children:[e.jsx("label",{className:"text-xs font-bold text-slate-700 mb-1 block uppercase tracking-wider",children:"Responsable"}),e.jsxs("div",{className:"relative",children:[e.jsx(re,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"}),d.length>0?e.jsxs("select",{className:"w-full pl-10 pr-4 py-2.5 bg-white border border-slate-200 rounded-lg focus:ring-2 focus:ring-brand-500 outline-none text-sm appearance-none shadow-sm cursor-pointer text-slate-900 font-medium",value:m.responsible,onChange:l=>s({...m,responsible:l.target.value}),children:[e.jsx("option",{value:"",className:"text-slate-500",children:"Seleccionar..."}),d.map(l=>e.jsx("option",{value:l.name,className:"text-slate-900",children:l.name},l.uid||l.id||l.name))]}):e.jsx("input",{type:"text",placeholder:"Nombre...",className:"w-full pl-10 pr-4 py-2.5 bg-white border border-slate-200 rounded-lg focus:ring-2 focus:ring-brand-500 outline-none text-sm shadow-sm",value:m.responsible,onChange:l=>s({...m,responsible:l.target.value})})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"text-xs font-bold text-slate-700 mb-1 block uppercase tracking-wider",children:"Fecha LÃ­mite"}),e.jsxs("div",{className:"relative",children:[e.jsx(le,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"}),e.jsx("input",{type:"date",className:"w-full pl-10 pr-4 py-2.5 bg-white border border-slate-200 rounded-lg focus:ring-2 focus:ring-brand-500 outline-none text-sm shadow-sm cursor-pointer text-slate-900",value:m.date,onChange:l=>s({...m,date:l.target.value})})]})]}),e.jsx("div",{className:"md:col-span-1",children:e.jsx("button",{onClick:i,disabled:!m.activity,className:"w-full h-[42px] bg-brand-600 hover:bg-brand-700 text-white rounded-lg flex items-center justify-center transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-md shadow-brand-500/30 active:scale-95",title:"Agregar tarea al plan",children:e.jsx(J,{size:20,strokeWidth:3})})})]})]}),e.jsx("div",{className:"overflow-hidden bg-white rounded-xl border border-slate-200 shadow-sm",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"text-xs text-slate-500 uppercase bg-slate-50/80 border-b border-slate-200 font-bold tracking-wider",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 w-16 text-center",children:"Estado"}),e.jsx("th",{className:"px-6 py-4",children:"Actividad Planificada"}),e.jsx("th",{className:"px-6 py-4 w-56",children:"Responsable"}),e.jsx("th",{className:"px-6 py-4 w-40",children:"Fecha LÃ­mite"}),e.jsx("th",{className:"px-6 py-4 w-16"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100",children:!t||t.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"px-6 py-12 text-center",children:e.jsxs("div",{className:"flex flex-col items-center justify-center text-slate-400",children:[e.jsx("div",{className:"w-12 h-12 bg-slate-50 rounded-full flex items-center justify-center mb-3",children:e.jsx(Le,{size:24,className:"text-slate-300"})}),e.jsx("p",{className:"font-medium",children:"No hay acciones definidas en este plan."}),e.jsx("p",{className:"text-xs mt-1 text-slate-300",children:"Agrega nuevas acciones utilizando el formulario superior."})]})})}):t.map(l=>e.jsxs("tr",{className:`group hover:bg-slate-50 transition-colors ${l.status==="done"?"bg-slate-50/50":""}`,children:[e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx("button",{onClick:()=>w(l.id),className:`transform transition-all duration-200 active:scale-90 ${l.status==="done"?"text-emerald-500 scale-110":"text-slate-300 hover:text-emerald-400"}`,title:l.status==="done"?"Marcar como pendiente":"Marcar como completado",children:l.status==="done"?e.jsx(K,{size:22,className:"drop-shadow-sm"}):e.jsx(et,{size:22})})}),e.jsx("td",{className:`px-6 py-4 font-medium transition-colors ${l.status==="done"?"line-through text-slate-400":"text-slate-700"}`,children:l.activity}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:`flex items-center gap-3 ${l.status==="done"&&"opacity-50"}`,children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-indigo-50 text-indigo-600 border border-indigo-100 flex items-center justify-center text-xs font-bold shadow-sm",children:l.responsible?e.jsx("span",{className:"uppercase",children:l.responsible.charAt(0)}):e.jsx(re,{size:12})}),e.jsx("span",{className:"text-xs font-medium text-slate-600 truncate max-w-[140px]",children:l.responsible||"Sin asignar"})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:`flex items-center gap-2 text-xs font-medium px-2.5 py-1 rounded-md w-fit border ${l.status==="done"?"bg-slate-100 text-slate-400 border-slate-200":"bg-slate-50 text-slate-600 border-slate-200"}`,children:[e.jsx(le,{size:12}),l.date||"Sin fecha"]})}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsx("button",{onClick:()=>N(l.id),className:"text-slate-300 hover:text-rose-500 hover:bg-rose-50 p-2 rounded-lg opacity-0 group-hover:opacity-100 transition-all active:scale-95",title:"Eliminar acciÃ³n",children:e.jsx(Y,{size:16})})})]},l.id))})]})}),e.jsxs("div",{className:"mt-4 flex items-center gap-2 text-xs text-slate-400 justify-end",children:[e.jsx(Vt,{}),e.jsx("span",{children:"Las tareas completadas se archivarÃ¡n en el historial del proyecto."})]})]})},Vt=()=>e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"12",y1:"16",x2:"12",y2:"12"}),e.jsx("line",{x1:"12",y1:"8",x2:"12.01",y2:"8"})]}),Gt=({data:t=[],onChange:r})=>{const[d,m]=j.useState(t),[s,i]=j.useState(""),[N,w]=j.useState("");j.useEffect(()=>{m(t)},[t]);const z=(x=>{if(!x||x.length===0)return[];const h=[...x].sort((S,L)=>L.value-S.value),b=h.reduce((S,L)=>S+Number(L.value),0);let k=0;return h.map(S=>(k+=Number(S.value),{...S,cumulativePercentage:Math.round(k/b*100)}))})(d),n=()=>{if(!s||!N)return;const x=[...d,{name:s,value:Number(N)}];m(x),r(x),i(""),w("")},a=x=>{const h=d.filter((b,k)=>k!==x);m(h),r(h)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"bg-slate-50 p-6 rounded-xl border border-slate-200 lg:col-span-1",children:[e.jsxs("h4",{className:"font-bold text-slate-900 mb-4 flex items-center gap-2",children:[e.jsx(Oe,{size:18})," Datos del Pareto"]}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-900 uppercase mb-1 block",children:"CategorÃ­a (Causa)"}),e.jsx("input",{type:"text",className:"w-full p-2 border border-slate-300 rounded-lg text-sm text-slate-900 font-medium focus:ring-2 focus:ring-brand-500 outline-none",placeholder:"Ej: Defecto A",value:s,onChange:x=>i(x.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-900 uppercase mb-1 block",children:"Frecuencia / Costo"}),e.jsx("input",{type:"number",className:"w-full p-2 border border-slate-300 rounded-lg text-sm text-slate-900 font-medium focus:ring-2 focus:ring-brand-500 outline-none",placeholder:"Ej: 50",value:N,onChange:x=>w(x.target.value),onKeyDown:x=>x.key==="Enter"&&n()})]}),e.jsxs("button",{onClick:n,className:"w-full py-2 bg-brand-600 hover:bg-brand-700 text-white font-bold rounded-lg text-sm transition-colors flex items-center justify-center gap-2",children:[e.jsx(J,{size:16})," Agregar al GrÃ¡fico"]})]}),e.jsx("div",{className:"space-y-2 max-h-[300px] overflow-y-auto pr-1",children:d.length===0?e.jsx("p",{className:"text-sm text-slate-500 text-center italic py-4",children:"No hay datos agregados."}):d.map((x,h)=>e.jsxs("div",{className:"flex justify-between items-center bg-white p-3 rounded-lg border border-slate-200 shadow-sm",children:[e.jsx("span",{className:"text-sm font-bold text-slate-700 truncate flex-1",children:x.name}),e.jsx("span",{className:"text-sm font-bold text-brand-600 bg-brand-50 px-2 py-1 rounded mx-2",children:x.value}),e.jsx("button",{onClick:()=>a(h),className:"text-slate-400 hover:text-red-500 transition-colors",children:e.jsx(Y,{size:14})})]},h))})]}),e.jsx("div",{className:"lg:col-span-2 bg-white p-4 rounded-xl border border-slate-200 shadow-sm min-h-[400px] flex flex-col",children:d.length>0?e.jsx(te,{width:"100%",height:400,children:e.jsxs(ft,{data:z,margin:{top:20,right:20,bottom:20,left:20},children:[e.jsx(ge,{stroke:"#f1f5f9",strokeDasharray:"3 3"}),e.jsx(he,{dataKey:"name",scale:"band",tick:{fill:"#475569",fontSize:12}}),e.jsx(be,{yAxisId:"left",orientation:"left",stroke:"#475569",fontSize:12}),e.jsx(be,{yAxisId:"right",orientation:"right",stroke:"#8b5cf6",fontSize:12,unit:"%",domain:[0,100]}),e.jsx(ne,{contentStyle:{borderRadius:"8px",border:"none",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"}}),e.jsx(Pe,{}),e.jsx(_e,{yAxisId:"left",dataKey:"value",name:"Frecuencia",fill:"#0ea5e9",barSize:40,radius:[4,4,0,0],children:z.map((x,h)=>e.jsx(ue,{fill:h<3?"#0ea5e9":"#94a3b8"},`cell-${h}`))}),e.jsx(ke,{yAxisId:"right",type:"monotone",dataKey:"cumulativePercentage",name:"% Acumulado",stroke:"#8b5cf6",strokeWidth:3,dot:{r:4,fill:"#8b5cf6",strokeWidth:2,stroke:"#fff"}}),e.jsx(ke,{yAxisId:"right",type:"monotone",dataKey:()=>80,stroke:"#ef4444",strokeDasharray:"5 5",strokeWidth:1,dot:!1,activeDot:!1,legendType:"none"})]})}):e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-slate-400",children:[e.jsx(Oe,{size:48,className:"mb-4 opacity-50"}),e.jsx("p",{children:"Agrega datos para visualizar el diagrama de Pareto 80/20"})]})})]}),d.length>0&&e.jsxs("div",{className:"bg-brand-50 border border-brand-100 p-4 rounded-lg",children:[e.jsx("h5",{className:"text-sm font-bold text-brand-800 mb-1 flex items-center gap-2",children:"ðŸ’¡ AnÃ¡lisis 80/20"}),e.jsxs("p",{className:"text-sm text-brand-700",children:["Las categorÃ­as ",e.jsx("strong",{children:z.filter(x=>x.cumulativePercentage<=80).map(x=>x.name).join(", ")})," representan el ~80% del impacto total."]})]})]})},Ae=({value:t,onChange:r,placeholder:d,minHeight:m="100px",className:s})=>{const i=j.useRef(null);return j.useEffect(()=>{if(i.current){i.current.style.height=m;const N=i.current.scrollHeight;i.current.style.height=`${Math.max(N,parseInt(m))}px`}},[t,m]),e.jsx("textarea",{ref:i,className:`${s} overflow-hidden resize-none`,placeholder:d,value:t,onChange:r,style:{minHeight:m}})},Ht=()=>{const{user:t,globalFilterCompanyId:r,companyUsers:d}=Z(),m=Xe(),[s,i]=j.useState(null),[N,w]=j.useState(""),[l,z]=j.useState("definition"),[n,a]=j.useState([]),x=async()=>{try{const{data:p,error:D}=await U.from("a3_projects").select("*").order("created_at",{ascending:!1});if(D)throw D;if(p){const A=p.map(T=>({id:T.id,title:T.title,status:T.status,date:T.date,responsible:T.responsible,background:T.background,backgroundImageUrl:T.background_image_url,currentCondition:T.current_condition,currentConditionImageUrl:T.current_condition_image_url,goal:T.goal,rootCause:T.root_cause,paretoData:T.pareto_data||[],countermeasures:T.countermeasures,plan:T.execution_plan,followUp:T.follow_up_notes,ishikawas:T.ishikawas||[],multipleFiveWhys:T.five_whys||[],followUpData:Array.isArray(T.follow_up_data)?T.follow_up_data:T.follow_up_data&&Object.keys(T.follow_up_data).length>0?[T.follow_up_data]:[],actionPlan:T.action_plan||[],companyId:T.company_id}));a(A)}}catch(p){console.error("Error fetching A3 projects:",p)}finally{}};j.useEffect(()=>{t&&x()},[t,r]),j.useEffect(()=>{const D=new URLSearchParams(m.search).get("projectId");if(D&&n.length>0){const A=n.find(T=>T.id===parseInt(D)||T.id===D);A&&(i(A),z("definition"))}},[m.search,n]);const h=j.useMemo(()=>{if(!t)return[];const D=t.role==="admin"||t.email==="ariel.mellag@gmail.com"?r:t.companyId;return D==="all"?n:n.filter(A=>A.companyId===D||A.responsible===t.name||!A.companyId)},[n,t,r]),b=j.useMemo(()=>h.filter(p=>p.title.toLowerCase().includes(N.toLowerCase())||p.responsible.toLowerCase().includes(N.toLowerCase())),[h,N]),k=()=>{i({id:null,title:"",status:"Nuevo",responsible:t?t.name:"",date:new Date().toISOString().split("T")[0],background:"",backgroundImageUrl:"",currentCondition:"",currentConditionImageUrl:"",goal:"",rootCause:"",paretoData:[],countermeasures:"",plan:"",followUp:"",ishikawas:[],multipleFiveWhys:[],followUpData:[],actionPlan:[]}),z("definition")},S=async()=>{if(!s.title){alert("El tÃ­tulo es obligatorio");return}let p=s.companyId;if(d&&s.responsible){const A=d.find(T=>T.name===s.responsible);A&&A.company_id&&(p=A.company_id)}p||(p=t.companyId||(r!=="all"?r:null));const D={title:s.title,status:s.status,date:s.date,responsible:s.responsible,background:s.background,background_image_url:s.backgroundImageUrl,current_condition:s.currentCondition,current_condition_image_url:s.currentConditionImageUrl,goal:s.goal,root_cause:s.rootCause,pareto_data:s.paretoData,countermeasures:s.countermeasures,execution_plan:s.plan,follow_up_notes:s.followUp,ishikawas:s.ishikawas,five_whys:s.multipleFiveWhys,follow_up_data:s.followUpData,action_plan:s.actionPlan,company_id:p};try{if(s.id){const{error:A}=await U.from("a3_projects").update(D).eq("id",s.id);if(A)throw A;a(n.map(T=>T.id===s.id?{...s,...D,multipleFiveWhys:D.five_whys,companyId:p}:T))}else{const{data:A,error:T}=await U.from("a3_projects").insert([D]).select();if(T)throw T;A&&x()}i(null)}catch(A){console.error("Error saving A3:",A),alert("Error al guardar el proyecto A3")}},L=()=>{i(p=>({...p,ishikawas:[...p.ishikawas||[],{problem:"",categories:{}}]}))},v=p=>{confirm("Â¿Eliminar este diagrama de Ishikawa?")&&i(D=>({...D,ishikawas:D.ishikawas.filter((A,T)=>T!==p)}))},$=(p,D,A)=>{i(T=>{const V=[...T.ishikawas||[]];return V[p]={...V[p],[D]:A},{...T,ishikawas:V}})},f=()=>{const p={id:Date.now(),kpiName:"",dataPoints:[],goal:""};i(D=>({...D,followUpData:[...D.followUpData||[],p]}))},O=p=>{confirm("Â¿Eliminar este grÃ¡fico?")&&i(D=>({...D,followUpData:(D.followUpData||[]).filter((A,T)=>T!==p)}))},C=(p,D,A)=>{i(T=>{const V=[...T.followUpData||[]];return V[p]?(V[p]={...V[p],[D]:A},{...T,followUpData:V}):T})},F=p=>{i(D=>({...D,actionPlan:p}))},o=async(p,D)=>{if(p)try{const A=p.name.split(".").pop(),T=`${Math.random().toString(36).substring(2)}_${Date.now()}.${A}`,V=`${t.id}/${T}`,{error:E}=await U.storage.from("images").upload(V,p);if(E)throw E;const{data:{publicUrl:W}}=U.storage.from("images").getPublicUrl(V);i(B=>({...B,[D]:W}))}catch(A){console.error("Error uploading image:",A),alert("Error al subir la imagen")}};return e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6 pb-20 animate-in fade-in duration-500",children:[e.jsx(ve,{title:"Proyectos A3",subtitle:"MetodologÃ­a estructurada para anÃ¡lisis y resoluciÃ³n de problemas",children:e.jsxs("button",{onClick:k,className:"flex items-center gap-2 bg-brand-600 hover:bg-brand-700 text-white px-4 py-2.5 rounded-lg transition-all shadow-sm shadow-brand-500/30 hover:shadow-brand-500/50 font-medium active:scale-95",children:[e.jsx(J,{size:20}),e.jsx("span",{children:"Nuevo A3"})]})}),e.jsxs("div",{className:"bg-white p-4 rounded-xl shadow-sm border border-slate-200 flex items-center gap-4",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(Ce,{size:18,className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"Buscar proyectos por tÃ­tulo o responsable...",className:"w-full pl-10 pr-4 py-2.5 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-brand-500 transition-all text-sm outline-none",value:N,onChange:p=>w(p.target.value)})]}),e.jsx("div",{className:"h-6 w-px bg-slate-200 hidden md:block"}),e.jsxs("div",{className:"text-sm text-slate-500 hidden md:block",children:["Mostrando ",e.jsx("span",{className:"font-bold text-slate-800",children:b.length})," proyectos"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[b.map(p=>e.jsxs("div",{className:"group bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden hover:shadow-xl hover:-translate-y-1 transition-all duration-300 cursor-pointer flex flex-col h-full relative",onClick:()=>{i(p),z("definition")},children:[e.jsx("div",{className:`absolute top-0 left-0 bottom-0 w-1 transition-colors ${p.status==="Cerrado"?"bg-emerald-500":p.status==="En Proceso"?"bg-amber-500":"bg-blue-500"}`}),e.jsxs("div",{className:"p-6 flex flex-col flex-1 ml-1",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("span",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider flex items-center gap-1",children:[e.jsx(fe,{size:12})," A3 Report"]}),e.jsx("span",{className:`px-2.5 py-1 rounded-full text-[10px] font-bold uppercase tracking-wide ${p.status==="Cerrado"?"bg-emerald-50 text-emerald-600 border border-emerald-100":p.status==="En Proceso"?"bg-amber-50 text-amber-600 border border-amber-100":"bg-blue-50 text-blue-600 border border-blue-100"}`,children:p.status})]}),e.jsx("h3",{className:"font-bold text-slate-800 text-lg mb-3 leading-snug group-hover:text-brand-600 transition-colors line-clamp-2",children:p.title}),e.jsx("div",{className:"space-y-4 mb-6 flex-1",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs font-bold text-slate-500 uppercase tracking-wide block",children:"Meta / Objetivo"}),e.jsx("p",{className:"text-sm text-slate-600 line-clamp-2 leading-relaxed h-[40px]",children:p.goal||"Sin objetivo definido"})]})}),e.jsxs("div",{className:"pt-4 border-t border-slate-100 flex justify-between items-center mt-auto",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-slate-100 border border-slate-200 flex items-center justify-center text-xs font-bold text-slate-600 shadow-sm",children:p.responsible?p.responsible.charAt(0):"?"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] uppercase text-slate-400 font-bold",children:"Responsable"}),e.jsx("span",{className:"text-xs font-medium text-slate-700 truncate max-w-[120px]",children:p.responsible||"Sin asignar"})]})]}),e.jsx("span",{className:"text-xs text-slate-400 font-medium bg-slate-50 px-2 py-1 rounded",children:p.date})]})]})]},p.id)),b.length===0&&e.jsxs("div",{className:"col-span-full py-16 text-center bg-slate-50 rounded-2xl border-2 border-dashed border-slate-200",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-white shadow-sm mb-4",children:e.jsx(fe,{size:32,className:"text-slate-300"})}),e.jsx("h3",{className:"text-lg font-medium text-slate-900 mb-1",children:"No se encontraron proyectos"}),e.jsx("p",{className:"text-slate-500",children:"Crea un nuevo reporte A3 para comenzar"})]})]}),s&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-0 md:p-4 overflow-hidden",onClick:()=>i(null),children:e.jsxs("div",{className:"bg-white rounded-none md:rounded-2xl shadow-2xl w-full h-full md:h-[95vh] flex flex-col overflow-hidden animate-in fade-in zoom-in-95 duration-200",onClick:p=>p.stopPropagation(),children:[e.jsxs("div",{className:"px-6 py-4 border-b border-slate-200 flex justify-between items-center bg-white shrink-0 z-10",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs font-bold text-brand-600 uppercase tracking-tighter mb-1",children:[e.jsx(fe,{size:12})," Hoja de Trabajo A3"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{className:"text-xl font-bold text-slate-800 bg-transparent border-none p-0 focus:ring-0 placeholder:text-slate-300 w-full max-w-lg truncate",value:s.title,onChange:p=>i({...s,title:p.target.value}),placeholder:"Escribe el TÃ­tulo del Proyecto..."}),e.jsx("span",{className:"text-slate-200 text-2xl font-light hidden sm:inline",children:"|"}),e.jsx("div",{className:"hidden sm:block min-w-[140px]",children:e.jsxs("select",{className:`w-full py-1 pl-2 pr-8 text-sm font-bold rounded-lg border-none focus:ring-2 cursor-pointer ${s.status==="Cerrado"?"bg-emerald-50 text-emerald-700":s.status==="En Proceso"?"bg-amber-50 text-amber-700":"bg-blue-50 text-blue-700"}`,value:s.status,onChange:p=>i({...s,status:p.target.value}),children:[e.jsx("option",{children:"Nuevo"}),e.jsx("option",{children:"En Proceso"}),e.jsx("option",{children:"Cerrado"})]})})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:S,className:"hidden sm:flex items-center gap-2 bg-brand-600 hover:bg-brand-700 text-white px-4 py-2 rounded-lg font-medium transition-all shadow-sm active:scale-95",children:[e.jsx(Me,{size:18})," ",e.jsx("span",{children:"Guardar"})]}),e.jsx("button",{onClick:S,className:"sm:hidden p-2 bg-brand-600 text-white rounded-lg",children:e.jsx(Me,{size:20})}),e.jsx("button",{onClick:()=>i(null),className:"p-2 text-slate-400 hover:text-slate-600 hover:bg-slate-100 rounded-lg transition-colors",children:e.jsx(ae,{size:24})})]})]}),e.jsx("div",{className:"bg-slate-50 border-b border-slate-200 px-6 flex items-center justify-start gap-1 overflow-x-auto shrink-0",children:[{id:"definition",label:"1. DefiniciÃ³n",icon:st,color:"brand"},{id:"analysis",label:"2. AnÃ¡lisis de Causa",icon:Ge,color:"purple"},{id:"plan",label:"3. Plan & Seguimiento",icon:ie,color:"emerald"}].map(p=>e.jsxs("button",{onClick:()=>z(p.id),className:`
                                        relative py-4 px-6 text-sm font-bold flex items-center gap-2 transition-all border-b-2
                                        ${l===p.id?`text-${p.color}-600 border-${p.color}-600 bg-white rounded-t-lg shadow-sm -mb-[1px] z-10`:"text-slate-900 border-transparent hover:text-black hover:bg-slate-100/50 rounded-t-lg"}
                                    `,children:[e.jsx(p.icon,{size:16})," ",e.jsx("span",{className:"whitespace-nowrap",children:p.label})]},p.id))}),e.jsxs("div",{className:"flex-1 overflow-y-auto bg-slate-50/50 p-6 md:p-8 scroll-smooth",children:[l==="definition"&&e.jsx("div",{className:"max-w-6xl mx-auto space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-300",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-slate-200 group hover:shadow-md transition-shadow",children:[e.jsxs("h4",{className:"font-bold text-slate-800 border-b border-slate-100 pb-3 mb-4 flex items-center gap-3",children:[e.jsx("span",{className:"bg-slate-900 text-white w-6 h-6 rounded-lg flex items-center justify-center text-xs font-bold",children:"1"}),"Antecedentes"]}),e.jsx(Ae,{className:"w-full p-4 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-brand-500 outline-none transition-all text-slate-700 leading-relaxed",placeholder:"Describa el contexto y la razÃ³n de seleccionar este problema...",value:s.background,onChange:p=>i({...s,background:p.target.value}),minHeight:"160px"}),e.jsx("div",{className:"mt-3",children:s.backgroundImageUrl?e.jsxs("div",{className:"relative group/img",children:[e.jsx("img",{src:s.backgroundImageUrl,alt:"Antecedentes",className:"w-full h-auto max-h-[300px] object-contain rounded-lg border border-slate-200"}),e.jsx("button",{onClick:()=>i({...s,backgroundImageUrl:""}),className:"absolute top-2 right-2 bg-white/90 p-1.5 rounded-full text-red-500 opacity-0 group-hover/img:opacity-100 transition-opacity shadow-sm",children:e.jsx(Y,{size:16})})]}):e.jsxs("label",{className:"flex items-center gap-2 text-sm text-brand-600 font-bold cursor-pointer hover:bg-brand-50 p-2 rounded-lg transition-colors w-fit",children:[e.jsx(rs,{size:16})," Adjuntar Imagen",e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:p=>o(p.target.files[0],"backgroundImageUrl")})]})})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-slate-200 group hover:shadow-md transition-shadow",children:[e.jsxs("h4",{className:"font-bold text-slate-800 border-b border-slate-100 pb-3 mb-4 flex items-center gap-3",children:[e.jsx("span",{className:"bg-slate-900 text-white w-6 h-6 rounded-lg flex items-center justify-center text-xs font-bold",children:"2"}),"CondiciÃ³n Actual"]}),e.jsx(Ae,{className:"w-full p-4 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-brand-500 outline-none transition-all text-slate-700 leading-relaxed",placeholder:"Datos actuales, grÃ¡ficos simples, estado del problema...",value:s.currentCondition,onChange:p=>i({...s,currentCondition:p.target.value}),minHeight:"160px"}),e.jsx("div",{className:"mt-3",children:s.currentConditionImageUrl?e.jsxs("div",{className:"relative group/img",children:[e.jsx("img",{src:s.currentConditionImageUrl,alt:"CondiciÃ³n Actual",className:"w-full h-auto max-h-[300px] object-contain rounded-lg border border-slate-200"}),e.jsx("button",{onClick:()=>i({...s,currentConditionImageUrl:""}),className:"absolute top-2 right-2 bg-white/90 p-1.5 rounded-full text-red-500 opacity-0 group-hover/img:opacity-100 transition-opacity shadow-sm",children:e.jsx(Y,{size:16})})]}):e.jsxs("label",{className:"flex items-center gap-2 text-sm text-brand-600 font-bold cursor-pointer hover:bg-brand-50 p-2 rounded-lg transition-colors w-fit",children:[e.jsx(rs,{size:16})," Adjuntar Imagen",e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:p=>o(p.target.files[0],"currentConditionImageUrl")})]})})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-slate-200 md:col-span-2 group hover:shadow-md transition-shadow",children:[e.jsxs("h4",{className:"font-bold text-slate-800 border-b border-slate-100 pb-3 mb-4 flex items-center gap-3",children:[e.jsx("span",{className:"bg-slate-900 text-white w-6 h-6 rounded-lg flex items-center justify-center text-xs font-bold",children:"3"}),"Objetivo / Meta"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsx(Ae,{className:"w-full p-4 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-brand-500 outline-none transition-all text-slate-700 leading-relaxed",placeholder:"Meta especÃ­fica, medible y acotada en el tiempo...",value:s.goal,onChange:p=>i({...s,goal:p.target.value}),minHeight:"100px"})}),e.jsxs("div",{className:"space-y-4 bg-slate-50 p-4 rounded-xl border border-slate-100",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-700 uppercase mb-1 block",children:"Responsable"}),e.jsxs("div",{className:"relative",children:[e.jsx(re,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"}),e.jsxs("select",{className:"w-full py-2 pl-9 pr-3 bg-white border border-slate-200 rounded-lg focus:ring-2 focus:ring-brand-500 outline-none text-sm text-slate-900 font-medium",value:s.responsible,onChange:p=>i({...s,responsible:p.target.value}),children:[e.jsx("option",{value:"",disabled:!0,className:"text-slate-500",children:"Seleccionar"}),d&&d.length>0?d.map(p=>e.jsx("option",{value:p.name,className:"text-slate-900",children:p.name},p.id)):e.jsxs(e.Fragment,{children:[s.responsible&&e.jsx("option",{value:s.responsible,className:"text-slate-900",children:s.responsible}),e.jsx("option",{value:"",disabled:!0,className:"text-slate-500",children:"No disponible"})]})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-700 uppercase mb-1 block",children:"Fecha Inicio"}),e.jsxs("div",{className:"relative",children:[e.jsx(le,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"}),e.jsx("input",{type:"date",className:"w-full py-2 pl-9 pr-3 bg-white border border-slate-200 rounded-lg focus:ring-2 focus:ring-brand-500 outline-none text-sm text-slate-900 font-medium",value:s.date,onChange:p=>i({...s,date:p.target.value})})]})]})]})]})]})]})}),l==="analysis"&&e.jsxs("div",{className:"max-w-7xl mx-auto space-y-10 animate-in fade-in slide-in-from-bottom-4 duration-300",children:[e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-slate-200",children:[e.jsxs("h4",{className:"font-bold text-slate-800 border-b border-slate-100 pb-3 mb-4 flex items-center gap-3",children:[e.jsx("span",{className:"bg-slate-900 text-white w-6 h-6 rounded-lg flex items-center justify-center text-xs font-bold",children:"4"}),"Resumen AnÃ¡lisis Causa RaÃ­z"]}),e.jsx(Ae,{className:"w-full p-4 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-brand-500 outline-none transition-all text-slate-700 leading-relaxed",placeholder:"Resumen de las conclusiones principales y hallazgos...",value:s.rootCause,onChange:p=>i({...s,rootCause:p.target.value}),minHeight:"100px"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center px-2",children:[e.jsxs("h5",{className:"font-bold text-slate-700 text-lg uppercase flex items-center gap-2 tracking-tight",children:[e.jsx("div",{className:"p-1.5 bg-blue-50 text-blue-600 rounded-lg",children:e.jsx(Ge,{size:20})}),"Diagramas de Ishikawa"]}),e.jsxs("button",{onClick:L,className:"flex items-center gap-2 text-sm font-bold text-brand-600 hover:text-brand-700 bg-brand-50 hover:bg-brand-100 px-4 py-2 rounded-lg transition-colors",children:[e.jsx(J,{size:16}),e.jsx("span",{children:"Agregar Diagrama"})]})]}),!s.ishikawas||s.ishikawas.length===0?e.jsxs("div",{className:"text-center py-16 bg-slate-50 rounded-2xl border-2 border-dashed border-slate-200",children:[e.jsx("div",{className:"inline-flex p-4 rounded-full bg-white shadow-sm mb-4",children:e.jsx(Ge,{size:32,className:"text-slate-300"})}),e.jsx("p",{className:"text-slate-500 text-sm mb-4 font-medium",children:"No hay diagramas de causa-efecto."}),e.jsx("button",{onClick:L,className:"btn-primary py-2 px-4 shadow-sm",children:"Crear Diagrama Ishikawa"})]}):e.jsx("div",{className:"space-y-8",children:s.ishikawas.map((p,D)=>e.jsx("div",{className:"relative group bg-white p-1 rounded-2xl shadow-sm border border-slate-200 hover:shadow-md transition-shadow",children:e.jsx(qt,{index:D,data:p,onChange:(A,T)=>$(D,A,T),onDelete:()=>v(D)})},D))})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex justify-between items-center px-2 border-t border-slate-200 pt-8",children:e.jsxs("h5",{className:"font-bold text-slate-700 text-lg uppercase flex items-center gap-2 tracking-tight",children:[e.jsx("div",{className:"p-1.5 bg-purple-50 text-purple-600 rounded-lg",children:e.jsx(ie,{size:20})}),"AnÃ¡lisis de 5 PorquÃ©s"]})}),e.jsx("div",{className:"bg-white p-6 rounded-2xl border border-slate-200 shadow-sm overflow-hidden",children:e.jsx(Ut,{items:s.multipleFiveWhys||[],onChange:p=>i({...s,multipleFiveWhys:p})})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex justify-between items-center px-2 border-t border-slate-200 pt-8",children:e.jsxs("h5",{className:"font-bold text-slate-900 text-lg uppercase flex items-center gap-2 tracking-tight",children:[e.jsx("div",{className:"p-1.5 bg-indigo-50 text-indigo-600 rounded-lg",children:e.jsx(Oe,{size:20})}),"AnÃ¡lisis de Pareto (80/20)"]})}),e.jsx("div",{className:"bg-white p-2 rounded-2xl shadow-sm border border-slate-200",children:e.jsx(Gt,{data:s.paretoData||[],onChange:p=>i({...s,paretoData:p})})})]})]}),l==="plan"&&e.jsxs("div",{className:"max-w-7xl mx-auto space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-300",children:[e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-slate-200",children:[e.jsxs("h4",{className:"font-bold text-slate-800 border-b border-slate-100 pb-3 mb-4 flex items-center gap-3",children:[e.jsx("span",{className:"bg-slate-900 text-white w-6 h-6 rounded-lg flex items-center justify-center text-xs font-bold",children:"5"}),"Contramedidas (Estrategia)"]}),e.jsx(Ae,{className:"w-full p-4 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-brand-500 outline-none transition-all text-slate-700 leading-relaxed",placeholder:"Estrategia general para eliminar causas raÃ­z...",value:s.countermeasures,onChange:p=>i({...s,countermeasures:p.target.value}),minHeight:"120px"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden",children:[e.jsx("div",{className:"p-6 border-b border-slate-100",children:e.jsxs("h4",{className:"font-bold text-slate-800 flex items-center gap-3",children:[e.jsx("span",{className:"bg-slate-900 text-white w-6 h-6 rounded-lg flex items-center justify-center text-xs font-bold",children:"6"}),"Plan de AcciÃ³n"]})}),e.jsx("div",{className:"p-2",children:e.jsx(Bt,{actions:s.actionPlan||[],onChange:F,users:d||[]})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden",children:[e.jsx("div",{className:"p-6 border-b border-slate-100 flex justify-between items-center",children:e.jsxs("h4",{className:"font-bold text-slate-800 flex items-center gap-3",children:[e.jsx("span",{className:"bg-slate-900 text-white w-6 h-6 rounded-lg flex items-center justify-center text-xs font-bold",children:"7"}),"Seguimiento y Resultados"]})}),e.jsxs("div",{className:"p-6",children:[!s.followUpData||s.followUpData.length===0?e.jsxs("div",{className:"text-center py-12 border-2 border-dashed border-slate-200 rounded-xl bg-slate-50 mb-6",children:[e.jsx(Oe,{className:"mx-auto text-slate-300 mb-3",size:32}),e.jsx("p",{className:"text-slate-500 text-sm mb-4",children:"No hay grÃ¡ficos de seguimiento."}),e.jsx("button",{onClick:f,className:"px-4 py-2 bg-brand-600 text-white rounded-lg text-sm font-bold shadow-sm hover:bg-brand-700",children:"+ Crear Primer GrÃ¡fico"})]}):e.jsxs("div",{className:"space-y-12",children:[s.followUpData.map((p,D)=>e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute top-0 right-0 z-10 p-2",children:e.jsx("button",{onClick:()=>O(D),className:"p-1.5 text-slate-300 hover:text-red-500 hover:bg-red-50 rounded-lg transition-colors",title:"Eliminar GrÃ¡fico",children:e.jsx(Y,{size:16})})}),e.jsx(Wt,{data:p,onChange:(A,T)=>C(D,A,T)}),D<s.followUpData.length-1&&e.jsx("div",{className:"h-px bg-slate-200 my-8 mx-auto w-3/4"})]},D)),e.jsx("div",{className:"flex justify-center pt-4",children:e.jsxs("button",{onClick:f,className:"flex items-center gap-2 px-4 py-2 bg-slate-100 text-slate-600 hover:bg-slate-200 hover:text-slate-800 rounded-lg text-sm font-bold transition-colors",children:[e.jsx(J,{size:16})," Agregar Otro GrÃ¡fico"]})})]}),e.jsxs("div",{className:"mt-6 bg-slate-50 p-4 rounded-xl border border-slate-100",children:[e.jsxs("label",{className:"text-xs font-bold text-slate-700 uppercase mb-2 block flex items-center gap-2",children:[e.jsx(fe,{size:14})," Notas de Cierre / EstandarizaciÃ³n"]}),e.jsx(Ae,{className:"w-full p-3 bg-white border border-slate-200 rounded-lg focus:ring-2 focus:ring-brand-500 outline-none transition-all text-slate-900 placeholder:text-slate-400",placeholder:"Comentarios finales sobre los resultados y prÃ³ximos pasos...",value:s.followUp,onChange:p=>i({...s,followUp:p.target.value}),minHeight:"80px"})]})]})]})]})]})]})})]})},$e={logAction:async(t,r,d,m={})=>{try{const{data:{user:s}}=await U.auth.getUser(),{error:i}=await U.from("audit_logs").insert({action:t,entity_type:r,entity_id:String(d),details:m,user_id:s==null?void 0:s.id,user_email:s==null?void 0:s.email});i&&console.error("Error logging audit action:",i)}catch(s){console.error("Exception in AuditService.logAction:",s)}},getLogs:async(t,r=50)=>{try{let d=U.from("audit_logs").select("*").order("created_at",{ascending:!1}).limit(r);t&&(d=d.eq("entity_type",t));const{data:m,error:s}=await d;if(s)throw s;return m||[]}catch(d){return console.error("Error fetching audit logs:",d),[]}}},ms=({onClick:t,icon:r=J,label:d})=>e.jsxs("button",{onClick:t,className:"fixed bottom-6 right-6 z-40 bg-brand-600 text-white p-4 rounded-full shadow-lg shadow-brand-500/40 hover:bg-brand-700 active:scale-95 transition-all md:hidden flex items-center gap-2 group",children:[e.jsx(r,{size:24}),d&&e.jsx("span",{className:"max-w-0 overflow-hidden group-hover:max-w-xs transition-all duration-300 whitespace-nowrap font-bold",children:d})]}),Ye=({onCapture:t,currentImage:r,label:d="Tomar Foto"})=>{const m=j.useRef(null),[s,i]=j.useState(r),[N,w]=j.useState(!1),l=async a=>{const x=a.target.files[0];if(x){w(!0);try{const h=new FileReader;h.onloadend=()=>{const b=h.result;i(b),t.length>1?t(x,b):t(b),w(!1)},h.readAsDataURL(x)}catch(h){console.error("Error creating preview",h),w(!1)}}},z=()=>{var a;(a=m.current)==null||a.click()},n=a=>{a.stopPropagation(),i(null),t(null),m.current&&(m.current.value="")};return e.jsxs("div",{className:"w-full",children:[e.jsx("input",{type:"file",accept:"image/*",capture:"environment",className:"hidden",ref:m,onChange:l}),s?e.jsxs("div",{className:"relative w-full aspect-video rounded-2xl overflow-hidden shadow-sm border border-slate-200 group",children:[e.jsx("img",{src:s,alt:"Captured",className:"w-full h-full object-cover"}),N&&e.jsxs("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center text-white font-bold",children:[e.jsx(He,{className:"animate-spin mr-2"})," Procesando..."]}),e.jsxs("div",{className:"absolute top-2 right-2 flex gap-2",children:[e.jsx("button",{onClick:z,className:"p-2 bg-black/50 text-white rounded-full backdrop-blur-md hover:bg-black/70",children:e.jsx(He,{size:20})}),e.jsx("button",{onClick:n,className:"p-2 bg-red-500/80 text-white rounded-full backdrop-blur-md hover:bg-red-600",children:e.jsx(Y,{size:20})})]})]}):e.jsxs("div",{onClick:z,className:"w-full aspect-video bg-slate-100 rounded-2xl border-2 border-dashed border-slate-300 flex flex-col items-center justify-center cursor-pointer active:bg-slate-200 transition-colors gap-2",children:[e.jsx("div",{className:"p-4 bg-white rounded-full shadow-sm",children:e.jsx(Re,{size:32,className:"text-brand-600"})}),e.jsx("span",{className:"font-bold text-slate-500 text-sm",children:d})]})]})},Kt=()=>{const{user:t,companyUsers:r,globalFilterCompanyId:d}=Z(),{fiveSCards:m,loadingFiveS:s,fetchFiveSCards:i,addFiveSCard:N,updateFiveSCard:w,removeFiveSCard:l}=Rs(),z=Xe(),[n,a]=j.useState(null),[x,h]=j.useState(""),[b,k]=j.useState(""),[S,L]=j.useState(""),[v,$]=j.useState(!1),[f,O]=j.useState(!1),C=j.useMemo(()=>m.filter(u=>u.isOffline).length,[m]);j.useEffect(()=>{const u=()=>{console.log("App is back online! Syncing..."),o()};return window.addEventListener("online",u),()=>window.removeEventListener("online",u)},[o]);const F=j.useCallback(async u=>{const _=u.name?u.name.split(".").pop():"jpg",y=`${`${Math.random().toString(36).substring(2,15)}_${Date.now()}.${_}`}`,{error:M}=await U.storage.from("images").upload(y,u);if(M)throw M;const{data:P}=U.storage.from("images").getPublicUrl(y);return P.publicUrl},[]),o=j.useCallback(async()=>{if(!f)try{O(!0);const u=await me.getAllCards();if(u.length===0){C>0?(alert("No se encontraron datos locales. Actualizando lista..."),i()):alert("No hay tarjetas pendientes para sincronizar.");return}console.log(`Intentando sincronizar ${u.length} tarjetas...`);let _=0,g=0,y=[];for(const M of u)try{let P=M.data.image_before,G=M.data.image_after;M.files&&M.files.imageBefore instanceof Blob&&(P=await F(M.files.imageBefore)),M.files&&M.files.imageAfter instanceof Blob&&(G=await F(M.files.imageAfter));const Q={...M.data,image_before:P,image_after:G,company_id:M.data.company_id||t.companyId||(d!=="all"?d:null)},{error:H}=await U.from("five_s_cards").insert([Q]);if(H)throw new Error(H.message);await me.deleteCard(M.tempId),_++}catch(P){console.error(`Failed to sync card ${M.tempId}:`,P),g++,y.push(P.message)}await i(),_>0&&g===0?alert(`Â¡SincronizaciÃ³n exitosa! Se subieron ${_} tarjetas.`):g>0&&alert(`SincronizaciÃ³n parcial.
Subidas: ${_}
Fallidos: ${g}
Errores: ${y.join(", ")}`)}catch(u){console.error("Critical Sync error:",u),alert("Error crÃ­tico al sincronizar: "+u.message)}finally{O(!1)}},[f,C,i,F,t,d]);j.useEffect(()=>{const _=new URLSearchParams(z.search).get("cardId");if(_&&m.length>0){const g=m.find(y=>y.id===parseInt(_)||y.id===_);g&&a(g)}},[z.search,m]);const p=j.useMemo(()=>{if(!t)return[];const _=t.role==="admin"||t.email==="ariel.mellag@gmail.com"?d:t.companyId;return _==="all"||!_?m:m.filter(g=>g.companyId==_||g.responsible===t.name||!g.companyId)},[m,t,d]),D=j.useMemo(()=>{const u=r?r.map(y=>y.name):[],_=p.map(y=>y.responsible).concat(p.map(y=>y.reporter)),g=[...u,..._].filter(y=>y&&y.trim().length>0);return[...new Set(g)].sort()},[p,r]),A=j.useMemo(()=>{const u=p.map(_=>_.location).filter(_=>_&&_.trim().length>0);return[...new Set(u)].sort()},[p]),T=j.useMemo(()=>p.filter(u=>{var P,G,Q,H;const _=x.toLowerCase(),g=S?u.location===S:!0,y=b?u.responsible===b:!0,M=(((P=u.location)==null?void 0:P.toLowerCase())||"").includes(_)||(((G=u.article)==null?void 0:G.toLowerCase())||"").includes(_)||(((Q=u.responsible)==null?void 0:Q.toLowerCase())||"").includes(_)||(((H=u.reason)==null?void 0:H.toLowerCase())||"").includes(_);return g&&y&&M}),[p,x,S,b]),V=j.useMemo(()=>{const u=T.length;if(u===0)return{statusData:[],locationData:[],completionRate:0,pending:0,inProcess:0,closed:0,total:0};const _=T.reduce((H,ee)=>(H[ee.status]=(H[ee.status]||0)+1,H),{}),g=_.Cerrado||0,y=_.Pendiente||0,M=_["En Proceso"]||0,P=[{name:"Cerrado",value:g,color:"#10b981"},{name:"En Proceso",value:M,color:"#f59e0b"},{name:"Pendiente",value:y,color:"#ef4444"}].filter(H=>H.value>0),G=T.reduce((H,ee)=>(H[ee.location]=(H[ee.location]||0)+1,H),{}),Q=Object.entries(G).map(([H,ee])=>({name:H,count:ee})).sort((H,ee)=>ee.count-H.count).slice(0,5);return{statusData:P,locationData:Q,completionRate:Math.round(g/u*100),closed:g,pending:y,inProcess:M,total:u}},[T]),E=()=>{a({id:null,date:new Date().toISOString().split("T")[0],location:"",article:"",reporter:"",reason:"",proposedAction:"",responsible:"",targetDate:"",solutionDate:"",status:"Pendiente",statusColor:"#ef4444",type:"Clasificar",imageBefore:null,imageAfter:null})},W=u=>{a({...u})},B=async()=>{if(!n.location||!n.reason){alert("Por favor completa al menos la ubicaciÃ³n y el hallazgo.");return}if(n.status==="Cerrado"&&(!n.imageBefore||!n.imageAfter)){alert("Para cerrar la tarjeta, debes adjuntar ambas evidencias fotogrÃ¡ficas (Antes y DespuÃ©s).");return}let u=n.companyId;if(r&&n.responsible){const y=r.find(M=>M.name===n.responsible);y&&y.company_id&&(u=y.company_id)}u||(u=t.companyId||(d!=="all"?d:null));const _={date:n.date,location:n.location,article:n.article,reporter:n.reporter,reason:n.reason,proposed_action:n.proposedAction,responsible:n.responsible,target_date:n.targetDate||null,solution_date:n.solutionDate||null,status:n.status,type:n.type,company_id:u},g=!window.navigator.onLine;try{if(g){if(n.id){alert("En modo offline solo puedes crear nuevas tarjetas, no editar existentes.");return}const y={..._},P={id:(await me.saveCard(y,n.imageBeforeFile,n.imageAfterFile)).tempId,cardNumber:"OFF",..._,status:"Pendiente de subir",statusColor:"#94a3b8",isOffline:!0,imageBefore:n.imageBeforeFile?URL.createObjectURL(n.imageBeforeFile):n.imageBefore,imageAfter:n.imageAfterFile?URL.createObjectURL(n.imageAfterFile):n.imageAfter};N(P),alert("Sin conexiÃ³n: Tarjeta guardada localmente. Se subirÃ¡ automÃ¡ticamente cuando recuperes la conexiÃ³n."),c()}else{let y=n.imageBefore,M=n.imageAfter;if(n.imageBeforeFile&&(y=await F(n.imageBeforeFile)),n.imageAfterFile&&(M=await F(n.imageAfterFile)),_.image_before=y,_.image_after=M,n.id){const{error:P}=await U.from("five_s_cards").update(_).eq("id",n.id);if(P)throw P;$e.logAction("UPDATE","5S_CARD",n.id,{changes:_,previousStatus:n.status}),w(n.id,{..._,statusColor:_.status==="Cerrado"?"#10b981":_.status==="En Proceso"?"#f59e0b":"#ef4444"})}else{const{data:P,error:G}=await U.from("five_s_cards").insert([_]).select();if(G)throw G;P&&P[0]&&$e.logAction("CREATE","5S_CARD",P[0].id,{initialData:_}),P&&i()}c()}}catch(y){console.error("Error saving card:",y),alert("Error al guardar la tarjeta: "+y.message)}},I=async()=>{if(window.confirm("Â¿EstÃ¡s seguro de que quieres eliminar esta tarjeta? Esta acciÃ³n no se puede deshacer."))try{if(n.isOffline)await me.deleteCard(n.id),l(n.id),alert("Tarjeta local eliminada.");else{const{error:u}=await U.from("five_s_cards").delete().eq("id",n.id);if(u)throw u;$e.logAction("DELETE","5S_CARD",n.id,{deletedData:{location:n.location,reason:n.reason,cardNumber:n.cardNumber,responsible:n.responsible}}),l(n.id),alert("Tarjeta eliminada correctamente.")}c()}catch(u){console.error("Error deleting card:",u),alert("Error al eliminar la tarjeta: "+u.message)}},c=()=>{a(null)},R=(u,_,g)=>{q(u,g),q(u+"File",_)},q=(u,_)=>{a(g=>({...g,[u]:_}))};return e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6 pb-20 animate-in fade-in duration-500",children:[e.jsx(ve,{title:"Tarjetas 5S",subtitle:"GestiÃ³n visual de anomalÃ­as y mejoras continuas",children:e.jsxs("button",{onClick:E,className:"flex items-center gap-2 bg-brand-600 hover:bg-brand-700 text-white px-4 py-2.5 rounded-lg transition-all shadow-sm shadow-brand-500/30 hover:shadow-brand-500/50 font-medium active:scale-95",children:[e.jsx(J,{size:20}),e.jsx("span",{children:"Nueva Tarjeta"})]})}),e.jsxs("div",{className:"bg-white p-4 rounded-xl shadow-sm border border-slate-200 flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1 min-w-[240px]",children:[e.jsx(Ce,{size:18,className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"Buscar por ubicaciÃ³n, artÃ­culo, responsable...",className:"w-full pl-10 pr-4 py-2.5 bg-white border border-slate-300 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-brand-500 transition-all text-sm outline-none text-black placeholder-slate-500",value:x,onChange:u=>h(u.target.value)})]}),e.jsxs("div",{className:"flex items-center gap-3 overflow-x-auto pb-1 sm:pb-0",children:[e.jsxs("div",{className:"relative min-w-[200px]",children:[e.jsxs("select",{className:"w-full pl-4 pr-10 py-2.5 bg-white border border-slate-300 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-brand-500 transition-all text-sm appearance-none outline-none cursor-pointer text-black font-medium",value:b,onChange:u=>k(u.target.value),children:[e.jsx("option",{value:"",className:"text-gray-500",children:"Todos los Responsables"}),D.map((u,_)=>e.jsx("option",{value:u,className:"text-black",children:u},_))]}),e.jsx(Se,{size:14,className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 pointer-events-none"})]}),e.jsxs("div",{className:"relative min-w-[180px]",children:[e.jsxs("select",{className:"w-full pl-4 pr-10 py-2.5 bg-white border border-slate-300 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-brand-500 transition-all text-sm appearance-none outline-none cursor-pointer text-black font-medium",value:S,onChange:u=>L(u.target.value),children:[e.jsx("option",{value:"",className:"text-gray-500",children:"Todas las Ãreas"}),A.map((u,_)=>e.jsx("option",{value:u,className:"text-black",children:u},_))]}),e.jsx(Se,{size:14,className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 pointer-events-none"})]}),(b||S||x)&&e.jsx("button",{onClick:()=>{k(""),L(""),h("")},className:"p-2.5 text-red-500 bg-red-50 hover:bg-red-100 rounded-lg transition-colors flex-shrink-0",title:"Limpiar Filtros",children:e.jsx(ae,{size:20})}),e.jsx("button",{onClick:()=>$(!0),className:"p-2.5 text-slate-500 bg-slate-100 hover:bg-slate-200 rounded-lg transition-colors flex-shrink-0",title:"Ver Historial de Cambios",children:e.jsx(qe,{size:20})}),C>0&&e.jsx("button",{onClick:o,disabled:f,className:`ml-auto flex items-center gap-2 px-4 py-2.5 rounded-lg shadow-sm font-medium transition-all ${f?"bg-slate-100 text-slate-400 cursor-wait":"bg-yellow-500 hover:bg-yellow-600 text-white shadow-yellow-500/30"}`,children:f?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin h-4 w-4 border-2 border-slate-400 border-t-transparent rounded-full"}),e.jsx("span",{children:"Sincronizando..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(ps,{size:20}),e.jsxs("span",{children:["Sincronizar (",C,")"]})]})})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:s&&m.length===0?Array.from({length:8}).map((u,_)=>e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden h-[380px] animate-pulse",children:[e.jsx("div",{className:"h-1.5 bg-slate-200 w-full mb-0"}),e.jsxs("div",{className:"p-5 flex flex-col h-full",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("div",{className:"h-6 w-16 bg-slate-200 rounded"}),e.jsx("div",{className:"h-4 w-20 bg-slate-200 rounded"})]}),e.jsxs("div",{className:"space-y-3 mb-6",children:[e.jsx("div",{className:"h-6 w-3/4 bg-slate-200 rounded"}),e.jsx("div",{className:"h-4 w-full bg-slate-200 rounded"}),e.jsx("div",{className:"h-4 w-5/6 bg-slate-200 rounded"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-0.5 mb-4 h-32",children:[e.jsx("div",{className:"bg-slate-200 h-full w-full"}),e.jsx("div",{className:"bg-slate-200 h-full w-full"})]}),e.jsxs("div",{className:"mt-auto pt-4 flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-6 w-6 rounded-full bg-slate-200"}),e.jsx("div",{className:"h-4 w-20 bg-slate-200 rounded"})]}),e.jsx("div",{className:"h-4 w-16 bg-slate-200 rounded"})]})]})]},_)):T.length>0?T.map(u=>e.jsxs("div",{className:`group bg-white rounded-xl shadow-sm border ${u.isOffline?"border-dashed border-slate-400 bg-slate-50":"border-slate-200"} overflow-hidden hover:shadow-xl hover:-translate-y-1 transition-all duration-300 cursor-pointer flex flex-col h-full`,onClick:()=>{u.isOffline?window.confirm("Esta tarjeta estÃ¡ pendiente de subir. Â¿Deseas intentar sincronizarla ahora?")&&o():W(u)},children:[e.jsx("div",{className:`h-1.5 w-full transition-all ${u.isOffline?"bg-slate-400":""}`,style:{backgroundColor:u.isOffline?void 0:u.statusColor}}),e.jsxs("div",{className:"p-5 flex flex-col flex-1",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("span",{className:`px-2.5 py-1 rounded-md text-xs font-bold uppercase tracking-wider border transition-colors ${u.isOffline?"bg-slate-200 text-slate-600 border-slate-300":"bg-slate-100 text-slate-600 border-slate-200 group-hover:bg-brand-50 group-hover:text-brand-600 group-hover:border-brand-100"}`,children:["#",isNaN(u.cardNumber)?"?":String(u.cardNumber).padStart(3,"0")]}),u.isOffline?e.jsxs("span",{className:"text-xs text-slate-500 font-bold flex items-center gap-1 bg-yellow-100 px-2 py-0.5 rounded-full border border-yellow-200",children:[e.jsx(ps,{size:12})," Pendiente"]}):e.jsx("span",{className:"text-xs text-slate-400 font-medium flex items-center gap-1",children:u.date})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"font-bold text-slate-800 mb-1 line-clamp-1 text-lg group-hover:text-brand-600 transition-colors",children:u.location}),e.jsx("p",{className:"text-sm text-slate-500 line-clamp-2 leading-relaxed h-[42px]",children:u.reason})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-0.5 bg-slate-100 rounded-lg overflow-hidden border border-slate-200 mb-4 h-32 relative",children:[u.imageBefore?e.jsxs("div",{className:"relative h-full overflow-hidden w-full",children:[e.jsx("img",{src:u.imageBefore,alt:"Antes",className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"}),e.jsx("span",{className:"absolute bottom-0 left-0 right-0 bg-black/60 text-white text-[9px] uppercase font-bold text-center py-1 backdrop-blur-sm",children:"Antes"})]}):e.jsx("div",{className:"flex items-center justify-center h-full bg-slate-50 text-slate-300 w-full",children:e.jsx(Re,{size:20})}),u.imageAfter?e.jsxs("div",{className:"relative h-full overflow-hidden w-full",children:[e.jsx("img",{src:u.imageAfter,alt:"DespuÃ©s",className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"}),e.jsx("span",{className:"absolute bottom-0 left-0 right-0 bg-emerald-600/80 text-white text-[9px] uppercase font-bold text-center py-1 backdrop-blur-sm",children:"DespuÃ©s"})]}):e.jsx("div",{className:"flex items-center justify-center h-full bg-slate-50 text-slate-200 border-l border-slate-200 w-full",children:u.imageBefore&&e.jsx(xe,{size:16,className:"text-slate-300"})})]}),e.jsxs("div",{className:"mt-auto pt-4 border-t border-slate-100 flex justify-between items-center bg-white",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-gradient-to-br from-slate-100 to-slate-200 flex items-center justify-center text-[10px] font-bold text-slate-600 border border-white shadow-sm ring-1 ring-slate-100",children:u.responsible?u.responsible.charAt(0):"?"}),e.jsx("span",{className:"text-xs font-medium text-slate-600 truncate max-w-[90px]",children:u.responsible||"Sin asignar"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-2 h-2 rounded-full shadow-sm",style:{backgroundColor:u.statusColor}}),e.jsx("span",{className:"text-xs font-bold",style:{color:u.statusColor},children:u.status})]})]})]})]},u.id)):e.jsxs("div",{className:"col-span-full py-16 text-center bg-slate-50/50 rounded-2xl border-2 border-dashed border-slate-200",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-white shadow-sm mb-4",children:e.jsx(Ce,{size:32,className:"text-slate-300"})}),e.jsx("h3",{className:"text-lg font-medium text-slate-900 mb-1",children:"No se encontraron tarjetas"}),e.jsx("p",{className:"text-slate-500",children:"Intenta ajustar los filtros de bÃºsqueda."})]})}),T.length>0&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-md border border-slate-200 p-8 mt-8",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-8 pb-4 border-b border-slate-100",children:[e.jsx("div",{className:"p-2.5 bg-brand-50 text-brand-600 rounded-lg",children:e.jsx(tt,{size:24})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900",children:"Indicadores de GestiÃ³n"}),e.jsx("p",{className:"text-sm text-slate-500",children:"AnÃ¡lisis visual de anomalÃ­as y mejoras"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 content-start",children:[e.jsx(oe,{title:"Total Tarjetas",value:V.total,variant:"blue",type:"outlined"}),e.jsx(oe,{title:"Cumplimiento",value:`${V.completionRate}%`,variant:"green",type:"outlined"}),e.jsx(oe,{title:"Pendientes",value:V.pending,variant:"red",type:"outlined"}),e.jsx(oe,{title:"En Proceso",value:V.inProcess,variant:"orange",type:"outlined"})]}),e.jsxs("div",{className:"bg-slate-50/50 rounded-xl p-5 border border-slate-100",children:[e.jsx("h4",{className:"text-center text-xs font-bold text-slate-500 mb-6 uppercase tracking-wider flex items-center justify-center gap-2",children:"DistribuciÃ³n por Estado"}),e.jsx("div",{className:"h-[200px]",style:{width:"100%",height:200},children:e.jsx(te,{width:"100%",height:"100%",minWidth:100,minHeight:100,children:e.jsxs(De,{children:[e.jsx(Te,{data:V.statusData,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"value",stroke:"none",children:V.statusData.map((u,_)=>e.jsx(ue,{fill:u.color},`cell-${_}`))}),e.jsx(ne,{contentStyle:{borderRadius:"8px",border:"none",boxShadow:"0 4px 6px -1px rgba(0,0,0,0.1)"}}),e.jsx(Pe,{verticalAlign:"bottom",height:36,iconType:"circle"})]})})})]}),e.jsxs("div",{className:"bg-slate-50/50 rounded-xl p-5 border border-slate-100",children:[e.jsx("h4",{className:"text-center text-xs font-bold text-slate-500 mb-6 uppercase tracking-wider flex items-center justify-center gap-2",children:"Top Ãreas con Hallazgos"}),e.jsx("div",{className:"h-[200px]",style:{width:"100%",height:200},children:e.jsx(te,{width:"100%",height:"100%",minWidth:100,minHeight:100,children:e.jsxs(Je,{data:V.locationData,layout:"vertical",margin:{top:5,right:10,left:10,bottom:5},children:[e.jsx(ge,{strokeDasharray:"3 3",horizontal:!1,stroke:"#e2e8f0"}),e.jsx(he,{type:"number",hide:!0}),e.jsx(be,{type:"category",dataKey:"name",width:100,tick:{fontSize:11,fill:"#64748b"},axisLine:!1,tickLine:!1}),e.jsx(ne,{cursor:{fill:"#f1f5f9"},contentStyle:{borderRadius:"8px",border:"none",boxShadow:"0 4px 6px -1px rgba(0,0,0,0.1)"}}),e.jsx(_e,{dataKey:"count",fill:"#6366f1",radius:[0,4,4,0],barSize:20})]})})})]})]})]}),n&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-0 md:p-4 animate-in fade-in duration-200",onClick:c,children:e.jsxs("div",{className:"bg-white rounded-none md:rounded-2xl shadow-2xl w-full h-full md:h-auto max-w-4xl max-h-[100vh] md:max-h-[90vh] overflow-y-auto flex flex-col",onClick:u=>u.stopPropagation(),children:[e.jsxs("div",{className:"px-4 md:px-8 py-4 border-b border-slate-100 flex justify-between items-center bg-white sticky top-0 z-10 rounded-t-2xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2.5 rounded-xl ${n.id?"bg-indigo-50 text-indigo-600":"bg-brand-50 text-brand-600"}`,children:n.id?e.jsx(fe,{size:20}):e.jsx(J,{size:20})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-slate-800",children:n.id?`Tarjeta #${String(n.cardNumber).padStart(3,"0")}`:"Nueva Tarjeta 5S"}),e.jsx("p",{className:"text-xs text-slate-500 hidden sm:block",children:"Complete la informaciÃ³n del hallazgo"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[n.id&&e.jsx("button",{onClick:I,className:"p-2 text-red-500 hover:bg-red-50 rounded-full transition-colors",title:"Eliminar",children:e.jsx(Y,{size:22})}),e.jsx("button",{onClick:B,className:"p-2 text-brand-600 hover:bg-brand-50 rounded-full transition-colors",title:"Guardar",children:e.jsx(Jt,{size:22})}),e.jsx("button",{onClick:c,className:"p-2 text-slate-400 hover:text-slate-600 hover:bg-slate-100 rounded-full transition-colors",children:e.jsx(ae,{size:22})})]})]}),e.jsxs("div",{className:"p-8 grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6",children:[e.jsx("datalist",{id:"person-suggestions",children:D.map((u,_)=>e.jsx("option",{value:u},_))}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-semibold text-slate-700",children:[e.jsx(le,{size:16,className:"text-slate-400"})," Fecha Tarjeta"]}),e.jsx("input",{type:"date",className:"w-full p-2.5 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-brand-500 outline-none transition-all shadow-sm",value:n.date||"",onChange:u=>q("date",u.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-bold text-black flex items-center gap-2",children:[e.jsx(at,{size:16,className:"text-slate-600"})," UbicaciÃ³n"]}),e.jsx("input",{type:"text",className:"w-full p-3 bg-white border border-slate-300 rounded-lg focus:ring-2 focus:ring-brand-500 outline-none transition-all font-medium text-black placeholder-slate-500 shadow-sm",value:n.location||"",onChange:u=>q("location",u.target.value),placeholder:"Ej: Pasillo 4, LÃ­nea 2"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-bold text-black flex items-center gap-2",children:[e.jsx(fe,{size:16,className:"text-slate-600"})," ArtÃ­culo / Equipo"]}),e.jsx("input",{type:"text",className:"w-full p-3 bg-white border border-slate-300 rounded-lg focus:ring-2 focus:ring-brand-500 outline-none transition-all font-medium text-black placeholder-slate-500 shadow-sm",value:n.article||"",onChange:u=>q("article",u.target.value),placeholder:"Ej: EstanterÃ­a B, Motor 3"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-bold text-black flex items-center gap-2",children:[e.jsx(re,{size:16,className:"text-slate-600"})," Reportado Por"]}),e.jsx("input",{type:"text",className:"w-full p-3 bg-white border border-slate-300 rounded-lg focus:ring-2 focus:ring-brand-500 outline-none transition-all font-medium text-black placeholder-slate-500 shadow-sm",value:n.reporter||"",onChange:u=>q("reporter",u.target.value),list:"person-suggestions",placeholder:"Escribe o selecciona..."})]}),e.jsxs("div",{className:"md:col-span-2 space-y-2",children:[e.jsxs("label",{className:"text-sm font-bold text-black flex items-center gap-2",children:[e.jsx(Le,{size:16,className:"text-amber-500"})," RazÃ³n de Tarjeta (Hallazgo)"]}),e.jsx("textarea",{className:"w-full p-4 bg-white border border-slate-300 rounded-xl focus:ring-2 focus:ring-brand-500 outline-none transition-all resize-none shadow-sm font-medium text-black placeholder-slate-500",rows:"3",value:n.reason||"",onChange:u=>q("reason",u.target.value),placeholder:"Describe detalladamente la anomalÃ­a detectada..."})]}),e.jsxs("div",{className:"md:col-span-2 space-y-2",children:[e.jsxs("label",{className:"text-sm font-bold text-black flex items-center gap-2",children:[e.jsx(K,{size:16,className:"text-emerald-600"})," AcciÃ³n Propuesta"]}),e.jsx("textarea",{className:"w-full p-4 bg-white border border-slate-300 rounded-xl focus:ring-2 focus:ring-brand-500 outline-none transition-all resize-none shadow-sm font-medium text-black placeholder-slate-500",rows:"2",value:n.proposedAction||"",onChange:u=>q("proposedAction",u.target.value),placeholder:"Describe la acciÃ³n correctiva sugerida..."})]}),e.jsx("hr",{className:"md:col-span-2 border-slate-100 my-2"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-bold text-black flex items-center gap-2",children:[e.jsx(re,{size:16,className:"text-slate-600"})," Responsable Asignado"]}),e.jsxs("select",{className:"w-full p-3 bg-white border border-slate-300 rounded-lg focus:ring-2 focus:ring-brand-500 outline-none transition-all shadow-sm text-black font-medium",value:n.responsible||"",onChange:u=>q("responsible",u.target.value),children:[e.jsx("option",{value:"",disabled:!0,children:"Selecciona Responsable"}),r&&r.length>0?r.map(u=>e.jsx("option",{value:u.name,children:u.name},u.id)):e.jsxs(e.Fragment,{children:[n.responsible&&e.jsx("option",{value:n.responsible,children:n.responsible}),e.jsx("option",{value:"",disabled:!0,children:"No hay usuarios disponibles"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-bold text-black flex items-center gap-2",children:[e.jsx(se,{size:16,className:"text-slate-600"})," Estado"]}),e.jsxs("select",{className:"w-full p-3 bg-white border border-slate-300 rounded-lg focus:ring-2 focus:ring-brand-500 outline-none transition-all font-medium shadow-sm text-black cursor-pointer",value:n.status||"Pendiente",onChange:u=>{const _=u.target.value;let g="#ef4444";_==="En Proceso"&&(g="#f59e0b"),_==="Cerrado"&&(g="#10b981"),a(y=>({...y,status:_,statusColor:g}))},children:[e.jsx("option",{value:"Pendiente",children:"Pendiente"}),e.jsx("option",{value:"En Proceso",children:"En Proceso"}),e.jsx("option",{value:"Cerrado",children:"Cerrado"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-bold text-black flex items-center gap-2",children:[e.jsx(qe,{size:16,className:"text-slate-600"})," Fecha Propuesta"]}),e.jsx("input",{type:"date",className:"w-full p-3 bg-white border border-slate-300 rounded-lg focus:ring-2 focus:ring-brand-500 outline-none transition-all shadow-sm text-black font-medium",value:n.targetDate||"",onChange:u=>q("targetDate",u.target.value)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:`text-sm font-bold flex items-center gap-2 ${n.status==="Cerrado"?"text-emerald-700":"text-slate-500"}`,children:[e.jsx(K,{size:16})," Fecha SoluciÃ³n"]}),e.jsx("input",{type:"date",className:"w-full p-3 bg-emerald-50 border border-emerald-200 rounded-lg focus:ring-2 focus:ring-emerald-500 outline-none transition-all disabled:opacity-50 disabled:bg-slate-100 disabled:border-slate-300 disabled:cursor-not-allowed shadow-sm text-black font-medium",value:n.solutionDate||"",onChange:u=>q("solutionDate",u.target.value),disabled:n.status!=="Cerrado"})]}),e.jsxs("div",{className:"md:col-span-2 mt-4 bg-slate-50 p-6 rounded-xl border border-slate-100",children:[e.jsxs("label",{className:"block text-sm font-bold text-slate-700 mb-4 flex items-center gap-2",children:[e.jsx(Re,{size:18,className:"text-brand-500"})," Evidencia FotogrÃ¡fica"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs font-bold text-slate-500 uppercase tracking-wide",children:"1. El Problema (Antes)"}),n.imageBefore&&e.jsxs("span",{className:"text-xs text-emerald-600 font-bold flex items-center gap-1",children:[e.jsx(K,{size:12})," Cargada"]})]}),e.jsxs("div",{className:"h-48 bg-white rounded-xl border-2 border-dashed border-slate-300 overflow-hidden hover:border-brand-400 transition-colors group relative",children:[e.jsx("div",{className:"block md:hidden h-full",children:e.jsx(Ye,{currentImage:n.imageBefore,onCapture:(u,_)=>R("imageBefore",u,_),label:"Tomar Foto (Antes)"})}),e.jsx("div",{className:"hidden md:block h-full",children:e.jsx(je,{currentImage:n.imageBefore,onFileSelect:(u,_)=>R("imageBefore",u,_),placeholderText:"Subir foto del hallazgo"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs font-bold text-slate-500 uppercase tracking-wide",children:"2. La SoluciÃ³n (DespuÃ©s)"}),n.imageAfter&&e.jsxs("span",{className:"text-xs text-emerald-600 font-bold flex items-center gap-1",children:[e.jsx(K,{size:12})," Cargada"]})]}),e.jsxs("div",{className:"h-48 bg-white rounded-xl border-2 border-dashed border-slate-300 overflow-hidden hover:border-brand-400 transition-colors group relative",children:[e.jsx("div",{className:"block md:hidden h-full",children:e.jsx(Ye,{currentImage:n.imageAfter,onCapture:(u,_)=>R("imageAfter",u,_),label:"Tomar Foto (DespuÃ©s)"})}),e.jsx("div",{className:"hidden md:block h-full",children:e.jsx(je,{currentImage:n.imageAfter,onFileSelect:(u,_)=>R("imageAfter",u,_),placeholderText:"Subir foto de la mejora"})})]})]})]})]})]})}),!n&&e.jsx(ms,{icon:Re,onClick:E,label:"Nueva Tarjeta 5S"}),v&&e.jsx(Qt,{onClose:()=>$(!1)})]})},Qt=({onClose:t})=>{const[r,d]=j.useState([]),[m,s]=j.useState(!0);return j.useEffect(()=>{(async()=>{const N=await $e.getLogs("5S_CARD",50);d(N),s(!1)})()},[]),e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4 animate-in fade-in duration-200",onClick:t,children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl w-full max-w-2xl max-h-[80vh] flex flex-col",onClick:i=>i.stopPropagation(),children:[e.jsxs("div",{className:"p-4 border-b border-slate-100 flex justify-between items-center",children:[e.jsxs("h3",{className:"text-lg font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(qe,{size:20,className:"text-slate-500"}),"Historial de Cambios"]}),e.jsx("button",{onClick:t,className:"p-2 hover:bg-slate-100 rounded-full text-slate-500",children:e.jsx(ae,{size:20})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:m?e.jsx("div",{className:"text-center py-10 text-slate-400",children:"Cargando historial..."}):r.length===0?e.jsx("div",{className:"text-center py-10 text-slate-400",children:"No hay registros de cambios recientes."}):r.map(i=>{var N,w,l;return e.jsxs("div",{className:"p-3 bg-slate-50 rounded-lg border border-slate-200 text-sm",children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsx("span",{className:`font-bold text-xs px-2 py-0.5 rounded ${i.action==="DELETE"?"bg-red-100 text-red-700":i.action==="CREATE"?"bg-green-100 text-green-700":"bg-blue-100 text-blue-700"}`,children:i.action==="DELETE"?"ELIMINADO":i.action==="CREATE"?"CREADO":"MODIFICADO"}),e.jsx("span",{className:"text-slate-400 text-xs",children:new Date(i.created_at).toLocaleString()})]}),e.jsxs("div",{className:"text-slate-600",children:[i.user_email&&e.jsxs("div",{className:"text-xs text-slate-400 mb-1",children:["Por: ",i.user_email]}),i.action==="DELETE"&&((N=i.details)==null?void 0:N.deletedData)&&e.jsxs("div",{className:"mt-1 p-2 bg-white rounded border border-slate-100",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"UbicaciÃ³n:"})," ",i.details.deletedData.location]}),e.jsxs("div",{children:[e.jsx("strong",{children:"RazÃ³n:"})," ",i.details.deletedData.reason]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Responsable:"})," ",i.details.deletedData.responsible]})]}),i.action==="UPDATE"&&e.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:["Tarjeta ID: ",i.entity_id," actualizada."]}),i.action==="CREATE"&&e.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:["Nueva tarjeta creada.",((l=(w=i.details)==null?void 0:w.initialData)==null?void 0:l.location)&&e.jsxs("span",{children:[" (",i.details.initialData.location,")"]})]})]})]},i.id)})})]})})},Jt=({size:t,className:r})=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:r,children:[e.jsx("path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"}),e.jsx("polyline",{points:"17 21 17 13 7 13 7 21"}),e.jsx("polyline",{points:"7 3 7 8 15 8"})]}),Yt=()=>{const{user:t,companyUsers:r,globalFilterCompanyId:d}=Z(),m=Xe(),[s,i]=j.useState(""),[N,w]=j.useState("all"),[l,z]=j.useState("all"),[n,a]=j.useState(null),[x,h]=j.useState(!1),[b,k]=j.useState({title:"",description:"",impact:"Medio",responsible:"",deadline:"",image:null}),[S,L]=j.useState([]);j.useEffect(()=>{t&&v()},[t,d]);const v=async()=>{try{const{data:c,error:R}=await U.from("quick_wins").select("*").order("created_at",{ascending:!1});if(R)throw R;if(c){const q=c.map(u=>({id:u.id,title:u.title,description:u.description,status:u.status,impact:u.impact,responsible:u.responsible,deadline:u.deadline,date:u.date,image:u.image_url,completionImage:u.completion_image_url,completionComment:u.completion_comment,completedAt:u.completed_at,companyId:u.company_id,likes:u.likes}));L(q)}}catch(c){console.error("Error fetching Quick Wins:",c),L([])}finally{}};j.useEffect(()=>{const R=new URLSearchParams(m.search).get("winId");if(R&&S.length>0){const q=S.find(u=>u.id===parseInt(R)||u.id===R);q&&a(q)}},[m.search,S]);const $=j.useMemo(()=>{if(!t)return[];const R=t.role==="admin"||t.email==="ariel.mellag@gmail.com"?d:t.companyId;return R==="all"?S:S.filter(q=>q.companyId===R||q.responsible===t.name||!q.companyId)},[S,t,d]),f=j.useMemo(()=>$.filter(c=>{const R=c.title.toLowerCase().includes(s.toLowerCase())||c.description.toLowerCase().includes(s.toLowerCase()),q=N==="all"||c.status===N,u=l==="all"||c.impact===l;return R&&q&&u}),[$,s,N,l]),O=j.useMemo(()=>{const c=$.length,R=$.filter(_=>_.status==="done").length,q=$.filter(_=>_.status==="idea").length,u=$.filter(_=>_.impact==="Alto").length;return{total:c,done:R,ideas:q,highImpact:u}},[$]),C=async()=>{if(!b.title.trim()||!b.description.trim()){alert("Por favor completa el tÃ­tulo y la descripciÃ³n");return}let c=t.companyId;if(r&&b.responsible){const q=r.find(u=>u.name===b.responsible);q&&q.company_id&&(c=q.company_id)}c||(c=d!=="all"?d:null);const R={title:b.title,description:b.description,impact:b.impact,responsible:b.responsible,deadline:b.deadline,date:new Date().toISOString().split("T")[0],status:"idea",image_url:b.image,company_id:c};try{const{data:q,error:u}=await U.from("quick_wins").insert([R]).select();if(u)throw u;q&&(v(),h(!1),k({title:"",description:"",impact:"Medio",responsible:"",deadline:"",image:null}))}catch(q){alert("Error al crear la idea: "+q.message)}},F=async(c,R,q)=>{const u=[...S];L(_=>_.map(g=>g.id===c?{...g,[R]:q}:g)),n&&n.id===c&&a(_=>({..._,[R]:q}));try{const{error:_}=await U.from("quick_wins").update({[R]:q}).eq("id",c);if(_)throw _}catch(_){if(console.error(`Error updating ${R}:`,_),alert(`Error al actualizar ${R}`),L(u),n&&n.id===c){const g=u.find(y=>y.id===c);g&&a(g)}}},o=async(c,R,q={})=>{const u=[...S];L(g=>g.map(y=>y.id===c?{...y,status:R,...q}:y));const _={status:R};q.completionImage&&(_.completion_image_url=q.completionImage),q.completionComment&&(_.completion_comment=q.completionComment),q.completedAt&&(_.completed_at=q.completedAt);try{const{error:g}=await U.from("quick_wins").update(_).eq("id",c);if(g)throw g}catch(g){console.error("Error updating status:",g),alert("Error al actualizar el estado en la base de datos."),L(u)}},[p,D]=j.useState(null),[A,T]=j.useState({image:null,comment:""}),V=c=>{D(c.id),T({image:null,comment:""})},E=()=>{if(!A.image||!A.comment.trim()){alert("Debes subir una foto y agregar un comentario para completar la tarea.");return}o(p,"done",{completionImage:A.image,completionComment:A.comment,completedAt:new Date().toISOString()}),D(null)},W=j.useMemo(()=>{const c=r?r.map(u=>u.name):[],R=$.map(u=>u.responsible),q=[...c,...R].filter(u=>u&&u.trim().length>0);return[...new Set(q)].sort()},[$,r]),B=async c=>{if(window.confirm("Â¿EstÃ¡s seguro de que quieres eliminar esta tarjeta? Esta acciÃ³n no se puede deshacer.")){const R=[...S];L(q=>q.filter(u=>u.id!==c)),a(null);try{const{error:q}=await U.from("quick_wins").delete().eq("id",c);if(q)throw q}catch(q){console.error("Error deleting:",q),alert("Error al eliminar"),L(R)}}},I=c=>{switch(c){case"Alto":return"bg-rose-50 text-rose-600 border-rose-100 ring-rose-500/10";case"Medio":return"bg-amber-50 text-amber-600 border-amber-100 ring-amber-500/10";default:return"bg-slate-50 text-slate-600 border-slate-100 ring-slate-500/10"}};return e.jsxs("div",{className:"max-w-7xl mx-auto space-y-8 pb-20 animate-in fade-in duration-500",children:[e.jsx(ve,{title:"Quick Wins (Mejoras RÃ¡pidas)",subtitle:"Registro y seguimiento de ideas de alto impacto y bajo esfuerzo",children:e.jsxs("button",{onClick:()=>h(!0),className:"flex items-center gap-2 bg-brand-600 hover:bg-brand-700 text-white px-4 py-2.5 rounded-lg transition-all shadow-sm shadow-brand-500/30 hover:shadow-brand-500/50 font-medium active:scale-95",children:[e.jsx(J,{size:20}),e.jsx("span",{children:"Nueva Idea"})]})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(oe,{title:"Total Ideas",value:O.total,icon:e.jsx(ye,{size:24}),variant:"blue",type:"outlined"}),e.jsx(oe,{title:"Completadas",value:O.done,icon:e.jsx(K,{size:24}),variant:"green",type:"solid"}),e.jsx(oe,{title:"Pendientes",value:O.ideas,icon:e.jsx(qe,{size:24}),variant:"orange",type:"outlined"}),e.jsx(oe,{title:"Alto Impacto",value:O.highImpact,icon:e.jsx(Ee,{size:24}),variant:"red",type:"outlined"})]}),e.jsxs("div",{className:"bg-white p-4 rounded-xl shadow-sm border border-slate-200 flex flex-wrap gap-4 items-center sticky top-4 z-30",children:[e.jsxs("div",{className:"relative flex-1 min-w-[240px]",children:[e.jsx(Ce,{size:18,className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"Buscar ideas por tÃ­tulo o descripciÃ³n...",className:"w-full pl-10 pr-4 py-2 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-brand-500 outline-none transition-all text-sm",value:s,onChange:c=>i(c.target.value)})]}),e.jsxs("div",{className:"flex gap-3 flex-wrap",children:[e.jsxs("div",{className:"relative",children:[e.jsx(rt,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"}),e.jsxs("select",{className:"pl-9 pr-8 py-2 bg-white border border-slate-200 rounded-lg focus:ring-2 focus:ring-brand-500 outline-none text-sm appearance-none cursor-pointer hover:bg-slate-50 transition-colors",value:N,onChange:c=>w(c.target.value),children:[e.jsx("option",{value:"all",children:"Todos los Estados"}),e.jsx("option",{value:"idea",children:"Ideas (Pendientes)"}),e.jsx("option",{value:"done",children:"Completadas"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ie,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"}),e.jsxs("select",{className:"pl-9 pr-8 py-2 bg-white border border-slate-200 rounded-lg focus:ring-2 focus:ring-brand-500 outline-none text-sm appearance-none cursor-pointer hover:bg-slate-50 transition-colors",value:l,onChange:c=>z(c.target.value),children:[e.jsx("option",{value:"all",children:"Cualquier Impacto"}),e.jsx("option",{value:"Alto",children:"Alto Impacto"}),e.jsx("option",{value:"Medio",children:"Medio Impacto"}),e.jsx("option",{value:"Bajo",children:"Bajo Impacto"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 items-start",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between bg-amber-50 p-4 rounded-xl border border-amber-100",children:[e.jsxs("h3",{className:"font-bold text-amber-800 flex items-center gap-2",children:[e.jsx("div",{className:"bg-amber-200 p-1.5 rounded-lg text-amber-700",children:e.jsx(ye,{size:20})}),"Ideas Pendientes"]}),e.jsx("span",{className:"bg-white px-2.5 py-1 rounded-full text-xs font-bold text-amber-600 border border-amber-200 shadow-sm",children:f.filter(c=>c.status==="idea").length})]}),e.jsxs("div",{className:"grid gap-4",children:[f.filter(c=>c.status==="idea").map(c=>e.jsxs("div",{className:"group bg-white rounded-xl p-5 shadow-sm border border-slate-200 hover:shadow-md hover:border-brand-200 transition-all cursor-pointer relative overflow-hidden",onClick:()=>a(c),children:[e.jsx("div",{className:"absolute top-0 left-0 w-1 h-full bg-amber-400"}),e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("span",{className:`text-[10px] font-bold uppercase tracking-wide px-2 py-1 rounded-md border ${I(c.impact)}`,children:[c.impact," Impacto"]}),e.jsxs("span",{className:"text-xs font-medium text-slate-400 bg-slate-50 px-2 py-1 rounded flex items-center gap-1",children:[e.jsx(le,{size:12})," ",c.date]})]}),e.jsx("h4",{className:"font-bold text-slate-800 text-lg mb-2 group-hover:text-brand-600 transition-colors pr-8",children:c.title}),e.jsx("p",{className:"text-sm text-slate-600 leading-relaxed mb-4 line-clamp-2",children:c.description}),e.jsxs("div",{className:"flex justify-between items-center pt-4 border-t border-slate-50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-brand-50 text-brand-600 flex items-center justify-center text-xs font-bold border border-brand-100",children:c.responsible?c.responsible.charAt(0):e.jsx(re,{size:12})}),e.jsx("span",{className:"text-xs font-medium text-slate-500 truncate max-w-[100px]",children:c.responsible||"Sin asignar"})]}),e.jsxs("button",{className:"text-xs font-bold bg-brand-50 text-brand-600 px-3 py-1.5 rounded-lg hover:bg-brand-100 transition-colors flex items-center gap-1 active:scale-95",onClick:R=>{R.stopPropagation(),V(c)},children:["Marcar Hecho ",e.jsx(xe,{size:12})]})]})]},c.id)),f.filter(c=>c.status==="idea").length===0&&e.jsxs("div",{className:"py-12 border-2 border-dashed border-slate-200 rounded-2xl flex flex-col items-center justify-center text-slate-400 bg-slate-50/50",children:[e.jsx(ye,{size:48,className:"opacity-20 mb-2"}),e.jsx("p",{className:"font-medium",children:"No hay ideas pendientes"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between bg-emerald-50 p-4 rounded-xl border border-emerald-100",children:[e.jsxs("h3",{className:"font-bold text-emerald-800 flex items-center gap-2",children:[e.jsx("div",{className:"bg-emerald-200 p-1.5 rounded-lg text-emerald-700",children:e.jsx(K,{size:20})}),"Completadas"]}),e.jsx("span",{className:"bg-white px-2.5 py-1 rounded-full text-xs font-bold text-emerald-600 border border-emerald-200 shadow-sm",children:f.filter(c=>c.status==="done").length})]}),e.jsxs("div",{className:"grid gap-4",children:[f.filter(c=>c.status==="done").map(c=>e.jsxs("div",{className:"group bg-white rounded-xl p-5 shadow-sm border border-slate-200 hover:shadow-md transition-all cursor-pointer relative overflow-hidden opacity-90 hover:opacity-100",onClick:()=>a(c),children:[e.jsx("div",{className:"absolute top-0 left-0 w-1 h-full bg-emerald-500"}),e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("span",{className:"text-[10px] font-bold uppercase tracking-wide px-2 py-1 rounded-md bg-emerald-100 text-emerald-700 border border-emerald-200 ring-1 ring-emerald-500/10 flex items-center gap-1",children:[e.jsx(K,{size:10,strokeWidth:4})," COMPLETADO"]}),e.jsxs("span",{className:"text-xs font-medium text-slate-400 bg-slate-50 px-2 py-1 rounded flex items-center gap-1",children:[e.jsx(le,{size:12})," ",c.date]})]}),e.jsx("h4",{className:"font-bold text-slate-700 text-lg mb-2 line-through decoration-slate-300 decoration-2",children:c.title}),c.completionComment&&e.jsxs("div",{className:"bg-emerald-50/50 p-3 rounded-lg border border-emerald-100 mb-3 flex gap-3 items-start",children:[e.jsx("div",{className:"mt-1 text-emerald-400",children:e.jsx(K,{size:14})}),e.jsxs("p",{className:"text-sm text-slate-600 italic leading-snug",children:['"',c.completionComment,'"']})]})]},c.id)),f.filter(c=>c.status==="done").length===0&&e.jsxs("div",{className:"py-12 border-2 border-dashed border-slate-200 rounded-2xl flex flex-col items-center justify-center text-slate-400 bg-slate-50/50",children:[e.jsx(K,{size:48,className:"opacity-20 mb-2"}),e.jsx("p",{className:"font-medium",children:"No hay tareas completadas"})]})]})]})]}),x&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex justify-center items-center z-50 p-4 animate-in fade-in duration-200",onClick:()=>h(!1),children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-lg shadow-2xl overflow-hidden animate-in zoom-in-95 duration-200",onClick:c=>c.stopPropagation(),children:[e.jsxs("div",{className:"border-b border-slate-100 px-6 py-4 flex justify-between items-center bg-white sticky top-0 z-10",children:[e.jsxs("h3",{className:"font-bold text-xl text-slate-800 flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-brand-100 text-brand-600 rounded-lg",children:e.jsx(ye,{size:20})}),"Nueva Idea"]}),e.jsx("button",{onClick:()=>h(!1),className:"text-slate-400 hover:text-slate-600 hover:bg-slate-100 p-2 rounded-full transition-colors",children:e.jsx(ae,{size:20})})]}),e.jsxs("div",{className:"p-6 space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2",children:"TÃ­tulo de la Idea"}),e.jsx("input",{className:"w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-brand-500 outline-none text-slate-700 font-medium transition-all",value:b.title,onChange:c=>k({...b,title:c.target.value}),placeholder:"Ej: Instalar dispensador de EPP",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2",children:"DescripciÃ³n Detallada"}),e.jsx("textarea",{className:"w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-brand-500 outline-none text-slate-700 font-medium transition-all resize-none",rows:"4",value:b.description,onChange:c=>k({...b,description:c.target.value}),placeholder:"Â¿QuÃ© problema resuelve y cÃ³mo?"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2",children:"Impacto Estimado"}),e.jsxs("div",{className:"relative",children:[e.jsx(ie,{size:18,className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"}),e.jsxs("select",{className:"w-full pl-10 pr-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-brand-500 outline-none text-slate-700 font-medium appearance-none cursor-pointer",value:b.impact,onChange:c=>k({...b,impact:c.target.value}),children:[e.jsx("option",{value:"Bajo",children:"Bajo"}),e.jsx("option",{value:"Medio",children:"Medio"}),e.jsx("option",{value:"Alto",children:"Alto"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2",children:"Fecha LÃ­mite"}),e.jsxs("div",{className:"relative",children:[e.jsx(le,{size:18,className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"}),e.jsx("input",{type:"date",className:"w-full pl-10 pr-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-brand-500 outline-none text-slate-700 font-medium cursor-pointer",value:b.deadline,onChange:c=>k({...b,deadline:c.target.value})})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2",children:"Responsable Sugerido"}),e.jsxs("div",{className:"relative",children:[e.jsx(re,{size:18,className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"}),e.jsxs("select",{className:"w-full pl-10 pr-10 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-brand-500 outline-none text-slate-700 font-medium appearance-none cursor-pointer",value:b.responsible,onChange:c=>k({...b,responsible:c.target.value}),children:[e.jsx("option",{value:"",children:"Seleccionar Responsable"}),W.map((c,R)=>e.jsx("option",{value:c,children:c},R))]}),e.jsx(Se,{size:18,className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 pointer-events-none"})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2",children:"Foto Referencial (Opcional)"}),e.jsx("div",{className:"block md:hidden",children:e.jsx(Ye,{currentImage:b.image,onCapture:c=>k({...b,image:c}),label:"Tomar Foto"})}),e.jsx("div",{className:"hidden md:block",children:e.jsx("div",{className:"border-2 border-dashed border-slate-200 rounded-xl p-1 hover:border-brand-300 hover:bg-slate-50 transition-all",children:e.jsx(je,{currentImage:b.image,onUpload:c=>k({...b,image:c}),placeholderText:"Subir Foto (Opcional)"})})})]})]}),e.jsxs("div",{className:"bg-slate-50 px-6 py-4 flex justify-end gap-3 border-t border-slate-100",children:[e.jsx("button",{onClick:()=>h(!1),className:"px-5 py-2.5 rounded-xl font-bold text-slate-500 hover:bg-slate-200 transition-colors",children:"Cancelar"}),e.jsx("button",{onClick:C,className:"px-5 py-2.5 rounded-xl font-bold text-white bg-brand-600 hover:bg-brand-700 shadow-lg shadow-brand-500/30 active:scale-95 transition-all",children:"Crear Idea"})]})]})}),p&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex justify-center items-center z-50 p-4 animate-in fade-in duration-200",onClick:()=>D(null),children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-md shadow-2xl overflow-hidden animate-in zoom-in-95 duration-200",onClick:c=>c.stopPropagation(),children:[e.jsxs("div",{className:"border-b border-slate-100 px-6 py-4 flex justify-between items-center bg-white",children:[e.jsxs("h3",{className:"font-bold text-xl text-emerald-800 flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-emerald-100 text-emerald-600 rounded-lg",children:e.jsx(K,{size:20})}),"Completar Quick Win"]}),e.jsx("button",{onClick:()=>D(null),className:"text-slate-400 hover:text-slate-600 hover:bg-slate-100 p-2 rounded-full transition-colors",children:e.jsx(ae,{size:20})})]}),e.jsxs("div",{className:"p-6 space-y-5",children:[e.jsxs("div",{className:"bg-emerald-50 border border-emerald-100 rounded-xl p-4 flex gap-3",children:[e.jsx("div",{className:"text-emerald-500 shrink-0",children:e.jsx(K,{size:20})}),e.jsx("p",{className:"text-sm text-emerald-800 leading-snug",children:"Para cerrar esta tarea y documentar la mejora, por favor sube una evidencia fotogrÃ¡fica y un comentario final."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2",children:"Comentario de Cierre"}),e.jsx("textarea",{className:"w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-emerald-500 outline-none text-slate-700 font-medium transition-all resize-none",rows:"3",placeholder:"Explica quÃ© se hizo para resolver el problema...",value:A.comment,onChange:c=>T({...A,comment:c.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2",children:"Evidencia FotogrÃ¡fica"}),e.jsx("div",{className:"block md:hidden mb-2",children:e.jsx(Ye,{currentImage:A.image,onCapture:c=>T({...A,image:c}),label:"Tomar Foto Evidencia"})}),e.jsx("div",{className:"hidden md:block",children:e.jsx("div",{className:"border-2 border-dashed border-slate-200 rounded-xl p-1 hover:border-emerald-300 hover:bg-emerald-50/30 transition-all",children:e.jsx(je,{currentImage:A.image,onUpload:c=>T({...A,image:c}),placeholderText:"Subir Foto de la Mejora"})})})]})]}),e.jsxs("div",{className:"bg-slate-50 px-6 py-4 flex justify-end gap-3 border-t border-slate-100",children:[e.jsx("button",{onClick:()=>D(null),className:"px-5 py-2.5 rounded-xl font-bold text-slate-500 hover:bg-slate-200 transition-colors",children:"Cancelar"}),e.jsx("button",{onClick:E,className:"px-5 py-2.5 rounded-xl font-bold text-white bg-emerald-600 hover:bg-emerald-700 shadow-lg shadow-emerald-500/30 active:scale-95 transition-all",children:"Confirmar Cierre"})]})]})}),n&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex justify-center items-center z-50 p-4 animate-in fade-in duration-200",onClick:()=>a(null),children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-3xl shadow-2xl overflow-hidden animate-in zoom-in-95 duration-200 flex flex-col max-h-[90vh]",onClick:c=>c.stopPropagation(),children:[e.jsxs("div",{className:"border-b border-slate-100 px-6 py-5 flex justify-between items-start bg-white z-10 shrink-0",children:[e.jsxs("div",{className:"flex-1 pr-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("span",{className:`text-[10px] font-bold uppercase tracking-wide px-2 py-0.5 rounded-md border ${n.status==="done"?"bg-emerald-100 text-emerald-700 border-emerald-200":"bg-amber-100 text-amber-700 border-amber-200"}`,children:n.status==="done"?"COMPLETADO":"EN PROGRESO"}),e.jsxs("span",{className:`text-[10px] font-bold uppercase tracking-wide px-2 py-0.5 rounded-md border ${I(n.impact)}`,children:[n.impact," Impacto"]})]}),e.jsx("h3",{className:"font-bold text-2xl text-slate-900 leading-tight",children:n.title})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>B(n.id),className:"p-2.5 text-rose-400 hover:text-rose-600 hover:bg-rose-50 rounded-lg transition-colors",title:"Eliminar registro permanentemente",children:e.jsx(Y,{size:20})}),e.jsx("div",{className:"w-px h-6 bg-slate-200 mx-1"}),e.jsx("button",{onClick:()=>a(null),className:"text-slate-400 hover:text-slate-600 hover:bg-slate-100 p-2 rounded-full transition-colors",children:e.jsx(ae,{size:24})})]})]}),e.jsx("div",{className:"overflow-y-auto p-6 md:p-8",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"bg-slate-50 p-5 rounded-xl border border-slate-200",children:[e.jsxs("h4",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest mb-3 flex items-center gap-2",children:[e.jsx(ye,{size:14})," Detalle del Problema"]}),e.jsx("p",{className:"text-slate-700 text-base leading-relaxed",children:n.description})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-slate-100 shadow-sm",children:[e.jsx("h4",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest mb-2",children:"Responsable"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-indigo-50 text-indigo-600 flex items-center justify-center text-xs font-bold border border-indigo-100",children:n.responsible?n.responsible.charAt(0):e.jsx(re,{size:14})}),e.jsxs("select",{className:"bg-transparent text-sm font-bold text-slate-700 outline-none cursor-pointer border-b border-transparent hover:border-brand-300 transition-all py-0.5",value:n.responsible||"",onChange:c=>F(n.id,"responsible",c.target.value),children:[e.jsx("option",{value:"",children:"Sin asignar"}),W.map((c,R)=>e.jsx("option",{value:c,children:c},R))]})]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-slate-100 shadow-sm",children:[e.jsx("h4",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest mb-2",children:"Fecha LÃ­mite"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-50 text-blue-600 flex items-center justify-center text-xs font-bold border border-blue-100",children:e.jsx(le,{size:14})}),e.jsx("span",{className:"text-sm font-bold text-slate-700",children:n.deadline||"Sin fecha"})]})]})]}),n.status==="idea"&&e.jsxs("button",{onClick:c=>{c.stopPropagation(),V(n),a(null)},className:"w-full py-3 bg-brand-600 hover:bg-brand-700 text-white font-bold rounded-xl shadow-lg shadow-brand-500/20 active:scale-95 transition-all flex items-center justify-center gap-2",children:[e.jsx(K,{size:20})," Marcar como Completado"]})]}),e.jsx("div",{className:"space-y-6",children:n.completionImage?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"text-xs font-bold text-emerald-600 uppercase tracking-widest flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"p-1 bg-emerald-100 rounded text-emerald-600",children:e.jsx(K,{size:12})}),"Evidencia de Cierre"]}),e.jsxs("div",{className:"relative group rounded-2xl overflow-hidden shadow-lg border border-slate-200",children:[e.jsx("img",{src:n.completionImage,className:"w-full h-64 object-cover",alt:"Evidencia"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 to-transparent flex items-end p-6",children:e.jsxs("p",{className:"text-white text-sm font-medium italic",children:['"',n.completionComment,'"']})})]}),e.jsxs("div",{className:"text-xs text-slate-400 text-center pt-2",children:["Tarea completada el ",new Date(n.completedAt||n.date).toLocaleDateString()]})]}):e.jsxs("div",{className:"h-full min-h-[300px] flex flex-col items-center justify-center bg-slate-50 rounded-2xl border-2 border-dashed border-slate-200 text-slate-400",children:[e.jsx("div",{className:"w-16 h-16 bg-slate-100 rounded-full flex items-center justify-center mb-4 text-slate-300",children:e.jsx(rs,{size:32})}),e.jsx("p",{className:"font-medium",children:"Sin evidencia adjunta"}),e.jsx("p",{className:"text-xs text-slate-300 mt-1 max-w-[200px] text-center",children:"Las tareas completadas mostrarÃ¡n aquÃ­ la foto de evidencia."})]})})]})})]})}),!x&&!p&&!n&&e.jsx(ms,{icon:ye,onClick:()=>h(!0),label:"Nueva Idea"})]})},Xt=()=>{const{user:t,globalFilterCompanyId:r,companyUsers:d}=Z(),m=Xe(),[s,i]=j.useState(null),[N,w]=j.useState(""),[l,z]=j.useState([]),[n,a]=j.useState(!0),x=async()=>{try{a(!0);const{data:v,error:$}=await U.from("vsm_projects").select("*").order("created_at",{ascending:!1});if($)throw $;if(v){const f=v.map(O=>({id:O.id,name:O.name,responsible:O.responsible,date:O.date,status:O.status,leadTime:O.lead_time,processTime:O.process_time,efficiency:O.efficiency,image:O.image_url,miroLink:O.miro_link,description:O.description,companyId:O.company_id}));z(f)}}catch(v){console.error("Error fetching VSMs:",v)}finally{a(!1)}};j.useEffect(()=>{t&&x()},[t,r]),j.useEffect(()=>{const $=new URLSearchParams(m.search).get("vsmId");if($&&l.length>0){const f=l.find(O=>O.id===parseInt($)||O.id===$);f&&i(f)}},[m.search,l]);const h=j.useMemo(()=>{if(!t)return[];const $=t.role==="admin"||t.email==="ariel.mellag@gmail.com"?r:t.companyId;return $==="all"?l:l.filter(f=>f.companyId===$||f.responsible===t.name||!f.companyId)},[l,t,r]),b=j.useMemo(()=>h.filter(v=>v.name.toLowerCase().includes(N.toLowerCase())||v.responsible.toLowerCase().includes(N.toLowerCase())),[h,N]),k=()=>{i({id:null,name:"",responsible:t?t.name:"",date:new Date().toISOString().split("T")[0],status:"current",leadTime:"",processTime:"",efficiency:"",image:null,miroLink:"",description:""})},S=async v=>{if(confirm("Â¿EstÃ¡s seguro de eliminar este VSM?")){const $=[...l];z(l.filter(f=>f.id!==v)),s&&s.id===v&&i(null);try{const{error:f}=await U.from("vsm_projects").delete().eq("id",v);if(f)throw f}catch(f){console.error("Error deleting VSM:",f),alert("Error al eliminar el VSM"),z($)}}},L=async()=>{if(!s.name){alert("El nombre es obligatorio");return}let v=s.companyId;if(d&&s.responsible){const f=d.find(O=>O.name===s.responsible);f&&f.company_id&&(v=f.company_id)}v||(v=t.companyId||(r!=="all"?r:null));const $={name:s.name,responsible:s.responsible,date:s.date,status:s.status,lead_time:s.leadTime,process_time:s.processTime,efficiency:s.efficiency,image_url:s.image,miro_link:s.miroLink,description:s.description,company_id:v};try{if(s.id){const{error:f}=await U.from("vsm_projects").update($).eq("id",s.id);if(f)throw f;z(l.map(O=>O.id===s.id?{...s,...$,companyId:v}:O))}else{const{data:f,error:O}=await U.from("vsm_projects").insert([$]).select();if(O)throw O;f&&x()}i(null)}catch(f){console.error("Error saving VSM:",f),alert("Error al guardar el mapa VSM")}};return e.jsxs("div",{className:"flex flex-col h-full bg-slate-50",children:[e.jsx(ve,{title:"VSM (Value Stream Mapping)",subtitle:"Mapeo y anÃ¡lisis de flujos de valor",children:e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-brand-600 hover:bg-brand-700 text-white rounded-lg font-medium transition-colors shadow-sm",onClick:k,children:[e.jsx(J,{size:18})," Nuevo Mapa"]})}),e.jsx("div",{className:"px-6 md:px-8 mb-6",children:e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-4",children:e.jsxs("div",{className:"relative max-w-md",children:[e.jsx(Ce,{size:18,className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"Buscar mapas VSM...",className:"w-full pl-10 pr-4 py-2 bg-slate-50 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 transition-all text-slate-600 placeholder:text-slate-400",value:N,onChange:v=>w(v.target.value)})]})})}),e.jsx("div",{className:"px-6 md:px-8 pb-8 flex-1 overflow-y-auto custom-scrollbar",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[b.map(v=>e.jsxs("div",{className:"group bg-white rounded-xl shadow-sm hover:shadow-lg border border-slate-200 hover:border-brand-200 transition-all duration-300 cursor-pointer flex flex-col h-full overflow-hidden",onClick:()=>i(v),children:[e.jsxs("div",{className:"h-40 bg-slate-100 relative overflow-hidden group-hover:opacity-95 transition-opacity",children:[v.image?e.jsx("img",{src:v.image,alt:"VSM Preview",className:"w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"}):e.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center text-slate-300 bg-slate-50",children:[e.jsx(se,{size:48,className:"mb-2"}),e.jsx("span",{className:"text-xs font-medium",children:"Sin imagen"})]}),e.jsx("div",{className:"absolute top-3 right-3 flex items-center gap-2",children:e.jsx("span",{className:`px-2.5 py-1 text-xs font-bold rounded-full shadow-sm backdrop-blur-md ${v.status==="current"?"bg-blue-500/90 text-white":v.status==="completed"?"bg-emerald-500/90 text-white":"bg-purple-500/90 text-white"}`,children:v.status==="current"?"ESTADO ACTUAL":v.status==="completed"?"FINALIZADO":"ESTADO FUTURO"})}),e.jsx("button",{onClick:async $=>{$.stopPropagation();const f=v.status==="completed"?"current":"completed",O=[...l];z(l.map(C=>C.id===v.id?{...C,status:f}:C));try{const{error:C}=await U.from("vsm_projects").update({status:f}).eq("id",v.id);if(C)throw C}catch(C){console.error("Error updating status:",C),z(O)}},className:`absolute bottom-3 right-3 p-2 rounded-full shadow-sm transition-all transform hover:scale-110 active:scale-95 ${v.status==="completed"?"bg-emerald-100 text-emerald-600 hover:bg-emerald-200":"bg-white/90 text-slate-400 hover:text-emerald-500 hover:bg-white"}`,title:v.status==="completed"?"Marcar como En Proceso":"Marcar como Finalizado",children:e.jsx(K,{size:18,className:v.status==="completed"?"fill-current":""})})]}),e.jsxs("div",{className:"p-5 flex-1 flex flex-col",children:[e.jsx("h3",{className:"font-bold text-slate-800 text-lg mb-2 group-hover:text-brand-600 transition-colors",children:v.name}),e.jsx("p",{className:"text-sm text-slate-500 line-clamp-2 mb-5 flex-1",children:v.description||"Sin descripciÃ³n disponible."}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-4 bg-slate-50 p-3 rounded-lg border border-slate-100",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"block text-[10px] text-slate-400 uppercase font-bold tracking-wider mb-1",children:"Lead Time"}),e.jsx("span",{className:"text-sm font-bold text-slate-700",children:v.leadTime||"-"})]}),e.jsxs("div",{className:"text-center border-l border-slate-200",children:[e.jsx("span",{className:"block text-[10px] text-slate-400 uppercase font-bold tracking-wider mb-1",children:"Proceso"}),e.jsx("span",{className:"text-sm font-bold text-slate-700",children:v.processTime||"-"})]}),e.jsxs("div",{className:"text-center border-l border-slate-200",children:[e.jsx("span",{className:"block text-[10px] text-slate-400 uppercase font-bold tracking-wider mb-1",children:"Eficiencia"}),e.jsx("span",{className:"text-sm font-bold text-emerald-600",children:v.efficiency||"-"})]})]}),e.jsxs("div",{className:"flex justify-between items-center text-xs text-slate-400 pt-4 border-t border-slate-100 mt-auto",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(re,{size:14}),e.jsx("span",{className:"font-medium text-slate-600",children:v.responsible})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(le,{size:14}),e.jsx("span",{children:v.date})]})]})]})]},v.id)),b.length===0&&e.jsxs("div",{className:"col-span-full py-16 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-4 text-slate-400",children:e.jsx(Ce,{size:24})}),e.jsx("h3",{className:"text-slate-900 font-medium text-lg",children:"No se encontraron mapas"}),e.jsx("p",{className:"text-slate-500",children:"Prueba ajustando los filtros o crea un nuevo VSM."})]})]})}),s&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm transition-opacity",onClick:()=>i(null),children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-4xl shadow-2xl overflow-hidden flex flex-col max-h-[90vh] animate-in fade-in zoom-in-95 duration-200",onClick:v=>v.stopPropagation(),children:[e.jsxs("div",{className:"px-6 py-4 flex justify-between items-center border-b border-slate-200 bg-slate-50/50",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-xl text-slate-800",children:s.id?"Editar VSM":"Nuevo Mapa VSM"}),e.jsx("p",{className:"text-sm text-slate-500",children:s.id?"Modifica los detalles del flujo de valor":"Crea un nuevo anÃ¡lisis de flujo de valor"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[s.id&&e.jsx("button",{onClick:()=>S(s.id),className:"p-2 text-rose-500 hover:bg-rose-50 rounded-lg transition-colors",title:"Eliminar Mapa",children:e.jsx(Y,{size:20})}),e.jsx("button",{onClick:()=>i(null),className:"p-2 text-slate-400 hover:text-slate-600 hover:bg-slate-100 rounded-lg transition-colors",children:e.jsx(ae,{size:24})})]})]}),e.jsx("div",{className:"p-6 md:p-8 overflow-y-auto custom-scrollbar bg-white",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-700 mb-1.5",children:"Nombre del Mapa"}),e.jsx("input",{className:"w-full px-4 py-2.5 bg-slate-50 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 transition-all text-slate-700 placeholder:text-slate-400",value:s.name,onChange:v=>i({...s,name:v.target.value}),placeholder:"Ej: Flujo de ProducciÃ³n LÃ­nea 3"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-700 mb-1.5",children:"DescripciÃ³n"}),e.jsx("textarea",{className:"w-full px-4 py-2 bg-slate-50 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 transition-all text-slate-700 placeholder:text-slate-400 h-24 resize-none",value:s.description,onChange:v=>i({...s,description:v.target.value}),placeholder:"Describe el alcance y objetivo de este VSM..."})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-700 mb-1.5",children:"Responsable"}),e.jsxs("div",{className:"relative",children:[e.jsx(re,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 pointer-events-none"}),e.jsxs("select",{className:"w-full pl-10 pr-4 py-2.5 bg-slate-50 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 transition-all text-slate-700 appearance-none cursor-pointer",value:s.responsible,onChange:v=>i({...s,responsible:v.target.value}),children:[e.jsx("option",{value:"",disabled:!0,children:"Seleccionar..."}),d&&d.length>0?d.map(v=>e.jsx("option",{value:v.name,children:v.name},v.id)):e.jsxs(e.Fragment,{children:[s.responsible&&e.jsx("option",{value:s.responsible,children:s.responsible}),e.jsx("option",{value:"",disabled:!0,children:"No hay usuarios"})]})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-700 mb-1.5",children:"Fecha"}),e.jsxs("div",{className:"relative",children:[e.jsx(le,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 pointer-events-none"}),e.jsx("input",{type:"date",className:"w-full pl-10 pr-4 py-2.5 bg-slate-50 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 transition-all text-slate-700",value:s.date,onChange:v=>i({...s,date:v.target.value})})]})]})]}),e.jsxs("div",{className:"bg-slate-50 p-4 rounded-xl border border-slate-200",children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-700 mb-3",children:"Tipo de Mapa"}),e.jsxs("div",{className:"flex gap-6",children:[e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer group",children:[e.jsx("div",{className:`w-5 h-5 rounded-full border flex items-center justify-center transition-colors ${s.status==="current"?"border-brand-600 bg-brand-600":"border-slate-300 bg-white"}`,children:s.status==="current"&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-white"})}),e.jsx("input",{type:"radio",name:"status",checked:s.status==="current",onChange:()=>i({...s,status:"current"}),className:"hidden"}),e.jsx("span",{className:"text-sm font-medium text-slate-700 group-hover:text-brand-700",children:"Estado Actual"})]}),e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer group",children:[e.jsx("div",{className:`w-5 h-5 rounded-full border flex items-center justify-center transition-colors ${s.status==="future"?"border-purple-600 bg-purple-600":"border-slate-300 bg-white"}`,children:s.status==="future"&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-white"})}),e.jsx("input",{type:"radio",name:"status",checked:s.status==="future",onChange:()=>i({...s,status:"future"}),className:"hidden"}),e.jsx("span",{className:"text-sm font-medium text-slate-700 group-hover:text-purple-700",children:"Estado Futuro"})]}),e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer group",children:[e.jsx("div",{className:`w-5 h-5 rounded-full border flex items-center justify-center transition-colors ${s.status==="completed"?"border-emerald-600 bg-emerald-600":"border-slate-300 bg-white"}`,children:s.status==="completed"&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-white"})}),e.jsx("input",{type:"radio",name:"status",checked:s.status==="completed",onChange:()=>i({...s,status:"completed"}),className:"hidden"}),e.jsx("span",{className:"text-sm font-medium text-slate-700 group-hover:text-emerald-700",children:"Finalizado"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-700 mb-1.5",children:"Enlace a Miro / Pizarra Digital"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(fe,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"}),e.jsx("input",{className:"w-full pl-10 pr-4 py-2.5 bg-slate-50 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 transition-all text-slate-700 placeholder:text-slate-400",value:s.miroLink,onChange:v=>i({...s,miroLink:v.target.value}),placeholder:"https://miro.com/..."})]}),s.miroLink&&e.jsx("a",{href:s.miroLink,target:"_blank",rel:"noreferrer",className:"px-4 py-2 bg-blue-50 text-blue-600 hover:bg-blue-100 border border-blue-200 rounded-lg flex items-center justify-center transition-colors",title:"Abrir enlace",children:e.jsx(xe,{size:18})})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-slate-50 p-6 rounded-2xl border border-slate-200",children:[e.jsxs("label",{className:"block text-sm font-bold text-slate-800 mb-4 flex items-center gap-2",children:[e.jsx(se,{size:18,className:"text-brand-600"}),"MÃ©tricas Clave (KPIs)"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider",children:"Lead Time Total"}),e.jsxs("div",{className:"flex items-center gap-3 mt-1.5",children:[e.jsx("div",{className:"bg-white p-2 rounded-lg border border-slate-200 text-slate-400",children:e.jsx(qe,{size:18})}),e.jsx("input",{className:"flex-1 px-3 py-2 bg-white border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 transition-all text-slate-700 font-medium",value:s.leadTime,onChange:v=>i({...s,leadTime:v.target.value}),placeholder:"Ej: 4.5 dÃ­as"})]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider",children:"Tiempo de Proceso (VA)"}),e.jsxs("div",{className:"flex items-center gap-3 mt-1.5",children:[e.jsx("div",{className:"bg-white p-2 rounded-lg border border-slate-200 text-slate-400",children:e.jsx(se,{size:18})}),e.jsx("input",{className:"flex-1 px-3 py-2 bg-white border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 transition-all text-slate-700 font-medium",value:s.processTime,onChange:v=>i({...s,processTime:v.target.value}),placeholder:"Ej: 45 mins"})]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider",children:"Eficiencia de Ciclo (%)"}),e.jsxs("div",{className:"flex items-center gap-3 mt-1.5",children:[e.jsx("div",{className:"bg-white p-2 rounded-lg border border-slate-200 text-slate-400",children:e.jsx(ie,{size:18})}),e.jsx("input",{className:"flex-1 px-3 py-2 bg-white border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500/20 focus:border-emerald-500 transition-all text-emerald-600 font-bold",value:s.efficiency,onChange:v=>i({...s,efficiency:v.target.value}),placeholder:"Ej: 15%"})]})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-700 mb-2",children:"Imagen del Mapa"}),e.jsx("div",{className:"h-48 rounded-xl overflow-hidden border border-slate-200 shadow-sm",children:e.jsx(je,{currentImage:s.image,onUpload:v=>i({...s,image:v}),placeholderText:"Subir captura o diagrama del VSM"})})]})]})]})}),e.jsxs("div",{className:"px-6 py-4 bg-slate-50 border-t border-slate-200 flex justify-end gap-3 shrink-0",children:[e.jsx("button",{onClick:()=>i(null),className:"px-5 py-2.5 text-slate-600 font-medium hover:bg-slate-200 rounded-lg transition-colors",children:"Cancelar"}),e.jsx("button",{onClick:L,className:"px-6 py-2.5 bg-brand-600 hover:bg-brand-700 text-white font-medium rounded-lg shadow-sm hover:shadow hover:-translate-y-0.5 transition-all",children:"Guardar Mapa"})]})]})})]})},Zt=()=>{const{login:t,user:r,loading:d}=Z(),[m,s]=j.useState(""),[i,N]=j.useState(""),[w,l]=j.useState(""),[z,n]=j.useState(!1),a=We();j.useEffect(()=>{!d&&r&&a("/")},[r,d,a]);const x=async h=>{h.preventDefault(),l(""),n(!0);const b=await t(m,i);b.success||(l(b.message),n(!1))};return e.jsxs("div",{className:"min-h-screen bg-slate-900 flex items-center justify-center relative overflow-hidden font-sans selection:bg-cyan-500/30",children:[e.jsxs("div",{className:"absolute top-0 left-0 w-full h-full overflow-hidden z-0",children:[e.jsx("div",{className:"absolute top-[-10%] left-[-10%] w-96 h-96 bg-purple-500/30 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-blob"}),e.jsx("div",{className:"absolute top-[-10%] right-[-10%] w-96 h-96 bg-cyan-500/30 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-blob animation-delay-2000"}),e.jsx("div",{className:"absolute -bottom-32 left-20 w-96 h-96 bg-blue-500/30 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-blob animation-delay-4000"}),e.jsx("div",{className:"absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-20 brightness-100 contrast-150"})]}),e.jsxs("div",{className:"w-full max-w-md p-8 relative z-10 animate-fade-in-up",children:[e.jsxs("div",{className:"glass-panel p-8 sm:p-10 rounded-2xl border border-slate-700/50 shadow-2xl backdrop-blur-xl relative overflow-hidden group",children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-blue-500 via-cyan-400 to-blue-500 opacity-50 group-hover:opacity-100 transition-opacity duration-500"}),e.jsxs("div",{className:"text-center mb-10 relative",children:[e.jsxs("div",{className:"inline-block relative",children:[e.jsx("div",{className:"absolute inset-0 bg-blue-500 blur-2xl opacity-20 rounded-full"}),e.jsx("h1",{className:"relative text-5xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-white via-blue-100 to-slate-200 tracking-tight mb-2",children:"Nexus"})]}),e.jsx("p",{className:"text-slate-400 text-sm font-medium tracking-wide uppercase opacity-0 animate-fade-in-up",style:{animationDelay:"0.1s",animationFillMode:"forwards"},children:"Be Lean â€¢ Be Efficient"})]}),w&&e.jsxs("div",{className:"bg-red-500/10 border border-red-500/20 text-red-400 px-4 py-3 rounded-lg mb-6 text-sm flex items-center animate-shake",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2 flex-shrink-0",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),w]}),e.jsxs("form",{onSubmit:x,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-1 group",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-400 uppercase tracking-wider ml-1 group-focus-within:text-cyan-400 transition-colors",children:"Correo ElectrÃ³nico"}),e.jsxs("div",{className:"relative transform transition-all duration-300 focus-within:scale-[1.02]",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(Ze,{className:"h-5 w-5 text-slate-500 group-focus-within:text-cyan-400 transition-colors"})}),e.jsx("input",{type:"email",className:"w-full bg-slate-900/50 border border-slate-700 text-slate-200 rounded-xl py-3 pl-10 pr-4 placeholder-slate-600 focus:outline-none focus:ring-2 focus:ring-cyan-500/30 focus:border-cyan-500/50 transition-all duration-300 shadow-inner",placeholder:"nombre@empresa.com",value:m,onChange:h=>s(h.target.value),required:!0})]})]}),e.jsxs("div",{className:"space-y-1 group",children:[e.jsxs("div",{className:"flex justify-between items-center ml-1",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-400 uppercase tracking-wider group-focus-within:text-cyan-400 transition-colors",children:"ContraseÃ±a"}),e.jsx(pe,{to:"/forgot-password",className:"text-xs text-blue-400 hover:text-blue-300 transition-colors hover:underline decoration-blue-400/30 underline-offset-2",children:"Â¿Olvidaste tu contraseÃ±a?"})]}),e.jsxs("div",{className:"relative transform transition-all duration-300 focus-within:scale-[1.02]",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(Ue,{className:"h-5 w-5 text-slate-500 group-focus-within:text-cyan-400 transition-colors"})}),e.jsx("input",{type:"password",className:"w-full bg-slate-900/50 border border-slate-700 text-slate-200 rounded-xl py-3 pl-10 pr-4 placeholder-slate-600 focus:outline-none focus:ring-2 focus:ring-cyan-500/30 focus:border-cyan-500/50 transition-all duration-300 shadow-inner",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",value:i,onChange:h=>N(h.target.value),required:!0})]})]}),e.jsxs("button",{type:"submit",disabled:z||d,className:"w-full relative overflow-hidden group bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-500 hover:to-cyan-500 text-white font-semibold py-3.5 rounded-xl shadow-lg shadow-blue-900/20 transform transition-all duration-300 hover:shadow-cyan-500/20 hover:-translate-y-0.5 disabled:opacity-70 disabled:cursor-not-allowed disabled:hover:translate-y-0",children:[e.jsx("span",{className:"relative z-10 flex items-center justify-center gap-2",children:z||d?e.jsxs(e.Fragment,{children:[e.jsx(Be,{className:"h-5 w-5 animate-spin"}),e.jsx("span",{children:"Ingresando..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Ingresar al Sistema"}),e.jsx(xe,{className:"h-5 w-5 group-hover:translate-x-1 transition-transform"})]})}),e.jsx("div",{className:"absolute top-0 -inset-full h-full w-1/2 z-5 block transform -skew-x-12 bg-gradient-to-r from-transparent to-white opacity-20 group-hover:animate-shine"})]})]}),e.jsxs("div",{className:"mt-8 text-center",children:[e.jsxs("p",{className:"text-slate-500 text-sm",children:["Â¿No tienes una cuenta?"," ",e.jsx(pe,{to:"/register",className:"text-cyan-400 hover:text-cyan-300 font-medium transition-colors hover:underline decoration-cyan-400/30 underline-offset-4",children:"Solicitar acceso"})]}),e.jsx("div",{className:"mt-8 pt-6 border-t border-slate-700/50",children:e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsxs(pe,{to:"/offline-access",className:"w-full flex items-center justify-center gap-2 px-4 py-3 text-sm font-medium text-slate-400 bg-slate-800/50 hover:bg-slate-800 hover:text-white rounded-lg transition-all border border-slate-700/50 hover:border-slate-600",children:[e.jsx(Ke,{size:16}),"Tarjeta 5S (Offline)"]}),e.jsxs(pe,{to:"/offline-audit",className:"w-full flex items-center justify-center gap-2 px-4 py-3 text-sm font-medium text-slate-400 bg-slate-800/50 hover:bg-slate-800 hover:text-white rounded-lg transition-all border border-slate-700/50 hover:border-slate-600",children:[e.jsx(lt,{size:16}),"AuditorÃ­a 5S (Offline)"]})]})})]})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("p",{className:"text-slate-600 text-xs",children:["Â© ",new Date().getFullYear()," Nexus System. v1.0.0"]})})]})]})},ea=()=>{const{register:t,companies:r}=Z(),[d,m]=j.useState({name:"",email:"",password:"",confirmPassword:""}),[s,i]=j.useState(""),[N,w]=j.useState(""),[l,z]=j.useState(!1),n=We(),a=h=>{m({...d,[h.target.name]:h.target.value})},x=async h=>{if(h.preventDefault(),i(""),w(""),z(!0),d.password!==d.confirmPassword){i("Las contraseÃ±as no coinciden"),z(!1);return}if(d.password.length<6){i("La contraseÃ±a debe tener al menos 6 caracteres"),z(!1);return}const b=d.email.toLowerCase().trim(),k=b.split("@")[1];if(!r||r.length===0){i("Cargando empresas... Por favor intenta de nuevo en un momento."),z(!1);return}let S=r.find($=>($.domain||"").toLowerCase().trim()===k),L=S?S.id:null;if(!S&&b!=="ariel.mellag@gmail.com"){i(`El dominio "${k}" no pertenece a una empresa registrada. Contacta al administrador.`),z(!1);return}const v=await t({name:d.name,email:d.email,password:d.password,companyId:L});v.success?(w(v.message),setTimeout(()=>{n("/login")},3e3)):(i(v.message),z(!1))};return e.jsxs("div",{className:"min-h-screen bg-slate-900 flex items-center justify-center relative overflow-hidden font-sans selection:bg-cyan-500/30",children:[e.jsxs("div",{className:"absolute top-0 left-0 w-full h-full overflow-hidden z-0",children:[e.jsx("div",{className:"absolute top-[-10%] left-[-10%] w-96 h-96 bg-purple-500/30 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-blob"}),e.jsx("div",{className:"absolute top-[-10%] right-[-10%] w-96 h-96 bg-cyan-500/30 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-blob animation-delay-2000"}),e.jsx("div",{className:"absolute -bottom-32 left-20 w-96 h-96 bg-blue-500/30 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-blob animation-delay-4000"}),e.jsx("div",{className:"absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-20 brightness-100 contrast-150"})]}),e.jsxs("div",{className:"w-full max-w-lg p-8 relative z-10 animate-fade-in-up",children:[e.jsxs("div",{className:"glass-panel p-8 sm:p-10 rounded-2xl border border-slate-700/50 shadow-2xl backdrop-blur-xl relative overflow-hidden group",children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-blue-500 via-cyan-400 to-blue-500 opacity-50 group-hover:opacity-100 transition-opacity duration-500"}),e.jsxs("div",{className:"text-center mb-10 relative",children:[e.jsx("div",{className:"inline-block relative",children:e.jsx("h1",{className:"relative text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-white via-blue-100 to-slate-200 tracking-tight mb-2",children:"Registro de Usuario"})}),e.jsx("p",{className:"text-slate-400 text-sm font-medium tracking-wide",children:"Ãšnete a Nexus BE LEAN"})]}),s&&e.jsxs("div",{className:"bg-red-500/10 border border-red-500/20 text-red-400 px-4 py-3 rounded-lg mb-6 text-sm flex items-center animate-shake",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2 flex-shrink-0",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),s]}),N&&e.jsxs("div",{className:"bg-emerald-500/10 border border-emerald-500/20 text-emerald-400 px-4 py-3 rounded-lg mb-6 text-sm flex items-center animate-fade-in-up",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2 flex-shrink-0",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),N]}),e.jsxs("form",{onSubmit:x,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-1 group",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-400 uppercase tracking-wider ml-1 group-focus-within:text-cyan-400 transition-colors",children:"Nombre Completo"}),e.jsxs("div",{className:"relative transform transition-all duration-300 focus-within:scale-[1.02]",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(re,{className:"h-5 w-5 text-slate-500 group-focus-within:text-cyan-400 transition-colors"})}),e.jsx("input",{type:"text",name:"name",className:"w-full bg-slate-900/50 border border-slate-700 text-slate-200 rounded-xl py-3 pl-10 pr-4 placeholder-slate-600 focus:outline-none focus:ring-2 focus:ring-cyan-500/30 focus:border-cyan-500/50 transition-all duration-300 shadow-inner",placeholder:"Juan PÃ©rez",value:d.name,onChange:a,required:!0})]})]}),e.jsxs("div",{className:"space-y-1 group",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-400 uppercase tracking-wider ml-1 group-focus-within:text-cyan-400 transition-colors",children:"Correo de Empresa"}),e.jsxs("div",{className:"relative transform transition-all duration-300 focus-within:scale-[1.02]",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(Ze,{className:"h-5 w-5 text-slate-500 group-focus-within:text-cyan-400 transition-colors"})}),e.jsx("input",{type:"email",name:"email",className:"w-full bg-slate-900/50 border border-slate-700 text-slate-200 rounded-xl py-3 pl-10 pr-4 placeholder-slate-600 focus:outline-none focus:ring-2 focus:ring-cyan-500/30 focus:border-cyan-500/50 transition-all duration-300 shadow-inner",placeholder:"nombre@empresa.com",value:d.email,onChange:a,required:!0})]}),e.jsx("p",{className:"text-[10px] text-slate-500 px-1 font-medium",children:"Solo correos corporativos autorizados."})]}),e.jsxs("div",{className:"space-y-1 group",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-400 uppercase tracking-wider ml-1 group-focus-within:text-cyan-400 transition-colors",children:"ContraseÃ±a"}),e.jsxs("div",{className:"relative transform transition-all duration-300 focus-within:scale-[1.02]",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(Ue,{className:"h-5 w-5 text-slate-500 group-focus-within:text-cyan-400 transition-colors"})}),e.jsx("input",{type:"password",name:"password",className:"w-full bg-slate-900/50 border border-slate-700 text-slate-200 rounded-xl py-3 pl-10 pr-4 placeholder-slate-600 focus:outline-none focus:ring-2 focus:ring-cyan-500/30 focus:border-cyan-500/50 transition-all duration-300 shadow-inner",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",value:d.password,onChange:a,required:!0})]})]}),e.jsxs("div",{className:"space-y-1 group",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-400 uppercase tracking-wider ml-1 group-focus-within:text-cyan-400 transition-colors",children:"Confirmar ContraseÃ±a"}),e.jsxs("div",{className:"relative transform transition-all duration-300 focus-within:scale-[1.02]",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(Ue,{className:"h-5 w-5 text-slate-500 group-focus-within:text-cyan-400 transition-colors"})}),e.jsx("input",{type:"password",name:"confirmPassword",className:"w-full bg-slate-900/50 border border-slate-700 text-slate-200 rounded-xl py-3 pl-10 pr-4 placeholder-slate-600 focus:outline-none focus:ring-2 focus:ring-cyan-500/30 focus:border-cyan-500/50 transition-all duration-300 shadow-inner",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",value:d.confirmPassword,onChange:a,required:!0})]})]}),e.jsxs("button",{type:"submit",disabled:l,className:"w-full relative overflow-hidden group bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-500 hover:to-cyan-500 text-white font-semibold py-3.5 rounded-xl shadow-lg shadow-blue-900/20 transform transition-all duration-300 hover:shadow-cyan-500/20 hover:-translate-y-0.5 disabled:opacity-70 disabled:cursor-not-allowed disabled:hover:translate-y-0",children:[e.jsx("span",{className:"relative z-10 flex items-center justify-center gap-2",children:l?e.jsxs(e.Fragment,{children:[e.jsx(Be,{className:"h-5 w-5 animate-spin"}),e.jsx("span",{children:"Registrando..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Registrarse"}),e.jsx(xe,{className:"h-5 w-5 group-hover:translate-x-1 transition-transform"})]})}),e.jsx("div",{className:"absolute top-0 -inset-full h-full w-1/2 z-5 block transform -skew-x-12 bg-gradient-to-r from-transparent to-white opacity-20 group-hover:animate-shine"})]})]}),e.jsx("div",{className:"mt-8 text-center",children:e.jsxs("p",{className:"text-slate-500 text-sm",children:["Â¿Ya tienes una cuenta?"," ",e.jsx(pe,{to:"/login",className:"text-cyan-400 hover:text-cyan-300 font-medium transition-colors hover:underline decoration-cyan-400/30 underline-offset-4",children:"Inicia sesiÃ³n"})]})})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("p",{className:"text-slate-600 text-xs",children:["Â© ",new Date().getFullYear()," Nexus System. v1.0.0"]})})]})]})},sa=()=>{const{resetPassword:t}=Z(),[r,d]=j.useState(""),[m,s]=j.useState(""),[i,N]=j.useState(""),[w,l]=j.useState(!1),z=async n=>{n.preventDefault(),s(""),N(""),l(!0);const a=await t(r);l(!1),a.success?s(a.message):N(a.message)};return e.jsxs("div",{className:"min-h-screen bg-slate-900 flex items-center justify-center relative overflow-hidden font-sans selection:bg-cyan-500/30",children:[e.jsxs("div",{className:"absolute top-0 left-0 w-full h-full overflow-hidden z-0",children:[e.jsx("div",{className:"absolute top-[-10%] left-[-10%] w-96 h-96 bg-purple-500/30 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-blob"}),e.jsx("div",{className:"absolute top-[-10%] right-[-10%] w-96 h-96 bg-cyan-500/30 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-blob animation-delay-2000"}),e.jsx("div",{className:"absolute -bottom-32 left-20 w-96 h-96 bg-blue-500/30 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-blob animation-delay-4000"}),e.jsx("div",{className:"absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-20 brightness-100 contrast-150"})]}),e.jsxs("div",{className:"w-full max-w-md p-8 relative z-10 animate-fade-in-up",children:[e.jsxs("div",{className:"glass-panel p-8 sm:p-10 rounded-2xl border border-slate-700/50 shadow-2xl backdrop-blur-xl relative overflow-hidden group",children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-blue-500 via-cyan-400 to-blue-500 opacity-50 group-hover:opacity-100 transition-opacity duration-500"}),e.jsxs("div",{className:"text-center mb-10 relative",children:[e.jsx("div",{className:"inline-block relative",children:e.jsx("h1",{className:"relative text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-white via-blue-100 to-slate-200 tracking-tight mb-2",children:"Recuperar ContraseÃ±a"})}),e.jsx("p",{className:"text-slate-400 text-sm font-medium tracking-wide",children:"Ingresa tu correo para restablecerla"})]}),m&&e.jsxs("div",{className:"bg-emerald-500/10 border border-emerald-500/20 text-emerald-400 px-4 py-3 rounded-lg mb-6 text-sm flex items-center animate-fade-in-up",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2 flex-shrink-0",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),m]}),i&&e.jsxs("div",{className:"bg-red-500/10 border border-red-500/20 text-red-400 px-4 py-3 rounded-lg mb-6 text-sm flex items-center animate-shake",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2 flex-shrink-0",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),i]}),e.jsxs("form",{onSubmit:z,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-1 group",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-400 uppercase tracking-wider ml-1 group-focus-within:text-cyan-400 transition-colors",children:"Correo ElectrÃ³nico"}),e.jsxs("div",{className:"relative transform transition-all duration-300 focus-within:scale-[1.02]",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(Ze,{className:"h-5 w-5 text-slate-500 group-focus-within:text-cyan-400 transition-colors"})}),e.jsx("input",{type:"email",className:"w-full bg-slate-900/50 border border-slate-700 text-slate-200 rounded-xl py-3 pl-10 pr-4 placeholder-slate-600 focus:outline-none focus:ring-2 focus:ring-cyan-500/30 focus:border-cyan-500/50 transition-all duration-300 shadow-inner",placeholder:"nombre@empresa.com",value:r,onChange:n=>d(n.target.value),required:!0})]})]}),e.jsxs("button",{type:"submit",disabled:w,className:"w-full relative overflow-hidden group bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-500 hover:to-cyan-500 text-white font-semibold py-3.5 rounded-xl shadow-lg shadow-blue-900/20 transform transition-all duration-300 hover:shadow-cyan-500/20 hover:-translate-y-0.5 disabled:opacity-70 disabled:cursor-not-allowed disabled:hover:translate-y-0",children:[e.jsx("span",{className:"relative z-10 flex items-center justify-center gap-2",children:w?e.jsxs(e.Fragment,{children:[e.jsx(Be,{className:"h-5 w-5 animate-spin"}),e.jsx("span",{children:"Enviando..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Enviar Enlace"}),e.jsx(xe,{className:"h-5 w-5 group-hover:translate-x-1 transition-transform"})]})}),e.jsx("div",{className:"absolute top-0 -inset-full h-full w-1/2 z-5 block transform -skew-x-12 bg-gradient-to-r from-transparent to-white opacity-20 group-hover:animate-shine"})]})]}),e.jsx("div",{className:"mt-8 text-center",children:e.jsxs(pe,{to:"/login",className:"inline-flex items-center gap-2 text-slate-400 hover:text-white font-medium transition-colors hover:translate-x-[-4px] duration-300",children:[e.jsx(cs,{size:16})," Volver al inicio de sesiÃ³n"]})})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("p",{className:"text-slate-600 text-xs",children:["Â© ",new Date().getFullYear()," Nexus System. v1.0.0"]})})]})]})},ta="modulepreload",aa=function(t){return"/"+t},js={},vs=function(r,d,m){let s=Promise.resolve();if(d&&d.length>0){document.getElementsByTagName("link");const N=document.querySelector("meta[property=csp-nonce]"),w=(N==null?void 0:N.nonce)||(N==null?void 0:N.getAttribute("nonce"));s=Promise.allSettled(d.map(l=>{if(l=aa(l),l in js)return;js[l]=!0;const z=l.endsWith(".css"),n=z?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${n}`))return;const a=document.createElement("link");if(a.rel=z?"stylesheet":ta,z||(a.as="script"),a.crossOrigin="",a.href=l,w&&a.setAttribute("nonce",w),document.head.appendChild(a),z)return new Promise((x,h)=>{a.addEventListener("load",x),a.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${l}`)))})}))}function i(N){const w=new Event("vite:preloadError",{cancelable:!0});if(w.payload=N,window.dispatchEvent(w),!w.defaultPrevented)throw N}return s.then(N=>{for(const w of N||[])w.status==="rejected"&&i(w.reason);return r().catch(i)})},ra=()=>{const{user:t,companies:r,addCompany:d,removeCompany:m,removeUser:s,adminAuthorizeUser:i,updateUserStatus:N,getAllUsers:w,updateUserRole:l,updateUserCompany:z,refreshData:n,repairAdminProfile:a}=Z(),[x,h]=j.useState(""),[b,k]=j.useState(""),[S,L]=j.useState([]),[v,$]=j.useState(!0),[f,O]=j.useState("all");j.useEffect(()=>{C()},[C]);const C=j.useCallback(async()=>{$(!0);const I=await w();L(I),$(!1)},[w]);if(!t||t.role!=="admin")return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-slate-50",children:e.jsxs("div",{className:"text-center p-8 bg-white rounded-2xl shadow-xl max-w-md border border-slate-100",children:[e.jsx("div",{className:"w-16 h-16 bg-red-50 text-red-500 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(hs,{size:32})}),e.jsx("h2",{className:"text-2xl font-bold text-slate-800 mb-2",children:"Acceso Denegado"}),e.jsx("p",{className:"text-slate-500",children:"Solo los administradores tienen permiso para ver esta pÃ¡gina."})]})});const F=async I=>{I.preventDefault(),x.trim()&&b.trim()&&(await d(x,b.toLowerCase().trim()),h(""),k(""))},o=async I=>{await i(I),C()},p=async I=>{if(window.confirm("Â¿EstÃ¡s seguro de eliminar este usuario? Esto no se puede deshacer.")){const{success:c,error:R}=await s(I);c?C():(alert("Error al eliminar usuario: "+((R==null?void 0:R.message)||"Error desconocido")),console.error("Error removing user:",R))}},D=async I=>{if(window.confirm("Â¿Desactivar acceso de este usuario? PasarÃ¡ a la lista de pendientes.")){const{success:c,error:R}=await N(I,!1);c?C():alert("Error al actualizar estado: "+R.message)}},A=async(I,c)=>{const R=c==="admin"?"user":"admin";window.confirm(`Â¿Cambiar rol de ${c} a ${R}?`)&&(await l(I,R),C())},T=async(I,c)=>{c&&window.confirm("Â¿Cambiar empresa del usuario?")&&(await z(I,c),C())},V=f==="all"?S:S.filter(I=>I.company_id===f),E=V.filter(I=>!I.is_authorized),W=V.filter(I=>I.is_authorized),B=()=>{if(!window.confirm("ADVERTENCIA: Â¿EstÃ¡s seguro de eliminar todos los datos huÃ©rfanos? Esta acciÃ³n es irreversible."))return;let I=0;const c=R=>{const q=localStorage.getItem(R);if(!q)return 0;try{const u=JSON.parse(q);if(!Array.isArray(u))return 0;const _=u.filter(y=>!!y.companyId),g=u.length-_.length;return g>0&&localStorage.setItem(R,JSON.stringify(_)),g}catch{return 0}};I+=c("fiveSData"),I+=c("quickWinsData"),I+=c("a3ProjectsData"),I+=c("vsmData"),alert(`Limpieza completada. Se eliminaron ${I} elementos huÃ©rfanos.`),window.location.reload()};return e.jsxs("div",{className:"p-8 max-w-[1600px] mx-auto space-y-8",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-slate-800 flex items-center gap-3",children:[e.jsx(hs,{className:"text-brand-600",size:28}),"AdministraciÃ³n del Sistema"]}),e.jsx("p",{className:"text-slate-500 mt-1",children:"GestiÃ³n centralizada de empresas, usuarios y mantenimiento."})]}),e.jsxs("div",{className:"flex bg-white rounded-lg p-1 border border-slate-200 shadow-sm",children:[e.jsxs("button",{onClick:()=>n(),className:"flex items-center gap-2 px-3 py-2 text-sm font-medium text-slate-600 hover:text-brand-600 hover:bg-slate-50 rounded-md transition-colors",title:"Recargar Datos",children:[e.jsx(He,{size:16})," Recargar"]}),e.jsx("div",{className:"w-px bg-slate-200 my-1 mx-1"}),e.jsxs("button",{onClick:async()=>{const I=await a();alert(I.message)},className:"flex items-center gap-2 px-3 py-2 text-sm font-medium text-slate-600 hover:text-blue-600 hover:bg-slate-50 rounded-md transition-colors",title:"Reparar Permisos",children:[e.jsx(nt,{size:16})," Permisos"]}),e.jsx("div",{className:"w-px bg-slate-200 my-1 mx-1"}),e.jsxs("button",{onClick:async()=>{try{const{supabase:I}=await vs(async()=>{const{supabase:g}=await Promise.resolve().then(()=>Pt);return{supabase:g}},void 0),{data:c,error:R}=await I.from("five_s_cards").select("id, responsible").is("company_id",null);if(R)throw R;if(!(c!=null&&c.length)){alert("âœ… No hay tarjetas 5S huÃ©rfanas.");return}const{data:q}=await I.from("profiles").select("name, company_id"),u={};q==null||q.forEach(g=>{g.name&&g.company_id&&(u[g.name]=g.company_id)});let _=0;for(const g of c){const y=u[g.responsible];y&&(await I.from("five_s_cards").update({company_id:y}).eq("id",g.id),_++)}alert(`âœ… ReparaciÃ³n completada: ${_} tarjetas correjidas.`)}catch(I){alert("Error: "+I.message)}},className:"flex items-center gap-2 px-3 py-2 text-sm font-medium text-slate-600 hover:text-emerald-600 hover:bg-slate-50 rounded-md transition-colors",title:"Reparar 5S",children:[e.jsx(se,{size:16})," Reparar 5S"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"xl:col-span-1 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-slate-100 bg-slate-50/50 flex justify-between items-center",children:[e.jsxs("h3",{className:"font-bold text-slate-700 flex items-center gap-2",children:[e.jsx(os,{size:18,className:"text-slate-400"}),"Empresas Registradas"]}),e.jsx("span",{className:"text-xs font-bold bg-white border border-slate-200 text-slate-500 px-2 py-1 rounded-full",children:r.length})]}),e.jsxs("div",{className:"p-4 bg-slate-50 border-b border-slate-200",children:[e.jsx("h4",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider mb-2",children:"Nueva Empresa"}),e.jsxs("form",{onSubmit:F,className:"flex flex-col gap-3",children:[e.jsx("input",{type:"text",className:"w-full px-3 py-2 bg-white border border-slate-200 rounded-lg text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none",placeholder:"Nombre de la empresa",value:x,onChange:I=>h(I.target.value)}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",className:"flex-1 px-3 py-2 bg-white border border-slate-200 rounded-lg text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none",placeholder:"Dominio (ej: acme.com)",value:b,onChange:I=>k(I.target.value)}),e.jsx("button",{type:"submit",disabled:!x.trim()||!b.trim(),className:"bg-brand-600 text-white p-2 rounded-lg hover:bg-brand-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:e.jsx(J,{size:20})})]})]})]}),e.jsx("div",{className:"max-h-[500px] overflow-y-auto custom-scrollbar",children:e.jsx("ul",{className:"divide-y divide-slate-100",children:r.map(I=>e.jsxs("li",{className:"p-4 hover:bg-slate-50 transition-colors flex justify-between items-center group",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-slate-800 text-sm",children:I.name}),e.jsx("p",{className:"text-xs text-slate-500",children:I.domain||"Sin dominio configurado"})]}),e.jsx("button",{onClick:()=>m(I.id),className:"text-slate-300 hover:text-rose-500 p-1.5 opacity-0 group-hover:opacity-100 transition-all",title:"Eliminar Empresa",children:e.jsx(Y,{size:16})})]},I.id))})}),e.jsx("div",{className:"p-3 bg-slate-50 border-t border-slate-200",children:e.jsx("button",{onClick:async()=>{const{generateTransportesDemoData:I}=await vs(async()=>{const{generateTransportesDemoData:c}=await import("./demoData-D1q3Osw3.js");return{generateTransportesDemoData:c}},__vite__mapDeps([0,1,2,3,4]));I(r,d)},className:"w-full py-2 text-xs font-bold text-emerald-600 bg-emerald-50 border border-emerald-100 rounded-lg hover:bg-emerald-100 transition-colors",children:"+ Generar Datos Demo"})})]}),e.jsxs("div",{className:"bg-red-50 rounded-xl border border-red-100 p-5",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-red-700 font-bold mb-2",children:[e.jsx(ls,{size:18})," Zona de Riesgo"]}),e.jsx("p",{className:"text-xs text-red-600 mb-4 leading-relaxed",children:"Acciones destructivas para mantenimiento de la base de datos. Elimina registros huÃ©rfanos que no pertenecen a ninguna empresa."}),e.jsx("button",{onClick:B,className:"w-full py-2 bg-white border border-red-200 text-red-600 text-xs font-bold rounded-lg hover:bg-red-50 hover:border-red-300 transition-colors shadow-sm",children:"Eliminar Datos Huerfanos"})]})]}),e.jsx("div",{className:"xl:col-span-2 space-y-6",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 flex flex-col min-h-[600px]",children:[e.jsxs("div",{className:"p-5 border-b border-slate-100 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-slate-800 flex items-center gap-2 text-lg",children:[e.jsx(Ss,{size:20,className:"text-brand-500"}),"GestiÃ³n de Usuarios"]}),e.jsx("p",{className:"text-sm text-slate-500 mt-1",children:"Autoriza y administra el acceso al sistema"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Ce,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"}),e.jsxs("select",{value:f,onChange:I=>O(I.target.value),className:"pl-9 pr-8 py-2 bg-slate-50 border border-slate-200 rounded-lg text-sm font-medium text-slate-600 focus:ring-2 focus:ring-brand-500 outline-none appearance-none cursor-pointer hover:bg-slate-100 transition-colors min-w-[200px]",children:[e.jsx("option",{value:"all",children:"Todas las Empresas"}),r.map(I=>e.jsx("option",{value:I.id,children:I.name},I.id))]})]})]}),e.jsxs("div",{className:"p-5 flex-1 bg-slate-50/30",children:[E.length>0&&e.jsxs("div",{className:"mb-8 animate-in slide-in-from-top-2",children:[e.jsxs("h4",{className:"text-xs font-bold text-amber-600 uppercase tracking-wider mb-3 flex items-center gap-2",children:[e.jsx(K,{size:14})," Solicitudes Pendientes (",E.length,")"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:E.map(I=>{var c;return e.jsxs("div",{className:"bg-white p-4 rounded-xl border-l-4 border-l-amber-400 border-y border-r border-slate-200 shadow-sm flex justify-between items-center group hover:shadow-md transition-all",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-slate-800",children:I.name}),e.jsx("div",{className:"text-xs text-slate-500 mb-1",children:I.email}),e.jsx("div",{className:"inline-block px-1.5 py-0.5 bg-amber-50 text-amber-700 text-[10px] font-bold rounded uppercase",children:((c=r.find(R=>R.id===I.company_id))==null?void 0:c.name)||"Desconocida"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>o(I.id),className:"p-2 bg-emerald-100 text-emerald-600 rounded-lg hover:bg-emerald-200 transition-colors",title:"Aprobar",children:e.jsx(K,{size:18})}),e.jsx("button",{onClick:()=>p(I.id),className:"p-2 bg-rose-100 text-rose-600 rounded-lg hover:bg-rose-200 transition-colors",title:"Rechazar",children:e.jsx(Y,{size:18})})]})]},I.id)})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h4",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider",children:"Usuarios Activos"}),e.jsxs("span",{className:"text-xs font-medium text-slate-400 bg-slate-100 px-2 py-1 rounded-full",children:[W.length," usuarios"]})]}),v?e.jsx("div",{className:"text-center py-12 text-slate-400 italic",children:"Cargando usuarios..."}):e.jsx("div",{className:"bg-white rounded-xl border border-slate-200 overflow-hidden shadow-sm",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-slate-50 text-slate-500 font-bold text-xs uppercase border-b border-slate-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-5 py-3",children:"Usuario"}),e.jsx("th",{className:"px-5 py-3 text-center",children:"Rol"}),e.jsx("th",{className:"px-5 py-3",children:"Empresa"}),e.jsx("th",{className:"px-5 py-3 text-right",children:"Acciones"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100",children:W.map(I=>e.jsxs("tr",{className:"hover:bg-slate-50 transition-colors",children:[e.jsxs("td",{className:"px-5 py-3",children:[e.jsx("div",{className:"font-semibold text-slate-700",children:I.name}),e.jsx("div",{className:"text-xs text-slate-400",children:I.email})]}),e.jsx("td",{className:"px-5 py-3 text-center",children:e.jsx("button",{onClick:()=>A(I.id,I.role),className:`px-2.5 py-1 rounded text-xs font-bold uppercase transition-all border ${I.role==="admin"?"bg-purple-50 text-purple-600 border-purple-200 hover:bg-purple-100":"bg-slate-100 text-slate-600 border-slate-200 hover:bg-slate-200"}`,children:I.role||"user"})}),e.jsx("td",{className:"px-5 py-3",children:e.jsxs("select",{value:I.company_id||"",onChange:c=>T(I.id,c.target.value),className:"bg-transparent text-sm text-slate-600 border-none focus:ring-0 cursor-pointer hover:text-brand-600 font-medium py-0 pl-0",children:[e.jsx("option",{value:"",disabled:!0,children:"Seleccionar..."}),r.map(c=>e.jsx("option",{value:c.id,children:c.name},c.id))]})}),e.jsxs("td",{className:"px-5 py-3 text-right flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>D(I.id),className:"text-slate-300 hover:text-amber-500 p-1.5 rounded-md hover:bg-amber-50 transition-colors",title:"Desactivar Acceso",children:e.jsx(ot,{size:16})}),e.jsx("button",{onClick:()=>p(I.id),className:"text-slate-300 hover:text-rose-500 p-1.5 rounded-md hover:bg-rose-50 transition-colors",title:"Eliminar Usuario",children:e.jsx(Y,{size:16})})]})]},I.id))})]})})]})]})]})})]})]})},Ns={S1:["Â¿Se han eliminado los elementos innecesarios del Ã¡rea?","Â¿Las herramientas y materiales estÃ¡n clasificados correctamente?","Â¿Los pasillos y zonas de paso estÃ¡n libres de obstÃ¡culos?"],S2:["Â¿Cada cosa tiene un lugar asignado y estÃ¡ en su lugar?","Â¿Las ubicaciones estÃ¡n claramente etiquetadas?","Â¿Es fÃ¡cil encontrar y devolver las herramientas?"],S3:["Â¿El Ã¡rea de trabajo estÃ¡ limpia y libre de polvo/aceite?","Â¿Existen programas de limpieza visibles y se siguen?","Â¿Los equipos de limpieza estÃ¡n disponibles y en buen estado?"],S4:['Â¿Existen estÃ¡ndares visuales claros para el estado "normal"?',"Â¿Se utiliza cÃ³digo de colores para identificar anomalÃ­as?","Â¿Todos conocen los procedimientos estÃ¡ndar?"],S5:["Â¿Se realizan auditorÃ­as periÃ³dicas?","Â¿Se respetan las normas establecidas consistentemente?","Â¿Existe un plan de mejora continua activo?"]},la=()=>{var u,_;const{user:t,globalFilterCompanyId:r}=Z(),[d,m]=j.useState("dashboard"),[s,i]=j.useState([]),[N,w]=j.useState(!0),[l,z]=j.useState([]),[n,a]=j.useState(!1),x={granularity:"month",yearFilter:new Date().getFullYear()},[h,b]=j.useState({title:"",area:"",auditor:"",date:new Date().toISOString().split("T")[0],entries:{}}),[k,S]=j.useState("S1"),[L,v]=j.useState(null),[$,f]=j.useState([]);j.useEffect(()=>{t&&O()},[t,r,O]);const O=j.useCallback(async()=>{w(!0);try{const g=await me.getAllAudits();z(g);let y=U.from("audit_5s").select(`
                    *,
                    audit_5s_entries (*)
                `).order("audit_date",{ascending:!1});(t==null?void 0:t.role)!=="admin"?t.company_id&&(y=y.eq("company_id",t.company_id)):r&&r!=="all"&&(y=y.eq("company_id",r));const{data:M,error:P}=await y;if(P)throw P;i(M||[])}catch(g){console.error("Error fetching audits:",g)}finally{w(!1)}},[t,r]),C=async()=>{a(!0);try{const g=await me.getAllAudits();if(g.length===0)return;let y=0;for(const M of g)try{const P={...M.data},G=P.entries;delete P.entries;const Q=t.role==="admin"&&r!=="all"?r:t.company_id||t.companyId;if(P.company_id=Q||t.companyId,!P.company_id){console.error("Missing company_id for sync",M);continue}const{data:H,error:ee}=await U.from("audit_5s").insert([P]).select().single();if(ee)throw ee;const de=[];if(Object.keys(G).forEach(Ne=>{G[Ne].forEach(ss=>{de.push({audit_id:H.id,section:Ne,question:ss.question,score:ss.score,comment:ss.comment})})}),de.length>0){const{error:Ne}=await U.from("audit_5s_entries").insert(de);if(Ne)throw Ne}await me.deleteAudit(M.tempId),y++}catch(P){console.error("Error syncing specific audit:",P)}alert(`SincronizaciÃ³n completada: ${y} auditorÃ­as subidas.`),O()}catch(g){console.error("Sync error:",g),alert("Error general en sincronizaciÃ³n")}finally{a(!1)}};j.useEffect(()=>{t&&(async()=>{try{let y=U.from("profiles").select("id, name, email");(t==null?void 0:t.role)!=="admin"?t.company_id&&(y=y.eq("company_id",t.company_id)):r&&r!=="all"&&(y=y.eq("company_id",r));const{data:M,error:P}=await y;!P&&M&&f(M)}catch(y){console.error("Error fetching users for auditor list:",y)}})()},[t,r]);const F=(g=null)=>{if(g){const y={};g.audit_5s_entries.forEach(M=>{y[M.section]||(y[M.section]=[]),y[M.section].push(M)}),b({title:g.title||"",area:g.area,auditor:g.auditor,date:g.audit_date,entries:y}),v(g.id)}else{const y={};Object.keys(Ns).forEach(P=>{y[P]=Ns[P].map(G=>({question:G,score:0,comment:""}))});const M=new Date;b({title:"",area:"",auditor:(t==null?void 0:t.name)||"",date:M.toISOString().split("T")[0],entries:y}),v(null)}m("form")},o=g=>{const y=g.target.value;b({...h,date:y})},p=(g,y,M,P)=>{const G={...h.entries};G[g][y][M]=P,b({...h,entries:G})},D=g=>{const y={...h.entries};y[g].push({question:"Nueva pregunta",score:0,comment:""}),b({...h,entries:y})},A=(g,y)=>{const M={...h.entries};M[g].splice(y,1),b({...h,entries:M})},T=g=>{const y=parseFloat(g);return y>5?y/20:y},V=()=>{let g=0,y=0;return Object.keys(h.entries).forEach(M=>{h.entries[M].forEach(P=>{g+=parseInt(P.score),y+=1})}),y>0?parseFloat((g/y).toFixed(2)):0},E=async g=>{if(g.preventDefault(),(t==null?void 0:t.role)==="admin"&&(!r||r==="all")){alert("Por favor, selecciona una empresa especÃ­fica en el filtro superior para guardar la auditorÃ­a.");return}w(!0);try{const y=V();let M=L;const P={area:h.area,auditor:h.auditor,audit_date:h.date,total_score:y,title:h.title};if(L){const{error:Q}=await U.from("audit_5s").update(P).eq("id",L);if(Q)throw Q;await U.from("audit_5s_entries").delete().eq("audit_id",L)}else{const H=(t.role==="admin"&&r!=="all"?r:t.company_id||t.companyId)||t.companyId;P.company_id=H;const{data:ee,error:de}=await U.from("audit_5s").insert([P]).select().single();if(de)throw de;M=ee.id}const G=[];Object.keys(h.entries).forEach(Q=>{h.entries[Q].forEach(H=>{G.push({audit_id:M,section:Q,question:H.question,score:H.score,comment:H.comment})})}),await U.from("audit_5s_entries").insert(G),O(),m("dashboard")}catch(y){console.error("Error saving:",y),alert("Error al guardar la auditorÃ­a")}finally{w(!1)}},W=async g=>{if(window.confirm("Â¿Eliminar auditorÃ­a?"))try{await U.from("audit_5s").delete().eq("id",g),O()}catch(y){console.error(y)}},B=j.useMemo(()=>s.filter(g=>new Date(g.audit_date).getFullYear()===parseInt(x.yearFilter)),[s,x.yearFilter]),I=g=>!g||!g.audit_5s_entries?[]:["S1","S2","S3","S4","S5"].map(M=>{const P=g.audit_5s_entries.filter(de=>de.section===M),G=P.reduce((de,Ne)=>de+Ne.score,0),Q=P.length,H=Q>0?parseFloat((G/Q).toFixed(1)):0;return{subject:M,A:H,fullMark:5}}),c=()=>{if(B.length===0)return[];const g={};return B.forEach(y=>{const M=new Date(y.audit_date+"T12:00:00");let P="";P=M.toLocaleString("es-ES",{month:"short"}),g[P]||(g[P]={sum:0,count:0,sumPoints:0,maxPoints:0,sortTime:M.getTime()}),g[P].count+=1;const G=y.audit_5s_entries.reduce((Q,H)=>Q+H.score,0);g[P].sum+=T(y.total_score),g[P].sumPoints+=G}),Object.keys(g).map(y=>{const M=g[y],P=M.count>0?parseFloat((M.sum/M.count).toFixed(2)):0;return{date:y,score:P,sortTime:M.sortTime}}).sort((y,M)=>y.sortTime-M.sortTime)},R=()=>{const g={};return B.forEach(y=>{g[y.area]||(g[y.area]={sum:0,count:0,rawSum:0}),g[y.area].sum+=T(y.total_score);const M=y.audit_5s_entries.reduce((P,G)=>P+G.score,0);g[y.area].rawSum+=M,g[y.area].count+=1}),Object.keys(g).map(y=>({name:y,score:parseFloat((g[y].sum/g[y].count).toFixed(2))}))},q=()=>{const g={S1:0,S2:0,S3:0,S4:0,S5:0},y={S1:0,S2:0,S3:0,S4:0,S5:0};return B.forEach(M=>{M.audit_5s_entries.forEach(P=>{g[P.section]!==void 0&&(g[P.section]+=P.score,y[P.section]+=1)})}),Object.keys(g).map(M=>{const P=g[M],G=y[M],Q=G>0?parseFloat((P/G).toFixed(2)):0;return{name:M,value:Q}})};return e.jsxs("div",{className:"page-container relative min-h-screen",children:[e.jsxs(ve,{title:"AuditorÃ­a 5S",subtitle:"EvaluaciÃ³n y seguimiento de estÃ¡ndares de orden y limpieza",children:[d==="dashboard"&&e.jsxs("button",{onClick:()=>F(),className:"bg-brand-600 hover:bg-brand-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors font-medium shadow-sm shadow-brand-500/30",children:[e.jsx(J,{size:20})," Nueva AuditorÃ­a"]}),d==="form"&&e.jsxs("button",{onClick:()=>m("dashboard"),className:"bg-slate-700 hover:bg-slate-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors font-medium shadow-sm",children:[e.jsx(ae,{size:20})," Cancelar"]}),l.length>0&&d==="dashboard"&&e.jsxs("button",{onClick:C,disabled:n,className:"bg-amber-100 hover:bg-amber-200 text-amber-800 px-4 py-2 rounded-lg flex items-center gap-2 transition-colors font-medium border border-amber-200 animate-pulse",children:[e.jsx(it,{size:20}),n?"Sincronizando...":`Sincronizar (${l.length})`]})]}),d==="dashboard"?e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[B.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white p-4 rounded-xl shadow-lg border border-slate-200",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-indigo-700",children:"Ãšltima AuditorÃ­a (Radar)"}),e.jsx("span",{className:"text-xs text-slate-500",children:((u=B[0])==null?void 0:u.title)||((_=B[0])==null?void 0:_.audit_date)})]}),e.jsx("div",{className:"h-64 w-full",children:e.jsx(te,{width:"100%",height:"100%",minWidth:100,minHeight:100,children:e.jsxs(gt,{cx:"50%",cy:"50%",outerRadius:"80%",data:I(B[0]),children:[e.jsx(jt,{stroke:"#e2e8f0"}),e.jsx(vt,{dataKey:"subject",tick:{fill:"#475569",fontSize:12,fontWeight:500}}),e.jsx(Nt,{angle:30,domain:[0,5],tickCount:6,tick:!0,axisLine:!1}),e.jsx(wt,{name:"Puntaje",dataKey:"A",stroke:"#4f46e5",fill:"#4f46e5",fillOpacity:.5}),e.jsx(ne,{contentStyle:{backgroundColor:"#ffffff",borderColor:"#e2e8f0",color:"#1e293b",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"}})]})})})]}),e.jsxs("div",{className:"bg-white p-4 rounded-xl shadow-lg border border-slate-200",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-emerald-700",children:["EvoluciÃ³n (",x.granularity,")"]}),e.jsx("div",{className:"flex gap-2 text-xs",children:e.jsx("span",{className:"bg-emerald-50 text-emerald-700 px-2 py-1 rounded font-medium",children:"Promedio"})})]}),e.jsx("div",{className:"h-64 w-full",children:e.jsx(te,{width:"100%",height:"100%",minWidth:100,minHeight:100,children:e.jsxs(_s,{data:c(),children:[e.jsx(ge,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),e.jsx(he,{dataKey:"date",stroke:"#64748b",fontSize:12,tickMargin:10}),e.jsx(be,{domain:[0,5],tickCount:6,stroke:"#64748b",fontSize:12}),e.jsx(ne,{contentStyle:{backgroundColor:"#ffffff",borderColor:"#e2e8f0",color:"#1e293b",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"}}),e.jsx(Pe,{}),e.jsx(ke,{type:"monotone",dataKey:"score",stroke:"#059669",strokeWidth:2,activeDot:{r:6},name:"Puntaje"})]})})})]}),e.jsxs("div",{className:"bg-white p-4 rounded-xl shadow-lg border border-slate-200",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-purple-700",children:"Puntaje Promedio por Ãrea"}),e.jsx("div",{className:"h-64 w-full",children:e.jsx(te,{width:"100%",height:"100%",minWidth:100,minHeight:100,children:e.jsxs(Je,{data:R(),children:[e.jsx(ge,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),e.jsx(he,{dataKey:"name",stroke:"#64748b",fontSize:12}),e.jsx(be,{domain:[0,5],tickCount:6,stroke:"#64748b",fontSize:12}),e.jsx(ne,{contentStyle:{backgroundColor:"#ffffff",borderColor:"#e2e8f0",color:"#1e293b",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"}}),e.jsx(_e,{dataKey:"score",fill:"#7c3aed",radius:[4,4,0,0],name:"Puntaje"})]})})})]}),e.jsxs("div",{className:"bg-white p-4 rounded-xl shadow-lg border border-slate-200",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-orange-700",children:"DesempeÃ±o Global por S"}),e.jsx("div",{className:"h-64 w-full",children:e.jsx(te,{width:"100%",height:"100%",minWidth:100,minHeight:100,children:e.jsxs(Je,{data:q(),layout:"vertical",children:[e.jsx(ge,{strokeDasharray:"3 3",horizontal:!1,stroke:"#e2e8f0"}),e.jsx(he,{type:"number",domain:[0,5],tickCount:6,stroke:"#64748b",fontSize:12}),e.jsx(be,{dataKey:"name",type:"category",stroke:"#64748b",width:30,fontSize:12}),e.jsx(ne,{contentStyle:{backgroundColor:"#ffffff",borderColor:"#e2e8f0",color:"#1e293b",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"}}),e.jsx(_e,{dataKey:"value",fill:"#ea580c",radius:[0,4,4,0],name:"Puntaje"})]})})})]})]}):e.jsxs("div",{className:"col-span-2 p-8 text-center text-slate-500 bg-slate-50 rounded-xl border border-slate-200 border-dashed",children:[e.jsx(Oe,{size:48,className:"mx-auto mb-4 opacity-50"}),e.jsxs("p",{className:"text-lg",children:["No hay datos para el aÃ±o ",x.yearFilter]}),e.jsx("p",{className:"text-sm",children:"Intente cambiar el filtro de aÃ±o o agregue una nueva auditorÃ­a."})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-lg border border-slate-200 col-span-1 lg:col-span-2",children:[e.jsxs("h3",{className:"text-xl font-semibold mb-4 text-slate-800",children:["Historial de AuditorÃ­as - ",x.yearFilter]}),e.jsxs("div",{className:"block md:hidden space-y-4",children:[B.map(g=>e.jsxs("div",{className:"bg-slate-50 p-4 rounded-xl border border-slate-200",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-800 font-bold",children:g.area}),e.jsx("div",{className:"text-xs text-slate-500",children:g.audit_date})]}),(()=>{const y=T(g.total_score);return e.jsx("span",{className:`px-2 py-1 rounded-lg text-xs font-bold ${y>=4?"bg-emerald-100 text-emerald-700":y>=3?"bg-amber-100 text-amber-700":"bg-red-100 text-red-700"}`,children:Number(y).toFixed(2)})})()]}),e.jsx("div",{className:"text-sm text-slate-600 mb-3 line-clamp-1",children:g.title||"Sin tÃ­tulo"}),e.jsxs("div",{className:"flex justify-between items-center border-t border-slate-200 pt-3",children:[e.jsx("span",{className:"text-xs text-slate-500",children:g.auditor}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>F(g),className:"p-2 bg-blue-50 text-blue-600 rounded-lg",children:e.jsx(bs,{size:16})}),e.jsx("button",{onClick:()=>W(g.id),className:"p-2 bg-red-50 text-red-600 rounded-lg",children:e.jsx(Y,{size:16})})]})]})]},g.id)),B.length===0&&e.jsx("div",{className:"text-center text-slate-500 py-4",children:"No hay registros."})]}),e.jsx("div",{className:"hidden md:block overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-slate-500 border-b border-slate-200 bg-slate-50 uppercase tracking-wider text-xs font-bold",children:[e.jsx("th",{className:"p-4",children:"Fecha"}),e.jsx("th",{className:"p-4",children:"TÃ­tulo / Ref"}),e.jsx("th",{className:"p-4",children:"Ãrea"}),e.jsx("th",{className:"p-4",children:"Auditor"}),e.jsx("th",{className:"p-4 text-center",children:"Puntaje"}),e.jsx("th",{className:"p-4 text-right",children:"Acciones"})]})}),e.jsxs("tbody",{children:[B.map(g=>e.jsxs("tr",{className:"border-b border-slate-100 hover:bg-slate-50 transition-colors group",children:[e.jsx("td",{className:"p-4 text-slate-700 font-semibold",children:g.audit_date}),e.jsx("td",{className:"p-4 text-slate-600 group-hover:text-slate-800 transition-colors",children:g.title||"-"}),e.jsx("td",{className:"p-4 text-indigo-600 font-medium",children:g.area}),e.jsx("td",{className:"p-4 text-slate-500",children:g.auditor}),e.jsx("td",{className:"p-4 text-center",children:(()=>{const y=T(g.total_score);return e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold shadow-sm ${y>=4?"bg-emerald-100 text-emerald-700 border border-emerald-200":y>=3?"bg-amber-100 text-amber-700 border border-amber-200":"bg-red-100 text-red-700 border border-red-200"}`,children:Number(y).toFixed(2)})})()}),e.jsx("td",{className:"p-4 text-right",children:e.jsxs("div",{className:"flex justify-end gap-2 opacity-70 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>F(g),className:"text-blue-500 hover:text-blue-700 p-2 hover:bg-blue-50 rounded-lg transition-colors",children:e.jsx(bs,{size:18})}),e.jsx("button",{onClick:()=>W(g.id),className:"text-red-500 hover:text-red-700 p-2 hover:bg-red-50 rounded-lg transition-colors",children:e.jsx(Y,{size:18})})]})})]},g.id)),B.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"p-8 text-center text-slate-500",children:"No hay registros para este perÃ­odo."})})]})]})})]})]}):e.jsx("div",{className:"bg-white p-6 rounded-xl shadow-lg border border-slate-200 max-w-4xl mx-auto animate-fadeIn",children:e.jsxs("form",{onSubmit:E,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-600 mb-1",children:"TÃ­tulo de Referencia (Opcional)"}),e.jsxs("div",{className:"relative",children:[e.jsx(dt,{className:"absolute left-3 top-3 text-slate-400",size:18}),e.jsx("input",{type:"text",className:"w-full bg-slate-50 border border-slate-300 rounded-lg py-2 pl-10 pr-4 text-slate-800 focus:outline-none focus:border-indigo-500 focus:bg-white transition-colors",value:h.title,onChange:g=>b({...h,title:g.target.value}),placeholder:"Ej. AuditorÃ­a Trimestral Q1"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-600 mb-1",children:"Ãrea"}),e.jsxs("div",{className:"relative",children:[e.jsx(os,{className:"absolute left-3 top-3 text-slate-400",size:18}),e.jsx("input",{type:"text",required:!0,className:"w-full bg-slate-50 border border-slate-300 rounded-lg py-2 pl-10 pr-4 text-slate-800 focus:outline-none focus:border-indigo-500 focus:bg-white transition-colors",value:h.area,onChange:g=>b({...h,area:g.target.value}),placeholder:"Ej. ProducciÃ³n"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-600 mb-1",children:"Auditor"}),e.jsxs("div",{className:"relative",children:[e.jsx(re,{className:"absolute left-3 top-3 text-slate-400",size:18}),$.length>0?e.jsxs("select",{required:!0,className:"w-full bg-slate-50 border border-slate-300 rounded-lg py-2 pl-10 pr-4 text-slate-800 focus:outline-none focus:border-indigo-500 appearance-none focus:bg-white transition-colors",value:h.auditor,onChange:g=>b({...h,auditor:g.target.value}),children:[e.jsx("option",{value:"",children:"Seleccionar Auditor"}),$.map(g=>e.jsx("option",{value:g.name||g.email,children:g.name||g.email},g.id)),e.jsx("option",{value:"Externo",children:"Externo / Otro"})]}):e.jsx("input",{type:"text",required:!0,className:"w-full bg-slate-50 border border-slate-300 rounded-lg py-2 pl-10 pr-4 text-slate-800 focus:outline-none focus:border-indigo-500 focus:bg-white transition-colors",value:h.auditor,onChange:g=>b({...h,auditor:g.target.value}),placeholder:"Nombre del Auditor"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-600 mb-1",children:"Fecha"}),e.jsxs("div",{className:"relative",children:[e.jsx(le,{className:"absolute left-3 top-3 text-slate-400",size:18}),e.jsx("input",{type:"date",required:!0,className:"w-full bg-slate-50 border border-slate-300 rounded-lg py-2 pl-10 pr-4 text-slate-800 focus:outline-none focus:border-indigo-500 focus:bg-white transition-colors",value:h.date,onChange:o})]})]})]}),e.jsx("div",{className:"space-y-4",children:["S1","S2","S3","S4","S5"].map(g=>{var y;return e.jsxs("div",{className:"border border-slate-200 rounded-lg overflow-hidden bg-white",children:[e.jsxs("button",{type:"button",onClick:()=>S(k===g?null:g),className:`w-full flex justify-between items-center p-4 text-left transition-colors ${k===g?"bg-indigo-50 text-indigo-700":"bg-white text-slate-600 hover:bg-slate-50"}`,children:[e.jsxs("span",{className:"font-bold text-lg",children:[g," - ",g==="S1"?"Clasificar (Seiri)":g==="S2"?"Ordenar (Seiton)":g==="S3"?"Limpiar (Seiso)":g==="S4"?"Estandarizar (Seiketsu)":"Disciplina (Shitsuke)"]}),k===g?e.jsx(Qe,{}):e.jsx(Se,{})]}),k===g&&e.jsxs("div",{className:"p-4 bg-slate-50",children:[(y=h.entries[g])==null?void 0:y.map((M,P)=>e.jsxs("div",{className:"mb-4 pb-4 border-b border-slate-200 last:border-0",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-2 md:gap-4 mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs text-slate-500 uppercase font-semibold",children:"Pregunta"}),e.jsx("input",{type:"text",className:"w-full bg-white border border-slate-300 rounded p-2 text-sm text-slate-800",value:M.question,onChange:G=>p(g,P,"question",G.target.value)})]}),e.jsxs("div",{className:"w-24",children:[e.jsx("label",{className:"text-xs text-slate-500 uppercase font-semibold",children:"Nota (0-5)"}),e.jsx("select",{className:"w-full bg-white border border-slate-300 rounded p-2 text-sm text-slate-800",value:M.score,onChange:G=>p(g,P,"score",parseInt(G.target.value)),children:[0,1,2,3,4,5].map(G=>e.jsx("option",{value:G,children:G},G))})]}),e.jsx("button",{type:"button",onClick:()=>A(g,P),className:"text-red-500 hover:text-red-700 mt-5",children:e.jsx(Y,{size:18})})]}),e.jsx("div",{children:e.jsx("input",{type:"text",placeholder:"Observaciones...",className:"w-full bg-transparent border-b border-slate-300 focus:border-indigo-500 text-sm py-1 text-slate-600 focus:text-slate-900 focus:outline-none transition-colors",value:M.comment||"",onChange:G=>p(g,P,"comment",G.target.value)})})]},P)),e.jsxs("button",{type:"button",onClick:()=>D(g),className:"text-sm text-indigo-600 hover:text-indigo-800 flex items-center gap-1 mt-2",children:[e.jsx(J,{size:16})," Agregar Criterio"]})]})]},g)})}),e.jsxs("div",{className:"mt-8 flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:()=>m("dashboard"),className:"px-6 py-2 rounded-lg bg-slate-100 hover:bg-slate-200 text-slate-700 transition-colors",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:N,className:"px-6 py-2 rounded-lg bg-indigo-600 hover:bg-indigo-500 text-white font-semibold shadow-lg shadow-indigo-500/30 transition-all flex items-center gap-2",children:N?"Guardando...":e.jsxs(e.Fragment,{children:[e.jsx(Me,{size:20})," Guardar AuditorÃ­a"]})})]})]})}),d==="dashboard"&&e.jsx(ms,{icon:J,onClick:()=>F(),label:"Nueva AuditorÃ­a"})]})},$s="https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent",na=t=>!t||t.length===0?"No hay diagramas de Ishikawa.":t.map((r,d)=>{const m=r.problem||"Problema no definido",s=Object.entries(r.categories||{}).map(([i,N])=>{if(!N||N.length===0)return null;const w=N.map(l=>{const z=typeof l=="string"?l:l.text,n=l.color==="green"?"(SI OCURRE)":l.color==="red"?"(NO OCURRE)":"";return`      - ${z} ${n}`}).join(`
`);return`    * ${i}:
${w}`}).filter(Boolean).join(`
`);return`  Diagrama #${d+1}: Problema: "${m}"
    Causa RaÃ­z Seleccionada: ${r.rootCause||"Ninguna"}
${s}`}).join(`

`),oa=t=>!t||t.length===0?"No hay anÃ¡lisis de 5 PorquÃ©s.":t.map((r,d)=>{const m=(r.whys||[]).filter(i=>i.trim().length>0).join(" -> "),s=r.status==="root"?"(CAUSA RAÃZ)":r.status==="discarded"?"(DESCARTADO)":"";return`  AnÃ¡lisis #${d+1}: ${r.problem}
    Cadena: ${m} ${s}`}).join(`
`),ia=t=>!t||t.length===0?"No hay grÃ¡ficos de seguimiento.":t.map((r,d)=>{const s=(r.dataPoints||[]).slice(-3).map(i=>`${i.label}: ${i.value}`).join(", ");return`  GrÃ¡fico #${d+1}: ${r.kpiName||"Sin nombre"}
    Meta: ${r.goal||"N/A"}
    Ãšltimos datos: ${s}`}).join(`
`),Fs=(t,r)=>`
Eres el consultor experto de IA integrado en "Nexus Be Lean", un software avanzado de gestiÃ³n de mejora continua.
Trabajas para una empresa de consultorÃ­a de excelencia operacional.

CONTEXTO DEL SOFTWARE "NEXUS BE LEAN":
Este software permite a las empresas gestionar digitalmente sus iniciativas Lean:
- MÃ³dulo 5S: DigitalizaciÃ³n de auditorÃ­as 5S, seguimiento de hallazgos con fotos antes/despuÃ©s y gestiÃ³n de acciones correctivas.
- MÃ³dulo Quick Wins: Captura y gestiÃ³n Ã¡gil de ideas de mejora rÃ¡pida y bajo costo.
- MÃ³dulo A3: GestiÃ³n estructurada de resoluciÃ³n de problemas complejos (Ishikawa, 5 PorquÃ©s, Plan de AcciÃ³n).
- MÃ³dulo VSM (Value Stream Mapping): Mapeo de flujo de valor para identificar desperdicios.

FECHA DE HOY: ${new Date().toLocaleDateString("es-ES",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}
EMPRESA EN ANÃLISIS: ${r||"Cliente"}

Tu rol es analizar los datos de avance de proyectos de mejora continua y proporcionar insights valiosos.
Puedes responder preguntas sobre quÃ© es el software, quÃ© mÃ³dulos tiene y cÃ³mo usar las herramientas Lean disponibles.
Debes ser directo, prÃ¡ctico y enfocado en agregar valor.

=== DATOS ACTUALES DE LA EMPRESA ===

ðŸ“‹ TARJETAS 5S:
- Total: ${t.fiveS.total}
- Cerradas: ${t.fiveS.closed}
- Pendientes: ${t.fiveS.pending}
- En Proceso: ${t.fiveS.inProcess}
- Tasa de cierre: ${t.fiveS.rate}%
${t.fiveS.oldestPending?`- Hallazgo mÃ¡s antiguo pendiente: ${t.fiveS.oldestPending} dÃ­as`:""}
${t.fiveS.details.length>0?`
Detalles de pendientes:
${t.fiveS.details.map(m=>`  â€¢ ${m.reason||"Sin razÃ³n"} - UbicaciÃ³n: ${m.location||"N/A"} - Responsable: ${m.responsible||"Sin asignar"} - Fecha: ${m.date||"N/A"}`).join(`
`)}`:""}

âš¡ QUICK WINS:
- Total ideas: ${t.quickWins.total}
- Implementadas: ${t.quickWins.done}
- Pendientes: ${t.quickWins.pending}
- Alto Impacto sin implementar: ${t.quickWins.highImpactPending}
${t.quickWins.details.length>0?`
Detalles de pendientes:
${t.quickWins.details.map(m=>`  â€¢ "${m.title}" - Impacto: ${m.impact||"N/A"} - Responsable: ${m.responsible||"Sin asignar"}`).join(`
`)}`:""}

ðŸ“Š PROYECTOS A3 (DETALLADO):
- Total proyectos: ${t.a3.total}
- Cerrados: ${t.a3.closed}
- En Proceso: ${t.a3.inProcess}
- Avance en planes de acciÃ³n: ${t.a3.actionPlanRate}%

DETALLE DE PROYECTOS ACTIVOS:
${t.a3.details.length>0?t.a3.details.map(m=>`
> PROYECTO: "${m.title}" (Estado: ${m.status}, Responsable: ${m.responsible||"Sin asignar"})
  - Antecedentes: ${m.background||"No definido"}
  - CondiciÃ³n Actual: ${m.currentCondition||"No definida"}
  - Objetivo: ${m.goal||"No definido"}
  - Resumen AnÃ¡lisis Causa RaÃ­z: ${m.rootCause||"No definido"}
  - AnÃ¡lisis Ishikawa:
${na(m.ishikawas)}
  - AnÃ¡lisis 5 PorquÃ©s:
${oa(m.fiveWhys)}
  - Contramedidas: ${m.countermeasures||"No definidas"}
  - Seguimiento (KPIs):
${ia(m.followUpData)}
`).join(`
--------------------------------------------------
`):"No hay proyectos activos con detalle."}

ðŸ—ºï¸ VSM (Value Stream Mapping):
- Mapas creados: ${t.vsm.count}

ðŸ—‘ï¸ HISTORIAL DE ELIMINACIONES RECIENTES:
${t.auditHistory&&t.auditHistory.deletedItems.length>0?t.auditHistory.deletedItems.map(m=>`  â€¢ [${m.date?new Date(m.date).toLocaleDateString():"N/A"}] ${m.type}: ${m.details.location||""} - ${m.details.reason||""} (Por: ${m.user||"Desconocido"})`).join(`
`):"No hay registros recientes de eliminaciÃ³n."}

=== TU ANÃLISIS DEBE INCLUIR ===

1. **RESUMEN EJECUTIVO** (2-3 oraciones mÃ¡ximo)
   EvaluaciÃ³n general del estado de la mejora continua.

2. **EVALUACIÃ“N DE PROGRESO** 
   - Analiza si los proyectos A3 tienen coherencia lÃ³gica (Causa raÃ­z -> Contramedida).
   - Verifica si los Ishikawas tienen causas profundas o superficiales.
   - Revisa si los 5 PorquÃ©s realmente llegan a la causa raÃ­z.
   - Â¿Se estÃ¡n trabajando los pendientes o estÃ¡n estancados?

3. **ALERTAS CRÃTICAS** (si las hay)
   - Proyectos A3 con "saltos de lÃ³gica" (ej: soluciÃ³n no relacionada a la causa).
   - Objetivos vagos no medibles.
   - Ishikawas vacÃ­os o incompletos en proyectos "En Proceso".
   - Tarjetas 5S muy antiguas sin cerrar.

4. **COACHING EN BUENAS PRÃCTICAS**
   Educa al equipo sobre errores especÃ­ficos detectados en los datos provistos.
   Ej: "En el proyecto X, el 5to PorquÃ© parece ser una justificaciÃ³n, no una causa raÃ­z."

5. **TOP 3 ACCIONES RECOMENDADAS**
   Acciones especÃ­ficas, priorizadas, con responsable sugerido.

6. **ENFOQUE DEL DÃA**
   Una Ãºnica prioridad clara para hoy.

=== FORMATO DE RESPUESTA ===
Responde en JSON con esta estructura exacta:
{
    "resumenEjecutivo": "texto",
    "evaluacionProgreso": {
        "estado": "bueno|regular|critico",
        "observaciones": ["observaciÃ³n 1", "observaciÃ³n 2"]
    },
    "alertas": [
        {"tipo": "critica|advertencia|info", "mensaje": "texto", "proyecto": "nombre si aplica"}
    ],
    "coachingPracticas": [
        {"tema": "tÃ­tulo corto", "consejo": "explicaciÃ³n prÃ¡ctica y especÃ­fica al contexto"}
    ],
    "accionesRecomendadas": [
        {"prioridad": 1, "accion": "texto", "responsableSugerido": "nombre o null", "impacto": "alto|medio|bajo"}
    ],
    "enfoqueDelDia": "texto motivador y especÃ­fico",
    "metricaDestacada": {"nombre": "ej: Tasa 5S", "valor": "75%", "tendencia": "up|down|stable"}
}

SÃ© constructivo pero honesto. Si hay problemas metodolÃ³gicos en los A3, seÃ±Ã¡lalos.
`,ws=(t,r="Cliente")=>{var O;const{fiveS:d,quickWins:m,vsms:s,a3:i,auditLogs:N}=t,w=d.filter(C=>C.status==="Cerrado").length,l=d.filter(C=>C.status==="Pendiente").length,z=d.filter(C=>C.status==="En Proceso").length,n=d.length>0?Math.round(w/d.length*100):0,a=d.filter(C=>C.status!=="Cerrado"&&C.date).map(C=>({...C,daysSince:Math.floor((new Date-new Date(C.date))/(1e3*60*60*24))})).sort((C,F)=>F.daysSince-C.daysSince),x=m.filter(C=>C.status==="done").length,h=m.filter(C=>C.status!=="done").length,b=m.filter(C=>C.status!=="done"&&C.impact==="Alto").length,k=i.filter(C=>C.status==="Cerrado").length,S=i.filter(C=>C.status==="En Proceso").length;let L=0,v=0;i.forEach(C=>{Array.isArray(C.actionPlan)&&(L+=C.actionPlan.length,v+=C.actionPlan.filter(F=>F.status==="done").length)});const $=L>0?Math.round(v/L*100):0,f=i.filter(C=>C.status!=="Cerrado").slice(0,5).map(C=>{var F,o;return{title:C.title,status:C.status,responsible:C.responsible,background:C.background,currentCondition:C.currentCondition,goal:C.goal,rootCause:C.rootCause,countermeasures:C.countermeasures,ishikawas:C.ishikawas,fiveWhys:C.multipleFiveWhys,followUpData:C.followUpData,hasGoal:!!(C.goal&&C.goal.trim().length>0),actionCount:((F=C.actionPlan)==null?void 0:F.length)||0,actionsCompleted:((o=C.actionPlan)==null?void 0:o.filter(p=>p.status==="done").length)||0}});return{companyName:r,fiveS:{total:d.length,closed:w,pending:l,inProcess:z,rate:n,oldestPending:((O=a[0])==null?void 0:O.daysSince)||null,details:a.slice(0,5)},quickWins:{total:m.length,done:x,pending:h,highImpactPending:b,details:m.filter(C=>C.status!=="done").slice(0,5)},a3:{total:i.length,closed:k,inProcess:S,actionPlanRate:$,details:f},vsm:{count:s.length},auditHistory:{deletedItems:N?N.filter(C=>C.action==="DELETE").map(C=>{var F;return{type:C.entity_type,date:C.created_at,details:((F=C.details)==null?void 0:F.deletedData)||{},user:C.user_email}}).slice(0,15):[]}}},da=async(t,r,d)=>{var s,i,N,w,l,z;if(!d)throw new Error("API Key de Gemini no configurada");const m=Fs(t,r);try{const n=await fetch(`${$s}?key=${d}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:m}]}],generationConfig:{temperature:.7,maxOutputTokens:2048,responseMimeType:"application/json"}})});if(!n.ok){const b=await n.json();throw new Error(((s=b.error)==null?void 0:s.message)||"Error en la API de Gemini")}const x=(z=(l=(w=(N=(i=(await n.json()).candidates)==null?void 0:i[0])==null?void 0:N.content)==null?void 0:w.parts)==null?void 0:l[0])==null?void 0:z.text;if(!x)throw new Error("Respuesta vacÃ­a de Gemini");return{...JSON.parse(x),generatedAt:new Date().toISOString(),companyName:r,contextData:t,basePrompt:m}}catch(n){throw console.error("Error generating AI insight:",n),n}},ca=async(t,r,d,m,s)=>{var w,l,z,n,a,x;if(!s)throw new Error("API Key de Gemini no configurada");const N=[{role:"user",parts:[{text:Fs(d,m)+`

IMPORTANTE: A partir de ahora, responde como un asistente de chat conversacional, respondiendo a las preguntas especÃ­ficas del usuario sobre estos datos. No generes JSON, responde en Markdown.`}]},{role:"model",parts:[{text:"Entendido. Estoy listo para responder preguntas sobre los datos de mejora continua de la empresa."}]},...t.map(h=>({role:h.role==="user"?"user":"model",parts:[{text:h.content}]})),{role:"user",parts:[{text:r}]}];try{const h=await fetch(`${$s}?key=${s}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:N,generationConfig:{temperature:.7,maxOutputTokens:1024}})});if(!h.ok){const S=await h.json();throw new Error(((w=S.error)==null?void 0:w.message)||"Error en el chat con Gemini")}const k=(x=(a=(n=(z=(l=(await h.json()).candidates)==null?void 0:l[0])==null?void 0:z.content)==null?void 0:n.parts)==null?void 0:a[0])==null?void 0:x.text;if(!k)throw new Error("Respuesta vacÃ­a del chat");return k}catch(h){throw console.error("Error in chat:",h),h}},ma=t=>!t||!t.generatedAt?!0:(new Date-new Date(t.generatedAt))/(1e3*60*60)>=24,xa=({data:t,companyName:r,apiKey:d,fullScreen:m=!1})=>{var E,W,B,I;const[s,i]=j.useState(null),[N,w]=j.useState(!1),[l,z]=j.useState(null),[n,a]=j.useState(!0),[x,h]=j.useState(!1),[b,k]=j.useState("analysis"),[S,L]=j.useState([]),[v,$]=j.useState(""),[f,O]=j.useState(!1),C=j.useRef(null);j.useEffect(()=>{const c=localStorage.getItem(`ai_insight_${r||"default"}`);if(c)try{const R=JSON.parse(c);i(R),ma(R)&&d&&F()}catch(R){console.error("Error parsing cached insight:",R)}},[r]),j.useEffect(()=>{b==="chat"&&C.current&&C.current.scrollIntoView({behavior:"smooth"})},[S,b]);const F=async()=>{var c,R,q;if(!d){z("Configura VITE_GEMINI_API_KEY en las variables de entorno");return}w(!0),z(null);try{const u=ws(t,r),_=await da(u,r,d);i(_),localStorage.setItem(`ai_insight_${r||"default"}`,JSON.stringify(_)),S.length===0&&L([{role:"model",content:`Hola, he analizado los datos de ${r||"la empresa"}. Veo ${((R=(c=_==null?void 0:_.a3)==null?void 0:c.details)==null?void 0:R.length)||0} proyectos A3 activos y ${((q=_==null?void 0:_.fiveS)==null?void 0:q.pending)||0} tarjetas 5S pendientes. Â¿En quÃ© puedo profundizar?`}])}catch(u){console.error("Error generating insight:",u),z(u.message||"Error al generar anÃ¡lisis")}finally{w(!1)}},o=async c=>{if(c.preventDefault(),!v.trim()||f)return;const R={role:"user",content:v},q=[...S,R];L(q),$(""),O(!0);try{const u=ws(t,r),_=await ca(q,v,u,r,d);L(g=>[...g,{role:"model",content:_}])}catch(u){console.error(u),L(_=>[..._,{role:"model",content:"Lo siento, hubo un error al procesar tu mensaje."}])}finally{O(!1)}},p=c=>{switch(c){case"bueno":return"bg-emerald-500";case"regular":return"bg-amber-500";case"critico":return"bg-red-500";default:return"bg-slate-400"}},D=c=>{switch(c){case"critica":return e.jsx(Le,{size:14,className:"text-red-500"});case"advertencia":return e.jsx(ls,{size:14,className:"text-amber-500"});default:return e.jsx(ht,{size:14,className:"text-blue-500"})}},A=c=>{switch(c){case"critica":return"bg-red-50 border-red-100";case"advertencia":return"bg-amber-50 border-amber-100";default:return"bg-blue-50 border-blue-100"}},T=c=>{switch(c){case"up":return e.jsx(Fe,{size:16,className:"text-emerald-500"});case"down":return e.jsx(pt,{size:16,className:"text-red-500"});default:return e.jsx(ut,{size:16,className:"text-slate-400"})}},V=c=>c?new Date(c).toLocaleDateString("es-ES",{day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"}):"";return d?e.jsxs("div",{className:`bg-white rounded-2xl shadow-[0_8px_30px_rgb(0,0,0,0.04)] border border-slate-100 overflow-hidden flex flex-col ${m?"h-full":"max-h-[800px]"}`,children:[e.jsxs("div",{className:"bg-gradient-to-r from-slate-800 via-slate-800 to-cyan-900 p-0 flex flex-col shrink-0",children:[e.jsxs("div",{className:`p-5 flex items-center justify-between ${m?"":"cursor-pointer"}`,onClick:()=>!m&&a(!n),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2.5 bg-gradient-to-br from-cyan-400 to-cyan-600 rounded-xl shadow-lg shadow-cyan-500/30",children:e.jsx(ze,{size:22,className:"text-white"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-white flex items-center gap-2",children:["Consultor IA",e.jsx(ct,{size:14,className:"text-cyan-400"})]}),e.jsx("p",{className:"text-slate-400 text-xs",children:"AnÃ¡lisis de Mejora Continua"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[(s==null?void 0:s.generatedAt)&&e.jsx("span",{className:"text-[10px] text-slate-500 hidden sm:block",children:V(s.generatedAt)}),e.jsx("button",{onClick:c=>{c.stopPropagation(),F()},disabled:N,className:"p-2 bg-white/10 hover:bg-white/20 rounded-lg transition-colors disabled:opacity-50",title:"Regenerar anÃ¡lisis",children:e.jsx(He,{size:16,className:`text-white ${N?"animate-spin":""}`})}),e.jsx("button",{className:"p-1 text-slate-400",children:!m&&(n?e.jsx(Qe,{size:20}):e.jsx(Se,{size:20}))})]})]}),n&&e.jsxs("div",{className:"flex bg-slate-900/50 backdrop-blur-sm px-2 pt-2 gap-1 border-t border-white/5",children:[e.jsxs("button",{onClick:()=>k("analysis"),className:`flex items-center gap-2 px-4 py-2.5 text-xs font-bold uppercase tracking-wider rounded-t-lg transition-colors ${b==="analysis"?"bg-white text-slate-800":"text-slate-400 hover:bg-white/5 hover:text-slate-200"}`,children:[e.jsx(ie,{size:14})," AnÃ¡lisis"]}),e.jsxs("button",{onClick:()=>k("chat"),className:`flex items-center gap-2 px-4 py-2.5 text-xs font-bold uppercase tracking-wider rounded-t-lg transition-colors ${b==="chat"?"bg-white text-slate-800":"text-slate-400 hover:bg-white/5 hover:text-slate-200"}`,children:[e.jsx(fs,{size:14})," Chat Asistente"]})]})]}),n&&e.jsxs("div",{className:"flex-1 overflow-hidden flex flex-col bg-slate-50 relative min-h-[400px]",children:[N&&e.jsxs("div",{className:"absolute inset-0 z-20 bg-white/80 backdrop-blur-sm flex flex-col items-center justify-center",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ze,{size:48,className:"text-slate-200 animate-pulse"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"w-12 h-12 border-2 border-cyan-500 border-t-transparent rounded-full animate-spin"})})]}),e.jsx("p",{className:"mt-4 text-sm text-slate-500 font-medium",children:"Analizando datos..."})]}),l&&!N&&e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"bg-red-50 border border-red-100 rounded-xl p-4 flex items-start gap-3",children:[e.jsx(Le,{size:20,className:"text-red-500 shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-red-800",children:"Error al generar anÃ¡lisis"}),e.jsx("p",{className:"text-xs text-red-600 mt-1",children:l}),e.jsx("button",{onClick:F,className:"mt-2 text-xs font-bold text-red-600 hover:text-red-800",children:"Reintentar â†’"})]})]})}),!s&&!N&&!l&&e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-8",children:[e.jsx(ze,{size:48,className:"text-slate-200 mb-4"}),e.jsx("p",{className:"text-slate-500 mb-4",children:"No hay anÃ¡lisis generado aÃºn"}),e.jsx("button",{onClick:F,className:"px-4 py-2 bg-cyan-600 hover:bg-cyan-700 text-white rounded-lg text-sm font-bold transition-colors",children:"Generar AnÃ¡lisis IA"})]}),s&&!N&&!l&&b==="analysis"&&e.jsxs("div",{className:"flex-1 overflow-y-auto p-5 space-y-5 animate-in fade-in slide-in-from-left-4 duration-300",children:[e.jsx("div",{className:"bg-white rounded-xl p-4 border border-slate-200 shadow-sm",children:e.jsxs("p",{className:"text-slate-700 text-sm leading-relaxed italic",children:['"',s.resumenEjecutivo,'"']})}),s.metricaDestacada&&e.jsxs("div",{className:"flex items-center justify-between bg-white rounded-xl p-4 border border-slate-100 shadow-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider",children:s.metricaDestacada.nombre}),e.jsx("p",{className:"text-2xl font-black text-slate-800",children:s.metricaDestacada.valor})]}),e.jsx("div",{className:"p-3 bg-slate-50 rounded-xl",children:T(s.metricaDestacada.tendencia)})]}),((W=(E=s.evaluacionProgreso)==null?void 0:E.observaciones)==null?void 0:W.length)>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider mb-3 flex items-center gap-2",children:[e.jsx(ie,{size:14})," EvaluaciÃ³n de Progreso"]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 border border-slate-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:`w-2.5 h-2.5 rounded-full ${p(s.evaluacionProgreso.estado)}`}),e.jsxs("span",{className:"text-xs font-bold uppercase text-slate-600",children:["Estado: ",s.evaluacionProgreso.estado]})]}),e.jsx("ul",{className:"space-y-2",children:s.evaluacionProgreso.observaciones.map((c,R)=>e.jsxs("li",{className:"flex items-start gap-2 text-sm text-slate-600",children:[e.jsx(K,{size:14,className:"text-slate-400 shrink-0 mt-0.5"}),c]},R))})]})]}),((B=s.alertas)==null?void 0:B.length)>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider mb-3 flex items-center gap-2",children:[e.jsx(ls,{size:14})," Alertas"]}),e.jsx("div",{className:"space-y-2",children:s.alertas.map((c,R)=>e.jsxs("div",{className:`flex items-start gap-3 p-3 rounded-lg border ${A(c.tipo)}`,children:[D(c.tipo),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-slate-700",children:c.mensaje}),c.proyecto&&e.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:["Proyecto: ",c.proyecto]})]})]},R))})]}),((I=s.coachingPracticas)==null?void 0:I.length)>0&&e.jsxs("div",{className:"border border-cyan-100 rounded-xl overflow-hidden bg-white shadow-sm",children:[e.jsxs("button",{onClick:()=>h(!x),className:"w-full flex items-center justify-between p-4 bg-gradient-to-r from-cyan-50 to-white hover:from-cyan-100 transition-colors",children:[e.jsxs("span",{className:"flex items-center gap-2 text-sm font-bold text-cyan-800",children:[e.jsx(mt,{size:16}),"Coaching en Buenas PrÃ¡cticas"]}),x?e.jsx(Qe,{size:18,className:"text-cyan-600"}):e.jsx(Se,{size:18,className:"text-cyan-600"})]}),x&&e.jsx("div",{className:"p-4 space-y-4 animate-in fade-in duration-200",children:s.coachingPracticas.map((c,R)=>e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-1.5 bg-cyan-100 rounded-lg shrink-0",children:e.jsx(ye,{size:14,className:"text-cyan-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold text-slate-800",children:c.tema}),e.jsx("p",{className:"text-xs text-slate-600 mt-1 leading-relaxed",children:c.consejo})]})]},R))})]}),s.enfoqueDelDia&&e.jsxs("div",{className:"bg-gradient-to-r from-cyan-500 to-cyan-600 rounded-xl p-4 text-white shadow-lg shadow-cyan-500/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ie,{size:16}),e.jsx("span",{className:"text-xs font-bold uppercase tracking-wider opacity-80",children:"Enfoque del DÃ­a"})]}),e.jsx("p",{className:"text-sm font-medium leading-relaxed",children:s.enfoqueDelDia})]})]}),s&&!N&&!l&&b==="chat"&&e.jsxs("div",{className:"flex-1 flex flex-col h-full animate-in fade-in slide-in-from-right-4 duration-300",children:[e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 bg-slate-50",children:[S.length===0&&e.jsxs("div",{className:"text-center py-12 px-6",children:[e.jsx("div",{className:"bg-cyan-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4 text-cyan-600",children:e.jsx(fs,{size:32})}),e.jsx("h4",{className:"text-slate-800 font-bold mb-2",children:"Asistente de Mejora Continua"}),e.jsx("p",{className:"text-slate-500 text-sm",children:"PregÃºntame sobre tus Ishikawas, 5 PorquÃ©s o cÃ³mo mejorar tus KPIs."})]}),S.map((c,R)=>e.jsx("div",{className:`flex ${c.role==="user"?"justify-end":"justify-start"}`,children:e.jsx("div",{className:`max-w-[85%] rounded-2xl p-3 text-sm leading-relaxed shadow-sm ${c.role==="user"?"bg-cyan-600 text-white rounded-br-none":"bg-white text-slate-700 border border-slate-200 rounded-bl-none"}`,children:c.content.split(`
`).map((q,u)=>e.jsx("p",{className:"mb-1 last:mb-0",children:q},u))})},R)),f&&e.jsx("div",{className:"flex justify-start",children:e.jsx("div",{className:"bg-white border border-slate-200 rounded-2xl rounded-bl-none p-4 shadow-sm",children:e.jsxs("div",{className:"flex gap-1.5",children:[e.jsx("div",{className:"w-2 h-2 bg-slate-400 rounded-full animate-bounce"}),e.jsx("div",{className:"w-2 h-2 bg-slate-400 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("div",{className:"w-2 h-2 bg-slate-400 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})})}),e.jsx("div",{ref:C})]}),e.jsx("div",{className:"p-3 bg-white border-t border-slate-200",children:e.jsxs("form",{onSubmit:o,className:"relative flex items-center gap-2",children:[e.jsx("input",{type:"text",className:"w-full pl-4 pr-12 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 outline-none text-sm text-slate-800 placeholder-slate-400 transition-all",placeholder:"Escribe tu pregunta sobre los datos...",value:v,onChange:c=>$(c.target.value),disabled:f}),e.jsx("button",{type:"submit",disabled:!v.trim()||f,className:"absolute right-2 p-2 bg-gradient-to-r from-cyan-500 to-cyan-600 text-white rounded-lg hover:shadow-md disabled:opacity-50 disabled:shadow-none transition-all active:scale-95",children:e.jsx(xt,{size:18})})]})})]})]})]}):e.jsxs("div",{className:"bg-gradient-to-br from-slate-800 to-slate-900 rounded-2xl p-6 text-white",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-cyan-500/20 rounded-xl",children:e.jsx(ze,{size:24,className:"text-cyan-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg",children:"Consultor IA"}),e.jsx("p",{className:"text-slate-400 text-xs",children:"Mejora Continua"})]})]}),e.jsxs("div",{className:"bg-slate-700/50 rounded-xl p-4 border border-slate-600",children:[e.jsx("p",{className:"text-sm text-slate-300 mb-3",children:"Para activar el anÃ¡lisis inteligente, configura tu API Key de Gemini:"}),e.jsx("code",{className:"text-xs bg-slate-800 px-2 py-1 rounded text-cyan-400",children:"VITE_GEMINI_API_KEY=tu_api_key"})]})]})},ua=()=>{var z;const{user:t,globalFilterCompanyId:r,companies:d}=Z(),[m,s]=j.useState({fiveS:[],quickWins:[],vsms:[],a3:[]}),[i,N]=j.useState(!0);j.useEffect(()=>{(async()=>{if(t)try{N(!0);const[a,x,h,b]=await Promise.all([U.from("five_s_cards").select("id, created_at, status, reason, responsible, company_id, date, location, article, type, proposed_action"),U.from("quick_wins").select("id, title, status, company_id, responsible, date, impact, description"),U.from("vsm_projects").select("id, company_id"),U.from("a3_projects").select("id, company_id, title, status, responsible, created_at, action_plan, follow_up_data, background, current_condition, goal, root_cause, countermeasures, ishikawas, five_whys")]),k=a.data?a.data.map(f=>({id:f.id,status:f.status,reason:f.reason,responsible:f.responsible,companyId:f.company_id,date:f.date,location:f.location,article:f.article})):[],S=x.data?x.data.map(f=>({id:f.id,title:f.title,description:f.description,status:f.status,companyId:f.company_id,responsible:f.responsible,date:f.date,impact:f.impact})):[],L=h.data?h.data.map(f=>({id:f.id,companyId:f.company_id})):[],v=b.data?b.data.map(f=>({id:f.id,companyId:f.company_id,title:f.title,status:f.status,responsible:f.responsible,created_at:f.created_at,actionPlan:f.action_plan||[],background:f.background,currentCondition:f.current_condition,goal:f.goal,rootCause:f.root_cause,countermeasures:f.countermeasures,ishikawas:f.ishikawas||[],multipleFiveWhys:f.five_whys||[],followUpData:Array.isArray(f.follow_up_data)?f.follow_up_data:f.follow_up_data?[f.follow_up_data]:[]})):[],$=await $e.getLogs(null,50);s({fiveS:k,quickWins:S,vsms:L,a3:v,auditLogs:$})}catch(a){console.error("Error loading consultant data:",a)}finally{N(!1)}})()},[t,r]);const w=j.useMemo(()=>{if(!t)return{fiveS:[],quickWins:[],vsms:[],a3:[]};const a=t.role==="admin"||t.email==="ariel.mellag@gmail.com"?r:t.companyId,x=h=>Array.isArray(h)?a==="all"?h:h.filter(b=>b.companyId&&b.companyId===a):[];return{fiveS:x(m.fiveS),quickWins:x(m.quickWins),vsms:x(m.vsms),a3:x(m.a3),auditLogs:m.auditLogs||[]}},[t,r,m]),l=((z=d==null?void 0:d.find(n=>n.id===r))==null?void 0:z.name)||"Todas las Empresas";return t?e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6 h-[calc(100vh-100px)] flex flex-col",children:[e.jsx("div",{className:"flex flex-col xl:flex-row justify-between xl:items-end gap-4 shrink-0",children:e.jsx(ve,{title:"Consultor IA",subtitle:"AnÃ¡lisis inteligente y asistencia en tiempo real",icon:e.jsx(ze,{className:"text-cyan-500",size:32})})}),e.jsx("div",{className:"flex-1 bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden",children:i?e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsx("div",{className:"w-12 h-12 border-4 border-cyan-500 border-t-transparent rounded-full animate-spin"})}):e.jsx(xa,{data:w,companyName:l,apiKey:"AIzaSyA9gGiCRlbNcJvyya6whZ6G-v4Yb0_jvDE",fullScreen:!0})})]}):e.jsx("div",{className:"flex h-screen items-center justify-center text-slate-400",children:"Cargando..."})},pa=()=>{const[t,r]=j.useState({date:new Date().toISOString().split("T")[0],location:"",article:"",reporter:"",responsible:"",reason:"",proposedAction:"",type:"Clasificar"}),[d,m]=j.useState(null),[s,i]=j.useState(null),[N,w]=j.useState({before:null,after:null}),[l,z]=j.useState(!1),[n,a]=j.useState(!1),x=()=>{a(!0),setTimeout(()=>{a(!1),r({date:new Date().toISOString().split("T")[0],location:"",article:"",reporter:"",responsible:"",reason:"",proposedAction:"",type:"Clasificar"}),m(null),i(null),w({before:null,after:null})},3e3)},h=async k=>{if(k.preventDefault(),!t.location||!t.reason){alert("UbicaciÃ³n y Hallazgo son obligatorios.");return}z(!0);try{const S={date:t.date,location:t.location,article:t.article,reporter:t.reporter,reason:t.reason,proposed_action:t.proposedAction,responsible:t.responsible,target_date:null,solution_date:null,status:"Pendiente",type:t.type,company_id:null};await me.saveCard(S,d,s),x()}catch(S){console.error("Error saving offline card:",S),alert("Error al guardar: "+S.message)}finally{z(!1)}},b=(k,S,L)=>{k==="imageBefore"?(m(S),w(v=>({...v,before:L}))):(i(S),w(v=>({...v,after:L})))};return n?e.jsxs("div",{className:"min-h-screen bg-emerald-50 flex flex-col items-center justify-center p-6 text-center animate-in fade-in duration-300",children:[e.jsx("div",{className:"w-20 h-20 bg-emerald-100 rounded-full flex items-center justify-center mb-6 shadow-sm",children:e.jsx(K,{size:40,className:"text-emerald-600"})}),e.jsx("h2",{className:"text-2xl font-bold text-emerald-800 mb-2",children:"Â¡Guardado Localmente!"}),e.jsx("p",{className:"text-emerald-600 mb-8 max-w-xs",children:"Tu tarjeta ha sido guardada en este dispositivo. Se subirÃ¡ automÃ¡ticamente cuando inicies sesiÃ³n con conexiÃ³n."}),e.jsxs("div",{className:"space-y-3 w-full max-w-xs",children:[e.jsx("button",{onClick:()=>a(!1),className:"w-full py-3 bg-emerald-600 hover:bg-emerald-700 text-white rounded-xl font-bold transition-transform active:scale-95 shadow-lg shadow-emerald-500/30",children:"Ingresar Otra Tarjeta"}),e.jsx(pe,{to:"/login",className:"block w-full py-3 text-emerald-700 hover:bg-emerald-100 rounded-xl font-medium transition-colors",children:"Volver al Inicio"})]})]}):e.jsxs("div",{className:"min-h-screen bg-slate-50 pb-safe",children:[e.jsxs("div",{className:"bg-white px-4 py-3 shadow-sm border-b border-slate-200 sticky top-0 z-10 flex items-center justify-between",children:[e.jsx(pe,{to:"/login",className:"p-2 -ml-2 text-slate-500 hover:bg-slate-50 rounded-full",children:e.jsx(cs,{size:24})}),e.jsxs("h1",{className:"font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(Ke,{size:18,className:"text-slate-400"}),"Ingreso Offline"]}),e.jsx("div",{className:"w-8"})," "]}),e.jsxs("main",{className:"max-w-lg mx-auto p-4 space-y-6",children:[e.jsxs("div",{className:"bg-yellow-50 border border-yellow-100 p-4 rounded-xl flex gap-3 shadow-sm",children:[e.jsx("div",{className:"bg-yellow-100 p-2 rounded-lg h-fit text-yellow-600",children:e.jsx(Ke,{size:20})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-yellow-900 text-sm",children:"Modo Sin ConexiÃ³n"}),e.jsx("p",{className:"text-xs text-yellow-800 mt-1",children:"Las tarjetas creadas aquÃ­ se guardan en tu dispositivo. Inicia sesiÃ³n cuando tengas internet para sincronizarlas."})]})]}),e.jsxs("form",{onSubmit:h,className:"space-y-5",children:[e.jsxs("section",{className:"bg-white p-5 rounded-2xl shadow-sm border border-slate-100 space-y-4",children:[e.jsx("h4",{className:"text-sm font-bold text-slate-900 uppercase tracking-wider mb-2",children:"Detalles del Hallazgo"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-900 mb-1",children:"UbicaciÃ³n *"}),e.jsx("input",{type:"text",className:"w-full p-3 bg-white border border-slate-300 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none text-black placeholder-slate-500 font-medium",placeholder:"Ej: LÃ­nea 1, Bodega...",value:t.location,onChange:k=>r({...t,location:k.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-900 mb-1",children:"DescripciÃ³n del Hallazgo *"}),e.jsx("textarea",{className:"w-full p-3 bg-white border border-slate-300 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none min-h-[100px] text-black placeholder-slate-500 font-medium",placeholder:"Describe la anomalÃ­a...",value:t.reason,onChange:k=>r({...t,reason:k.target.value}),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-900 mb-1",children:"Tipo"}),e.jsxs("select",{className:"w-full p-3 bg-white border border-slate-300 rounded-xl outline-none text-black font-medium",value:t.type,onChange:k=>r({...t,type:k.target.value}),children:[e.jsx("option",{value:"Clasificar",children:"Clasificar"}),e.jsx("option",{value:"Ordenar",children:"Ordenar"}),e.jsx("option",{value:"Limpiar",children:"Limpiar"}),e.jsx("option",{value:"Seguridad",children:"Seguridad"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-900 mb-1",children:"Fecha"}),e.jsx("input",{type:"date",className:"w-full p-3 bg-white border border-slate-300 rounded-xl outline-none text-black font-medium",value:t.date,onChange:k=>r({...t,date:k.target.value})})]})]})]}),e.jsxs("section",{className:"bg-white p-5 rounded-2xl shadow-sm border border-slate-100 space-y-4",children:[e.jsx("h4",{className:"text-sm font-bold text-slate-900 uppercase tracking-wider mb-2",children:"Evidencia FotogrÃ¡fica"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-900 mb-2 text-center",children:"ANTES"}),e.jsx(je,{currentImage:N.before,onFileSelect:(k,S)=>b("imageBefore",k,S),label:"Foto",height:"h-32"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-900 mb-2 text-center",children:"DESPUÃ‰S (Opcional)"}),e.jsx(je,{currentImage:N.after,onFileSelect:(k,S)=>b("imageAfter",k,S),label:"Foto",height:"h-32"})]})]})]}),e.jsxs("section",{className:"bg-white p-5 rounded-2xl shadow-sm border border-slate-100 space-y-4",children:[e.jsx("h4",{className:"text-sm font-bold text-slate-900 uppercase tracking-wider mb-2",children:"Personas"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-900 mb-1",children:"Reportado por"}),e.jsx("input",{type:"text",className:"w-full p-3 bg-white border border-slate-300 rounded-xl outline-none text-black placeholder-slate-500 font-medium",placeholder:"Tu nombre",value:t.reporter,onChange:k=>r({...t,reporter:k.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-900 mb-1",children:"Responsable Sugerido"}),e.jsx("input",{type:"text",className:"w-full p-3 bg-white border border-slate-300 rounded-xl outline-none text-black placeholder-slate-500 font-medium",placeholder:"Nombre del responsable",value:t.responsible,onChange:k=>r({...t,responsible:k.target.value})})]})]}),e.jsx("button",{type:"submit",disabled:l,className:"w-full py-4 bg-gradient-to-r from-blue-600 to-cyan-600 text-white rounded-2xl font-bold text-lg shadow-lg shadow-blue-500/30 active:scale-[0.98] transition-all flex items-center justify-center gap-2",children:l?e.jsx(e.Fragment,{children:"Guardando..."}):e.jsxs(e.Fragment,{children:[e.jsx(Me,{size:20}),"Guardar Tarjeta"]})}),e.jsx("div",{className:"h-10"})]})]})]})},ys={S1:["Â¿Se han eliminado los elementos innecesarios del Ã¡rea?","Â¿Las herramientas y materiales estÃ¡n clasificados correctamente?","Â¿Los pasillos y zonas de paso estÃ¡n libres de obstÃ¡culos?"],S2:["Â¿Cada cosa tiene un lugar asignado y estÃ¡ en su lugar?","Â¿Las ubicaciones estÃ¡n claramente etiquetadas?","Â¿Es fÃ¡cil encontrar y devolver las herramientas?"],S3:["Â¿El Ã¡rea de trabajo estÃ¡ limpia y libre de polvo/aceite?","Â¿Existen programas de limpieza visibles y se siguen?","Â¿Los equipos de limpieza estÃ¡n disponibles y en buen estado?"],S4:['Â¿Existen estÃ¡ndares visuales claros para el estado "normal"?',"Â¿Se utiliza cÃ³digo de colores para identificar anomalÃ­as?","Â¿Todos conocen los procedimientos estÃ¡ndar?"],S5:["Â¿Se realizan auditorÃ­as periÃ³dicas?","Â¿Se respetan las normas establecidas consistentemente?","Â¿Existe un plan de mejora continua activo?"]},ha=()=>{const t=We(),[r,d]=j.useState(!1),[m,s]=j.useState(!1),[i,N]=j.useState("S1"),[w,l]=j.useState(()=>{const b={};return Object.keys(ys).forEach(k=>{b[k]=ys[k].map(S=>({question:S,score:0,comment:""}))}),{title:"",area:"",auditor:"",date:new Date().toISOString().split("T")[0],entries:b}}),z=(b,k,S,L)=>{const v={...w.entries};v[b][k][S]=L,l({...w,entries:v})},n=b=>{const k={...w.entries};k[b].push({question:"Nueva pregunta",score:0,comment:""}),l({...w,entries:k})},a=(b,k)=>{const S={...w.entries};S[b].splice(k,1),l({...w,entries:S})},x=()=>{let b=0,k=0;return Object.keys(w.entries).forEach(S=>{w.entries[S].forEach(L=>{b+=parseInt(L.score),k+=1})}),k>0?parseFloat((b/k).toFixed(2)):0},h=async b=>{b.preventDefault(),d(!0);try{const k=x(),S={...w,total_score:k};await me.saveAudit(S),s(!0)}catch(k){console.error("Error saving offline audit:",k),alert("Error al guardar la auditorÃ­a localmente.")}finally{d(!1)}};return m?e.jsx("div",{className:"min-h-screen bg-slate-50 flex flex-col items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white p-8 rounded-2xl shadow-xl max-w-md w-full text-center animate-fadeIn",children:[e.jsx("div",{className:"w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx(K,{size:40,className:"text-green-600"})}),e.jsx("h2",{className:"text-2xl font-bold text-slate-800 mb-2",children:"AuditorÃ­a Guardada Offline"}),e.jsx("p",{className:"text-slate-600 mb-8",children:"La auditorÃ­a ha sido guardada en este dispositivo. Cuando tengas conexiÃ³n, inicia sesiÃ³n para sincronizarla."}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:()=>window.location.reload(),className:"w-full py-3 px-4 bg-indigo-600 text-white rounded-xl font-semibold hover:bg-indigo-700 transition-colors",children:"Crear Otra AuditorÃ­a"}),e.jsx("button",{onClick:()=>t("/login"),className:"w-full py-3 px-4 bg-white text-slate-700 border border-slate-200 rounded-xl font-semibold hover:bg-slate-50 transition-colors",children:"Volver al Login"})]})]})}):e.jsxs("div",{className:"min-h-screen bg-slate-100 pb-20",children:[e.jsx("div",{className:"bg-white shadow-sm sticky top-0 z-10",children:e.jsxs("div",{className:"max-w-3xl mx-auto px-4 py-4 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>t("/login"),className:"text-slate-500 hover:text-slate-700",children:e.jsx(cs,{size:24})}),e.jsxs("h1",{className:"text-lg font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(Ke,{size:20,className:"text-amber-500"}),"AuditorÃ­a 5S Offline"]}),e.jsx("div",{className:"w-6"})]})}),e.jsx("main",{className:"max-w-3xl mx-auto px-4 py-6",children:e.jsxs("form",{onSubmit:h,className:"space-y-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-sm space-y-4",children:[e.jsx("h2",{className:"font-bold text-slate-900 mb-4",children:"InformaciÃ³n General"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-900 mb-1",children:"TÃ­tulo de Referencia"}),e.jsx("input",{type:"text",className:"w-full bg-white border border-slate-300 rounded-lg py-3 px-4 focus:outline-none focus:border-indigo-500 text-black placeholder-slate-500 font-medium",value:w.title,onChange:b=>l({...w,title:b.target.value}),placeholder:"Ej. AuditorÃ­a Q1"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-900 mb-1",children:"Ãrea *"}),e.jsx("input",{type:"text",required:!0,className:"w-full bg-white border border-slate-300 rounded-lg py-3 px-4 focus:outline-none focus:border-indigo-500 text-black placeholder-slate-500 font-medium",value:w.area,onChange:b=>l({...w,area:b.target.value}),placeholder:"Ej. ProducciÃ³n"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-900 mb-1",children:"Auditor *"}),e.jsx("input",{type:"text",required:!0,className:"w-full bg-white border border-slate-300 rounded-lg py-3 px-4 focus:outline-none focus:border-indigo-500 text-black placeholder-slate-500 font-medium",value:w.auditor,onChange:b=>l({...w,auditor:b.target.value}),placeholder:"Tu Nombre"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-900 mb-1",children:"Fecha *"}),e.jsx("input",{type:"date",required:!0,className:"w-full bg-white border border-slate-300 rounded-lg py-3 px-4 focus:outline-none focus:border-indigo-500 text-black font-medium",value:w.date,onChange:b=>l({...w,date:b.target.value})})]})]}),e.jsx("div",{className:"space-y-4",children:["S1","S2","S3","S4","S5"].map(b=>{var k;return e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden",children:[e.jsxs("button",{type:"button",onClick:()=>N(i===b?null:b),className:`w-full flex justify-between items-center p-4 text-left transition-colors ${i===b?"bg-indigo-50 text-indigo-900":"bg-white text-slate-900 hover:bg-slate-50"}`,children:[e.jsx("span",{className:"font-bold text-lg",children:b}),i===b?e.jsx(Qe,{}):e.jsx(Se,{})]}),i===b&&e.jsxs("div",{className:"p-4 bg-slate-50 space-y-4",children:[(k=w.entries[b])==null?void 0:k.map((S,L)=>e.jsx("div",{className:"bg-white p-4 rounded-lg border border-slate-200 shadow-sm",children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex justify-between items-start gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs text-slate-600 uppercase font-bold mb-1 block",children:"Pregunta"}),e.jsx("input",{type:"text",className:"w-full border-b border-slate-300 focus:border-indigo-500 py-1 text-sm text-black font-medium focus:outline-none",value:S.question,onChange:v=>z(b,L,"question",v.target.value)})]}),e.jsxs("div",{className:"w-20",children:[e.jsx("label",{className:"text-xs text-slate-600 uppercase font-bold mb-1 block text-center",children:"Nota"}),e.jsx("select",{className:"w-full bg-slate-100 border border-slate-200 rounded py-1 px-2 text-center font-bold text-indigo-800",value:S.score,onChange:v=>z(b,L,"score",parseInt(v.target.value)),children:[0,1,2,3,4,5].map(v=>e.jsx("option",{value:v,children:v},v))})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",placeholder:"Observaciones...",className:"flex-1 bg-white border border-slate-300 rounded px-3 py-2 text-sm focus:outline-none focus:border-indigo-500 text-black placeholder-slate-500",value:S.comment||"",onChange:v=>z(b,L,"comment",v.target.value)}),e.jsx("button",{type:"button",onClick:()=>a(b,L),className:"text-red-400 hover:text-red-600 p-2",children:e.jsx(Y,{size:16})})]})]})},L)),e.jsxs("button",{type:"button",onClick:()=>n(b),className:"w-full py-3 border-2 border-dashed border-indigo-200 rounded-lg text-indigo-500 font-medium hover:bg-indigo-50 flex items-center justify-center gap-2",children:[e.jsx(J,{size:18})," Agregar Criterio"]})]})]},b)})}),e.jsx("button",{type:"submit",disabled:r,className:"fixed bottom-6 right-6 left-6 md:left-auto md:w-64 bg-indigo-600 text-white py-4 rounded-xl shadow-xl shadow-indigo-500/30 font-bold text-lg flex items-center justify-center gap-2 hover:bg-indigo-700 transition-transform active:scale-95 disabled:opacity-70 disabled:cursor-not-allowed z-20",children:r?"Guardando...":e.jsxs(e.Fragment,{children:[e.jsx(Me,{})," Guardar AuditorÃ­a"]})})]})})]})},ba=()=>{const{updatePassword:t}=Z(),[r,d]=j.useState(""),[m,s]=j.useState(""),[i,N]=j.useState(""),[w,l]=j.useState(""),[z,n]=j.useState(!1),a=We(),x=async h=>{if(h.preventDefault(),N(""),l(""),r!==m){l("Las contraseÃ±as no coinciden");return}if(r.length<6){l("La contraseÃ±a debe tener al menos 6 caracteres");return}n(!0);const b=await t(r);n(!1),b.success?(N(b.message),setTimeout(()=>{a("/login")},3e3)):l(b.message)};return e.jsxs("div",{className:"min-h-screen bg-slate-900 flex items-center justify-center relative overflow-hidden font-sans selection:bg-cyan-500/30",children:[e.jsxs("div",{className:"absolute top-0 left-0 w-full h-full overflow-hidden z-0",children:[e.jsx("div",{className:"absolute top-[-10%] left-[-10%] w-96 h-96 bg-purple-500/30 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-blob"}),e.jsx("div",{className:"absolute top-[-10%] right-[-10%] w-96 h-96 bg-cyan-500/30 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-blob animation-delay-2000"}),e.jsx("div",{className:"absolute -bottom-32 left-20 w-96 h-96 bg-blue-500/30 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-blob animation-delay-4000"}),e.jsx("div",{className:"absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-20 brightness-100 contrast-150"})]}),e.jsxs("div",{className:"w-full max-w-md p-8 relative z-10 animate-fade-in-up",children:[e.jsxs("div",{className:"glass-panel p-8 sm:p-10 rounded-2xl border border-slate-700/50 shadow-2xl backdrop-blur-xl relative overflow-hidden group",children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-blue-500 via-cyan-400 to-blue-500 opacity-50 group-hover:opacity-100 transition-opacity duration-500"}),e.jsxs("div",{className:"text-center mb-10 relative",children:[e.jsx("div",{className:"inline-block relative",children:e.jsx("h1",{className:"relative text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-white via-blue-100 to-slate-200 tracking-tight mb-2",children:"Nueva ContraseÃ±a"})}),e.jsx("p",{className:"text-slate-400 text-sm font-medium tracking-wide",children:"Ingresa tu nueva contraseÃ±a para finalizar"})]}),i&&e.jsxs("div",{className:"bg-emerald-500/10 border border-emerald-500/20 text-emerald-400 px-4 py-3 rounded-lg mb-6 text-sm flex items-center animate-fade-in-up",children:[e.jsx(bt,{className:"h-5 w-5 mr-2 flex-shrink-0"}),i]}),w&&e.jsxs("div",{className:"bg-red-500/10 border border-red-500/20 text-red-400 px-4 py-3 rounded-lg mb-6 text-sm flex items-center animate-shake",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2 flex-shrink-0",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),w]}),i?e.jsx("div",{className:"mt-8 text-center",children:e.jsxs(pe,{to:"/login",className:"inline-flex items-center gap-2 text-cyan-400 hover:text-cyan-300 font-medium transition-colors hover:translate-x-1 duration-300",children:["Ir al inicio de sesiÃ³n ",e.jsx(xe,{size:16})]})}):e.jsxs("form",{onSubmit:x,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-1 group",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-400 uppercase tracking-wider ml-1 group-focus-within:text-cyan-400 transition-colors",children:"Nueva ContraseÃ±a"}),e.jsxs("div",{className:"relative transform transition-all duration-300 focus-within:scale-[1.02]",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(Ue,{className:"h-5 w-5 text-slate-500 group-focus-within:text-cyan-400 transition-colors"})}),e.jsx("input",{type:"password",className:"w-full bg-slate-900/50 border border-slate-700 text-slate-200 rounded-xl py-3 pl-10 pr-4 placeholder-slate-600 focus:outline-none focus:ring-2 focus:ring-cyan-500/30 focus:border-cyan-500/50 transition-all duration-300 shadow-inner",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",value:r,onChange:h=>d(h.target.value),required:!0,minLength:6})]})]}),e.jsxs("div",{className:"space-y-1 group",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-400 uppercase tracking-wider ml-1 group-focus-within:text-cyan-400 transition-colors",children:"Confirmar ContraseÃ±a"}),e.jsxs("div",{className:"relative transform transition-all duration-300 focus-within:scale-[1.02]",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(Ue,{className:"h-5 w-5 text-slate-500 group-focus-within:text-cyan-400 transition-colors"})}),e.jsx("input",{type:"password",className:"w-full bg-slate-900/50 border border-slate-700 text-slate-200 rounded-xl py-3 pl-10 pr-4 placeholder-slate-600 focus:outline-none focus:ring-2 focus:ring-cyan-500/30 focus:border-cyan-500/50 transition-all duration-300 shadow-inner",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",value:m,onChange:h=>s(h.target.value),required:!0,minLength:6})]})]}),e.jsxs("button",{type:"submit",disabled:z,className:"w-full relative overflow-hidden group bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-500 hover:to-cyan-500 text-white font-semibold py-3.5 rounded-xl shadow-lg shadow-blue-900/20 transform transition-all duration-300 hover:shadow-cyan-500/20 hover:-translate-y-0.5 disabled:opacity-70 disabled:cursor-not-allowed disabled:hover:translate-y-0",children:[e.jsx("span",{className:"relative z-10 flex items-center justify-center gap-2",children:z?e.jsxs(e.Fragment,{children:[e.jsx(Be,{className:"h-5 w-5 animate-spin"}),e.jsx("span",{children:"Actualizando..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Cambiar ContraseÃ±a"}),e.jsx(xe,{className:"h-5 w-5 group-hover:translate-x-1 transition-transform"})]})}),e.jsx("div",{className:"absolute top-0 -inset-full h-full w-1/2 z-5 block transform -skew-x-12 bg-gradient-to-r from-transparent to-white opacity-20 group-hover:animate-shine"})]})]})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("p",{className:"text-slate-600 text-xs",children:["Â© ",new Date().getFullYear()," Nexus System. v1.0.0"]})})]})]})},fa=()=>{const{user:t,loading:r}=Z();return r?e.jsx("div",{className:"flex items-center justify-center h-screen bg-slate-900 text-white",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-white"})}):t?e.jsx(ks,{}):e.jsx(Cs,{to:"/login",replace:!0})};function ga(){return e.jsx(It,{children:e.jsx($t,{children:e.jsx(Ms,{children:e.jsxs(qs,{children:[e.jsx(X,{path:"/login",element:e.jsx(Zt,{})}),e.jsx(X,{path:"/register",element:e.jsx(ea,{})}),e.jsx(X,{path:"/forgot-password",element:e.jsx(sa,{})}),e.jsx(X,{path:"/reset-password",element:e.jsx(ba,{})}),e.jsx(X,{path:"/offline-access",element:e.jsx(pa,{})}),e.jsx(X,{path:"/offline-audit",element:e.jsx(ha,{})}),e.jsx(X,{element:e.jsx(fa,{}),children:e.jsxs(X,{path:"/",element:e.jsx(Ot,{}),children:[e.jsx(X,{index:!0,element:e.jsx(Mt,{})}),e.jsx(X,{path:"consultant",element:e.jsx(ua,{})}),e.jsx(X,{path:"a3",element:e.jsx(Ht,{})}),e.jsx(X,{path:"5s",element:e.jsx(Kt,{})}),e.jsx(X,{path:"auditorias-5s",element:e.jsx(la,{})}),e.jsx(X,{path:"quick-wins",element:e.jsx(Yt,{})}),e.jsx(X,{path:"vsm",element:e.jsx(Xt,{})}),e.jsx(X,{path:"responsables",element:e.jsx(Ft,{})}),e.jsx(X,{path:"admin",element:e.jsx(ra,{})})]})}),e.jsx(X,{path:"*",element:e.jsx(Cs,{to:"/",replace:!0})})]})})})})}ns.createRoot(document.getElementById("root")).render(e.jsx(as.StrictMode,{children:e.jsx(ga,{})}));export{U as s};
